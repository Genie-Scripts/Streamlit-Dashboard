<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¥ æ–°å…¥é™¢æ‚£è€… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --primary: #1D4ED8;
      --primary-light: #3B82F6;
      --success: #10B981;
      --warning: #F59E0B;
      --danger: #EF4444;
      --near-bg: #FEF3C7;
      --near-col: #92400E;
      --text: #1F2937;
      --bg: #F1F5F9;
      --card: #FFFFFF;
      --border: #E2E8F0;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Hiragino Sans", "Noto Sans JP", "Yu Gothic", sans-serif;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
      line-height: 1.6;
    }

    /* ===== HEADER ===== */
    .header {
      background: linear-gradient(135deg, #1E3A6E 0%, #1D4ED8 60%, #3B82F6 100%);
      color: white;
      padding: 20px 24px 16px;
      text-align: center;
    }
    .header h1 { font-size: clamp(1.1rem, 3vw, 1.6rem); font-weight: 800; letter-spacing: 0.02em; }
    .header-meta { display: flex; justify-content: center; gap: 20px; margin-top: 10px; flex-wrap: wrap; }
    .header-meta span {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 20px;
      padding: 3px 14px;
      font-size: 0.82rem;
    }
    .portal-btn {
      display: inline-block; margin-top: 12px;
      padding: 7px 20px; border-radius: 6px;
      background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.4);
      color: white; text-decoration: none; font-size: 0.85rem; font-weight: bold;
      transition: background 0.2s;
    }
    .portal-btn:hover { background: rgba(255,255,255,0.28); }

    /* ===== LAYOUT ===== */
    .wrap { max-width: 1100px; margin: 0 auto; padding: 20px 14px 40px; }
    .section-title {
      font-size: 0.82rem; font-weight: 700; letter-spacing: 0.08em;
      text-transform: uppercase; color: var(--primary);
      border-left: 3px solid var(--primary);
      padding-left: 10px; margin-bottom: 14px;
    }

    /* ===== KPI CARDS ===== */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px; margin-bottom: 28px;
    }
    .kpi-card {
      background: var(--card);
      border-radius: 10px;
      padding: 14px 14px 10px 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border-left: 5px solid var(--border);
      transition: transform 0.15s;
      display: flex;
      flex-direction: column;
    }
    .kpi-card:hover { transform: translateY(-2px); }
    .kpi-card.success { border-left-color: var(--success); }
    .kpi-card.warn    { border-left-color: var(--warning); }
    .kpi-card.danger  { border-left-color: var(--danger); }
    .kpi-card.flat    { border-left-color: #CBD5E1; }
    .kpi-card-header  { display: flex; align-items: flex-start; justify-content: space-between; gap: 4px; }
    .kpi-label  { font-size: 0.73rem; color: #6B7280; font-weight: 500; line-height: 1.3; flex: 1; margin-bottom: 0; }
    .kpi-icon   { font-size: 1.05rem; line-height: 1; flex-shrink: 0; }
    .kpi-value  { font-size: 1.55rem; font-weight: 800; color: var(--text); margin-top: 7px; line-height: 1; }
    .kpi-value.success { color: var(--success); }
    .kpi-value.warn    { color: var(--warning); }
    .kpi-value.danger  { color: var(--danger); }
    .kpi-value.flat    { color: #94A3B8; }
    .kpi-sub    { font-size: 0.70rem; color: #9CA3AF; margin-top: 4px; margin-bottom: 8px; }
    .kpi-gauge-wrap { height: 4px; background: #F1F5F9; border-radius: 99px; overflow: hidden; }
    .kpi-gauge-fill { height: 100%; border-radius: 99px; }
    .kpi-gauge-fill.success { background: linear-gradient(90deg, #34D399, #10B981); }
    .kpi-gauge-fill.warn    { background: linear-gradient(90deg, #FCD34D, #F59E0B); }
    .kpi-gauge-fill.danger  { background: linear-gradient(90deg, #F87171, #EF4444); }
    .kpi-gauge-fill.flat    { background: #CBD5E1; }
    .kpi-gauge-pct  { font-size: 0.67rem; font-weight: 700; margin-top: 3px; }

    /* ===== CHART ===== */
    .chart-card {
      background: var(--card);
      border-radius: 10px;
      padding: 18px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.07);
      margin-bottom: 28px;
    }
    .chart-card canvas { width: 100% !important; }
    .chart-hint { font-size: 0.7rem; color: #9CA3AF; margin-top: 6px; }

    /* ===== TABS ===== */
    .tab-bar {
      display: flex; gap: 6px; margin-bottom: 16px; flex-wrap: wrap;
    }
    .tab-btn {
      padding: 7px 18px; border-radius: 20px;
      border: 1.5px solid var(--primary); background: white;
      color: var(--primary); font-weight: 700; font-size: 0.82rem;
      cursor: pointer; transition: all 0.18s;
    }
    .tab-btn.active { background: var(--primary); color: white; }
    .tab-btn:hover:not(.active) { background: #EFF6FF; }
    .view-toggle {
      display: flex; gap: 6px; margin-bottom: 14px; flex-wrap: wrap;
    }
    .view-btn {
      padding: 5px 16px; border-radius: 16px;
      border: 1.5px solid #94A3B8; background: white;
      color: #64748B; font-weight: 600; font-size: 0.8rem;
      cursor: pointer; transition: all 0.18s;
    }
    .view-btn.active { background: #334155; border-color: #334155; color: white; }

    /* ===== PERFORMANCE BARS ===== */
    .perf-section { margin-bottom: 28px; }
    .perf-panel { display: none; }
    .perf-panel.active { display: block; }
    .perf-row {
      display: flex; align-items: center; gap: 8px;
      margin-bottom: 8px; min-height: 30px;
    }
    .perf-name {
      flex: 0 0 100px; font-size: 0.78rem; font-weight: 600;
      padding: 3px 8px; border-radius: 5px; text-align: center;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .perf-name.achieved { background: #D1FAE5; color: #065F46; }
    .perf-name.near     { background: var(--near-bg); color: var(--near-col); }
    .perf-name.below    { background: #FEE2E2; color: #991B1B; }
    .perf-nums {
      flex: 0 0 130px; font-size: 0.72rem; color: #4B5563; white-space: nowrap;
    }
    .perf-bar-wrap {
      flex: 1; position: relative; height: 20px;
      background: #F1F5F9; border-radius: 4px; overflow: visible;
    }
    .perf-bar-fill {
      height: 100%; border-radius: 4px; transition: width 0.5s ease;
      min-width: 2px;
    }
    .perf-bar-fill.achieved { background: var(--success); }
    .perf-bar-fill.near     { background: var(--warning); }
    .perf-bar-fill.below    { background: var(--danger); }
    /* ç›®æ¨™ã€Œã‚³ã€å‹ãƒãƒ¼ã‚«ãƒ¼ */
    .perf-target-line {
      position: absolute; top: -4px;
      height: calc(100% + 8px);
      background: transparent;
      border-top: 2px solid var(--primary);
      border-bottom: 2px solid var(--primary);
      border-right: 2px solid var(--primary);
      border-left: none;
      border-radius: 0 3px 3px 0;
      z-index: 2; pointer-events: none;
    }
    .perf-rate {
      flex: 0 0 38px; text-align: right;
      font-size: 0.78rem; font-weight: 700; color: var(--text);
    }
    .perf-badge { flex: 0 0 22px; text-align: center; font-size: 0.85rem; }
    .perf-legend {
      display: flex; gap: 14px; margin-top: 10px; flex-wrap: wrap;
      font-size: 0.72rem; color: #6B7280;
    }

    /* ===== PRINT ===== */
    @media print {
      body { background: white; }
      .header { background: #1D4ED8 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .portal-btn { display: none; }
      .tab-bar, .view-toggle { display: none; }
      .perf-panel { display: block !important; }
      @page { margin: 12mm; }
    }
    @media (max-width: 600px) {
      .perf-nums { display: none; }
      .perf-name { flex: 0 0 80px; font-size: 0.72rem; }
    }
  </style>
</head>
<body>

<div class="header">
  <h1>ğŸ¥ æ–°å…¥é™¢æ‚£è€… é”æˆçŠ¶æ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
  <div class="header-meta">
    <span>ğŸ“… åˆ†ææœŸé–“: 2024-01-01 ã€œ 2026-02-15</span>
    <span>ğŸ“Š é›†è¨ˆæ—¥: 2026-02-15</span>
    <span>ğŸ• ç”Ÿæˆ: 2026-02-16 17:51</span>
  </div>
  <a href="../index.html" class="portal-btn">ğŸ“Š ãƒãƒ¼ã‚¿ãƒ«ã«æˆ»ã‚‹</a>
</div>

<div class="wrap">

  <!-- KPI -->
  <div class="section-title">ç—…é™¢å…¨ä½“ æ–°å…¥é™¢æ‚£è€… KPI</div>
  <div class="kpi-grid" id="kpi-grid">
    <!-- JS ã§æç”» -->
  </div>

  <!-- æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ•ï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯ï¼‰ -->
  <div class="section-title" style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;" onclick="toggleChart()">
    <span>æ¨ç§»ã‚°ãƒ©ãƒ•ï¼ˆç—…é™¢å…¨ä½“ æ—¥æ¬¡ / 28æ—¥ç§»å‹•å¹³å‡ï¼‰</span>
    <span id="chart-toggle-icon" style="font-size:0.8rem;color:#64748B;font-weight:400;padding:2px 10px;border:1px solid #CBD5E1;border-radius:12px;">â–² é–‰ã˜ã‚‹</span>
  </div>
  <div class="chart-card" id="chart-container">
    <div style="position:relative;height:280px;width:100%;">
      <canvas id="mainChart"></canvas>
    </div>
    <div class="chart-hint">ğŸ’¡ ãƒ›ãƒãƒ¼ã§è©³ç´°è¡¨ç¤º</div>
  </div>

  <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¼ -->
  <div class="section-title">éƒ¨é–€åˆ¥ æ–°å…¥é™¢æ‚£è€… é”æˆçŠ¶æ³</div>

  <!-- è¨ºç™‚ç§‘ / ç—…æ£Ÿ åˆ‡æ›¿ -->
  <div class="view-toggle">
    <button class="view-btn active" id="vbtn-dept" onclick="switchView('dept')">ğŸ· è¨ºç™‚ç§‘åˆ¥</button>
    <button class="view-btn" id="vbtn-ward" onclick="switchView('ward')">ğŸ¨ ç—…æ£Ÿåˆ¥</button>
  </div>

  <!-- ã‚¿ãƒ– -->
  <div class="tab-bar">
    <button class="tab-btn active" id="tbtn-7"   onclick="switchTab('7')">
      ç›´è¿‘7æ—¥<br><small id="lbl-7"></small>
    </button>
    <button class="tab-btn" id="tbtn-28"  onclick="switchTab('28')">
      ç›´è¿‘28æ—¥<br><small id="lbl-28"></small>
    </button>
    <button class="tab-btn" id="tbtn-fy" onclick="switchTab('fy')">
      ä»Šå¹´åº¦<br><small id="lbl-fy"></small>
    </button>
  </div>

  <div class="perf-section" id="perf-dept">
    <div class="perf-panel active" id="dept-7"></div>
    <div class="perf-panel"        id="dept-28"></div>
    <div class="perf-panel"        id="dept-fy"></div>
  </div>
  <div class="perf-section" id="perf-ward" style="display:none">
    <div class="perf-panel active" id="ward-7"></div>
    <div class="perf-panel"        id="ward-28"></div>
    <div class="perf-panel"        id="ward-fy"></div>
  </div>

  <div class="perf-legend">
    <span>ğŸ”µãƒ•ãƒ¬ãƒ¼ãƒ  = é€±æ¬¡ç›®æ¨™ãƒ©ã‚¤ãƒ³</span>
    <span style="color:#065F46">â–  â‰¥100%</span>
    <span style="color:#92400E">â–  80ã€œ99%</span>
    <span style="color:#991B1B">â–  &lt;80%</span>
  </div>

</div><!-- /wrap -->

<script>
// ===== åŸ‹ã‚è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ =====
const DATA = {"kpi": {"target_weekly": 385.0, "fy_avg": 356.1, "fy_rate": 92.5, "actual_7d": 338, "rate_7d": 87.8, "prev_avg": 343.7, "fy_year": "2025å¹´åº¦", "prev_year": "2024å¹´åº¦"}, "chart": [{"d": "2025-09-01", "v": 77, "ma": 51.86}, {"d": "2025-09-02", "v": 65, "ma": 51.64}, {"d": "2025-09-03", "v": 59, "ma": 51.61}, {"d": "2025-09-04", "v": 61, "ma": 51.07}, {"d": "2025-09-05", "v": 45, "ma": 51.64}, {"d": "2025-09-06", "v": 17, "ma": 51.5}, {"d": "2025-09-07", "v": 37, "ma": 52.29}, {"d": "2025-09-08", "v": 68, "ma": 53.21}, {"d": "2025-09-09", "v": 87, "ma": 53.07}, {"d": "2025-09-10", "v": 55, "ma": 52.46}, {"d": "2025-09-11", "v": 67, "ma": 52.75}, {"d": "2025-09-12", "v": 31, "ma": 51.86}, {"d": "2025-09-13", "v": 16, "ma": 51.68}, {"d": "2025-09-14", "v": 16, "ma": 50.93}, {"d": "2025-09-15", "v": 51, "ma": 50.14}, {"d": "2025-09-16", "v": 87, "ma": 50.82}, {"d": "2025-09-17", "v": 82, "ma": 51.36}, {"d": "2025-09-18", "v": 71, "ma": 51.32}, {"d": "2025-09-19", "v": 35, "ma": 51.64}, {"d": "2025-09-20", "v": 20, "ma": 52.0}, {"d": "2025-09-21", "v": 32, "ma": 51.93}, {"d": "2025-09-22", "v": 35, "ma": 50.14}, {"d": "2025-09-23", "v": 48, "ma": 49.39}, {"d": "2025-09-24", "v": 64, "ma": 49.21}, {"d": "2025-09-25", "v": 61, "ma": 49.36}, {"d": "2025-09-26", "v": 40, "ma": 49.21}, {"d": "2025-09-27", "v": 18, "ma": 49.18}, {"d": "2025-09-28", "v": 39, "ma": 49.43}, {"d": "2025-09-29", "v": 79, "ma": 49.5}, {"d": "2025-09-30", "v": 59, "ma": 49.29}, {"d": "2025-10-01", "v": 72, "ma": 49.75}, {"d": "2025-10-02", "v": 56, "ma": 49.57}, {"d": "2025-10-03", "v": 43, "ma": 49.5}, {"d": "2025-10-04", "v": 17, "ma": 49.5}, {"d": "2025-10-05", "v": 38, "ma": 49.54}, {"d": "2025-10-06", "v": 84, "ma": 50.11}, {"d": "2025-10-07", "v": 66, "ma": 49.36}, {"d": "2025-10-08", "v": 56, "ma": 49.39}, {"d": "2025-10-09", "v": 62, "ma": 49.21}, {"d": "2025-10-10", "v": 30, "ma": 49.18}, {"d": "2025-10-11", "v": 21, "ma": 49.36}, {"d": "2025-10-12", "v": 18, "ma": 49.43}, {"d": "2025-10-13", "v": 40, "ma": 49.04}, {"d": "2025-10-14", "v": 73, "ma": 48.54}, {"d": "2025-10-15", "v": 75, "ma": 48.29}, {"d": "2025-10-16", "v": 52, "ma": 47.61}, {"d": "2025-10-17", "v": 36, "ma": 47.64}, {"d": "2025-10-18", "v": 20, "ma": 47.64}, {"d": "2025-10-19", "v": 40, "ma": 47.93}, {"d": "2025-10-20", "v": 86, "ma": 49.75}, {"d": "2025-10-21", "v": 65, "ma": 50.36}, {"d": "2025-10-22", "v": 60, "ma": 50.21}, {"d": "2025-10-23", "v": 56, "ma": 50.04}, {"d": "2025-10-24", "v": 42, "ma": 50.11}, {"d": "2025-10-25", "v": 19, "ma": 50.14}, {"d": "2025-10-26", "v": 46, "ma": 50.39}, {"d": "2025-10-27", "v": 80, "ma": 50.43}, {"d": "2025-10-28", "v": 68, "ma": 50.75}, {"d": "2025-10-29", "v": 66, "ma": 50.54}, {"d": "2025-10-30", "v": 47, "ma": 50.21}, {"d": "2025-10-31", "v": 45, "ma": 50.29}, {"d": "2025-11-01", "v": 19, "ma": 50.36}, {"d": "2025-11-02", "v": 27, "ma": 49.96}, {"d": "2025-11-03", "v": 46, "ma": 48.61}, {"d": "2025-11-04", "v": 79, "ma": 49.07}, {"d": "2025-11-05", "v": 74, "ma": 49.71}, {"d": "2025-11-06", "v": 67, "ma": 49.89}, {"d": "2025-11-07", "v": 47, "ma": 50.5}, {"d": "2025-11-08", "v": 17, "ma": 50.36}, {"d": "2025-11-09", "v": 43, "ma": 51.25}, {"d": "2025-11-10", "v": 82, "ma": 52.75}, {"d": "2025-11-11", "v": 64, "ma": 52.43}, {"d": "2025-11-12", "v": 64, "ma": 52.04}, {"d": "2025-11-13", "v": 74, "ma": 52.82}, {"d": "2025-11-14", "v": 32, "ma": 52.68}, {"d": "2025-11-15", "v": 18, "ma": 52.61}, {"d": "2025-11-16", "v": 39, "ma": 52.57}, {"d": "2025-11-17", "v": 86, "ma": 52.57}, {"d": "2025-11-18", "v": 61, "ma": 52.43}, {"d": "2025-11-19", "v": 69, "ma": 52.75}, {"d": "2025-11-20", "v": 58, "ma": 52.82}, {"d": "2025-11-21", "v": 44, "ma": 52.89}, {"d": "2025-11-22", "v": 17, "ma": 52.82}, {"d": "2025-11-23", "v": 27, "ma": 52.14}, {"d": "2025-11-24", "v": 45, "ma": 50.89}, {"d": "2025-11-25", "v": 86, "ma": 51.54}, {"d": "2025-11-26", "v": 61, "ma": 51.36}, {"d": "2025-11-27", "v": 78, "ma": 52.46}, {"d": "2025-11-28", "v": 48, "ma": 52.57}, {"d": "2025-11-29", "v": 21, "ma": 52.64}, {"d": "2025-11-30", "v": 45, "ma": 53.29}, {"d": "2025-12-01", "v": 76, "ma": 54.36}, {"d": "2025-12-02", "v": 58, "ma": 53.61}, {"d": "2025-12-03", "v": 55, "ma": 52.93}, {"d": "2025-12-04", "v": 56, "ma": 52.54}, {"d": "2025-12-05", "v": 53, "ma": 52.75}, {"d": "2025-12-06", "v": 19, "ma": 52.82}, {"d": "2025-12-07", "v": 34, "ma": 52.5}, {"d": "2025-12-08", "v": 80, "ma": 52.43}, {"d": "2025-12-09", "v": 62, "ma": 52.36}, {"d": "2025-12-10", "v": 57, "ma": 52.11}, {"d": "2025-12-11", "v": 72, "ma": 52.04}, {"d": "2025-12-12", "v": 56, "ma": 52.89}, {"d": "2025-12-13", "v": 20, "ma": 52.96}, {"d": "2025-12-14", "v": 37, "ma": 52.89}, {"d": "2025-12-15", "v": 82, "ma": 52.75}, {"d": "2025-12-16", "v": 58, "ma": 52.64}, {"d": "2025-12-17", "v": 68, "ma": 52.61}, {"d": "2025-12-18", "v": 63, "ma": 52.79}, {"d": "2025-12-19", "v": 46, "ma": 52.86}, {"d": "2025-12-20", "v": 15, "ma": 52.79}, {"d": "2025-12-21", "v": 50, "ma": 53.61}, {"d": "2025-12-22", "v": 69, "ma": 54.46}, {"d": "2025-12-23", "v": 77, "ma": 54.14}, {"d": "2025-12-24", "v": 58, "ma": 54.04}, {"d": "2025-12-25", "v": 61, "ma": 53.43}, {"d": "2025-12-26", "v": 43, "ma": 53.25}, {"d": "2025-12-27", "v": 19, "ma": 53.18}, {"d": "2025-12-28", "v": 27, "ma": 52.54}, {"d": "2025-12-29", "v": 30, "ma": 50.89}, {"d": "2025-12-30", "v": 21, "ma": 49.57}, {"d": "2025-12-31", "v": 17, "ma": 48.21}, {"d": "2026-01-01", "v": 19, "ma": 46.89}, {"d": "2026-01-02", "v": 36, "ma": 46.29}, {"d": "2026-01-03", "v": 28, "ma": 46.61}, {"d": "2026-01-04", "v": 43, "ma": 46.93}, {"d": "2026-01-05", "v": 71, "ma": 46.61}, {"d": "2026-01-06", "v": 66, "ma": 46.75}, {"d": "2026-01-07", "v": 75, "ma": 47.39}, {"d": "2026-01-08", "v": 79, "ma": 47.64}, {"d": "2026-01-09", "v": 42, "ma": 47.14}, {"d": "2026-01-10", "v": 24, "ma": 47.29}, {"d": "2026-01-11", "v": 20, "ma": 46.68}, {"d": "2026-01-12", "v": 47, "ma": 45.43}, {"d": "2026-01-13", "v": 78, "ma": 46.14}, {"d": "2026-01-14", "v": 64, "ma": 46.0}, {"d": "2026-01-15", "v": 81, "ma": 46.64}, {"d": "2026-01-16", "v": 35, "ma": 46.25}, {"d": "2026-01-17", "v": 19, "ma": 46.39}, {"d": "2026-01-18", "v": 36, "ma": 45.89}, {"d": "2026-01-19", "v": 86, "ma": 46.5}, {"d": "2026-01-20", "v": 67, "ma": 46.14}, {"d": "2026-01-21", "v": 62, "ma": 46.29}, {"d": "2026-01-22", "v": 66, "ma": 46.46}, {"d": "2026-01-23", "v": 52, "ma": 46.79}, {"d": "2026-01-24", "v": 15, "ma": 46.64}, {"d": "2026-01-25", "v": 42, "ma": 47.18}, {"d": "2026-01-26", "v": 74, "ma": 48.75}, {"d": "2026-01-27", "v": 57, "ma": 50.04}, {"d": "2026-01-28", "v": 67, "ma": 51.82}, {"d": "2026-01-29", "v": 62, "ma": 53.36}, {"d": "2026-01-30", "v": 51, "ma": 53.89}, {"d": "2026-01-31", "v": 16, "ma": 53.46}, {"d": "2026-02-01", "v": 33, "ma": 53.11}, {"d": "2026-02-02", "v": 79, "ma": 53.39}, {"d": "2026-02-03", "v": 78, "ma": 53.82}, {"d": "2026-02-04", "v": 65, "ma": 53.46}, {"d": "2026-02-05", "v": 58, "ma": 52.71}, {"d": "2026-02-06", "v": 51, "ma": 53.04}, {"d": "2026-02-07", "v": 15, "ma": 52.71}, {"d": "2026-02-08", "v": 39, "ma": 53.39}, {"d": "2026-02-09", "v": 87, "ma": 54.82}, {"d": "2026-02-10", "v": 45, "ma": 53.64}, {"d": "2026-02-11", "v": 40, "ma": 52.79}, {"d": "2026-02-12", "v": 74, "ma": 52.54}, {"d": "2026-02-13", "v": 35, "ma": 52.54}, {"d": "2026-02-14", "v": 15, "ma": 52.39}, {"d": "2026-02-15", "v": 42, "ma": 52.61}], "chart_axis": {"yMin": 40, "yMax": 65}, "perf": {"dept": {"7": [{"name": "å‘¼å¸å™¨å¤–ç§‘", "actual": 4.0, "target": 2.8, "rate": 142.9}, {"name": "å½¢æˆå¤–ç§‘", "actual": 4.0, "target": 3.0, "rate": 133.3}, {"name": "çœ¼ç§‘", "actual": 22.0, "target": 17.5, "rate": 125.7}, {"name": "æ•´å½¢å¤–ç§‘", "actual": 29.0, "target": 24.2, "rate": 119.8}, {"name": "ãƒªã‚¦ãƒãƒè† åŸç—…å†…ç§‘", "actual": 4.0, "target": 3.5, "rate": 114.3}, {"name": "çš®è†šç§‘", "actual": 4.0, "target": 3.5, "rate": 114.3}, {"name": "å‘¼å¸å™¨å†…ç§‘", "actual": 17.0, "target": 15.0, "rate": 113.3}, {"name": "ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘", "actual": 24.0, "target": 21.2, "rate": 113.2}, {"name": "æ•‘æ€¥ç§‘", "actual": 33.0, "target": 32.8, "rate": 100.6}, {"name": "æ¶ˆåŒ–å™¨å†…ç§‘", "actual": 21.0, "target": 21.9, "rate": 95.9}, {"name": "æ­¯ç§‘å£è…”å¤–ç§‘", "actual": 4.0, "target": 4.3, "rate": 93.0}, {"name": "ç·åˆå†…ç§‘", "actual": 45.0, "target": 50.8, "rate": 88.6}, {"name": "ç”£å©¦äººç§‘", "actual": 27.0, "target": 30.5, "rate": 88.5}, {"name": "æ³Œå°¿å™¨ç§‘", "actual": 27.0, "target": 30.5, "rate": 88.5}, {"name": "è…å†…ç§‘", "actual": 7.0, "target": 9.0, "rate": 77.8}, {"name": "å¾ªç’°å™¨å†…ç§‘", "actual": 19.0, "target": 24.9, "rate": 76.3}, {"name": "è¡€æ¶²å†…ç§‘", "actual": 6.0, "target": 8.1, "rate": 74.1}, {"name": "å°å…ç§‘", "actual": 20.0, "target": 27.7, "rate": 72.2}, {"name": "è€³é¼»å’½å–‰ç§‘", "actual": 9.0, "target": 12.9, "rate": 69.8}, {"name": "ä¹³è…ºå¤–ç§‘", "actual": 8.0, "target": 14.3, "rate": 55.9}, {"name": "è„³ç¥çµŒå†…ç§‘", "actual": 2.0, "target": 3.7, "rate": 54.1}, {"name": "è„³ç¥çµŒå¤–ç§‘", "actual": 2.0, "target": 4.2, "rate": 47.6}, {"name": "å¿ƒè‡“è¡€ç®¡å¤–ç§‘", "actual": 0.0, "target": 2.8, "rate": 0.0}], "28": [{"name": "çœ¼ç§‘", "actual": 25.2, "target": 17.5, "rate": 144.3}, {"name": "æ•´å½¢å¤–ç§‘", "actual": 32.0, "target": 24.2, "rate": 132.2}, {"name": "ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘", "actual": 25.8, "target": 21.2, "rate": 121.5}, {"name": "çš®è†šç§‘", "actual": 4.0, "target": 3.5, "rate": 114.3}, {"name": "æ­¯ç§‘å£è…”å¤–ç§‘", "actual": 4.8, "target": 4.3, "rate": 110.5}, {"name": "è¡€æ¶²å†…ç§‘", "actual": 8.8, "target": 8.1, "rate": 108.0}, {"name": "å‘¼å¸å™¨å¤–ç§‘", "actual": 3.0, "target": 2.8, "rate": 107.1}, {"name": "ç·åˆå†…ç§‘", "actual": 52.5, "target": 50.8, "rate": 103.3}, {"name": "æ•‘æ€¥ç§‘", "actual": 33.8, "target": 32.8, "rate": 102.9}, {"name": "æ¶ˆåŒ–å™¨å†…ç§‘", "actual": 22.2, "target": 21.9, "rate": 101.6}, {"name": "æ³Œå°¿å™¨ç§‘", "actual": 29.5, "target": 30.5, "rate": 96.7}, {"name": "ãƒªã‚¦ãƒãƒè† åŸç—…å†…ç§‘", "actual": 3.2, "target": 3.5, "rate": 92.9}, {"name": "å½¢æˆå¤–ç§‘", "actual": 2.8, "target": 3.0, "rate": 91.7}, {"name": "å‘¼å¸å™¨å†…ç§‘", "actual": 13.5, "target": 15.0, "rate": 90.0}, {"name": "ç”£å©¦äººç§‘", "actual": 27.2, "target": 30.5, "rate": 89.3}, {"name": "è„³ç¥çµŒå¤–ç§‘", "actual": 3.8, "target": 4.2, "rate": 89.3}, {"name": "å¾ªç’°å™¨å†…ç§‘", "actual": 22.0, "target": 24.9, "rate": 88.4}, {"name": "å°å…ç§‘", "actual": 24.0, "target": 27.7, "rate": 86.6}, {"name": "è€³é¼»å’½å–‰ç§‘", "actual": 10.8, "target": 12.9, "rate": 83.3}, {"name": "è…å†…ç§‘", "actual": 7.2, "target": 9.0, "rate": 80.6}, {"name": "ä¹³è…ºå¤–ç§‘", "actual": 9.2, "target": 14.3, "rate": 64.7}, {"name": "è„³ç¥çµŒå†…ç§‘", "actual": 2.0, "target": 3.7, "rate": 54.1}, {"name": "å¿ƒè‡“è¡€ç®¡å¤–ç§‘", "actual": 1.0, "target": 2.8, "rate": 35.7}], "fy": [{"name": "è¡€æ¶²å†…ç§‘", "actual": 10.6, "target": 8.1, "rate": 130.3}, {"name": "å½¢æˆå¤–ç§‘", "actual": 3.5, "target": 3.0, "rate": 117.0}, {"name": "çœ¼ç§‘", "actual": 20.1, "target": 17.5, "rate": 115.0}, {"name": "æ•´å½¢å¤–ç§‘", "actual": 27.7, "target": 24.2, "rate": 114.5}, {"name": "ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘", "actual": 22.3, "target": 21.2, "rate": 105.2}, {"name": "çš®è†šç§‘", "actual": 3.6, "target": 3.5, "rate": 104.0}, {"name": "æ¶ˆåŒ–å™¨å†…ç§‘", "actual": 22.6, "target": 21.9, "rate": 103.1}, {"name": "å‘¼å¸å™¨å†…ç§‘", "actual": 15.1, "target": 15.0, "rate": 100.9}, {"name": "ç”£å©¦äººç§‘", "actual": 30.7, "target": 30.5, "rate": 100.7}, {"name": "ç·åˆå†…ç§‘", "actual": 50.6, "target": 50.8, "rate": 99.7}, {"name": "ãƒªã‚¦ãƒãƒè† åŸç—…å†…ç§‘", "actual": 3.2, "target": 3.5, "rate": 92.8}, {"name": "æ•‘æ€¥ç§‘", "actual": 30.0, "target": 32.8, "rate": 91.3}, {"name": "å¾ªç’°å™¨å†…ç§‘", "actual": 22.7, "target": 24.9, "rate": 91.3}, {"name": "å‘¼å¸å™¨å¤–ç§‘", "actual": 2.5, "target": 2.8, "rate": 89.6}, {"name": "æ­¯ç§‘å£è…”å¤–ç§‘", "actual": 3.8, "target": 4.3, "rate": 88.7}, {"name": "è„³ç¥çµŒå¤–ç§‘", "actual": 3.7, "target": 4.2, "rate": 88.3}, {"name": "å°å…ç§‘", "actual": 24.1, "target": 27.7, "rate": 87.0}, {"name": "æ³Œå°¿å™¨ç§‘", "actual": 26.4, "target": 30.5, "rate": 86.4}, {"name": "è…å†…ç§‘", "actual": 7.5, "target": 9.0, "rate": 82.9}, {"name": "ä¹³è…ºå¤–ç§‘", "actual": 11.4, "target": 14.3, "rate": 80.1}, {"name": "è€³é¼»å’½å–‰ç§‘", "actual": 10.2, "target": 12.9, "rate": 78.9}, {"name": "è„³ç¥çµŒå†…ç§‘", "actual": 2.5, "target": 3.7, "rate": 67.2}, {"name": "å¿ƒè‡“è¡€ç®¡å¤–ç§‘", "actual": 1.2, "target": 2.8, "rate": 42.1}]}, "ward": {"7": [{"name": "9éšBç—…æ£Ÿ", "actual": 31.0, "target": 23.0, "rate": 134.8}, {"name": "7éšBç—…æ£Ÿ", "actual": 52.0, "target": 44.0, "rate": 118.2}, {"name": "6éšAç—…æ£Ÿ", "actual": 34.0, "target": 29.0, "rate": 117.2}, {"name": "4éšCç—…æ£Ÿ", "actual": 35.0, "target": 31.0, "rate": 112.9}, {"name": "5éšAç—…æ£Ÿ", "actual": 53.0, "target": 49.0, "rate": 108.2}, {"name": "6éšBç—…æ£Ÿ", "actual": 35.0, "target": 33.0, "rate": 106.1}, {"name": "5éšBç—…æ£Ÿ", "actual": 38.0, "target": 40.0, "rate": 95.0}, {"name": "4éšAç—…æ£Ÿ", "actual": 24.0, "target": 27.0, "rate": 88.9}, {"name": "9éšAç—…æ£Ÿ", "actual": 16.0, "target": 19.0, "rate": 84.2}, {"name": "3éšAç—…æ£Ÿ", "actual": 33.0, "target": 41.0, "rate": 80.5}, {"name": "2éšBç—…æ£Ÿ", "actual": 18.0, "target": 23.0, "rate": 78.3}, {"name": "2éšAç—…æ£Ÿ", "actual": 30.0, "target": 39.0, "rate": 76.9}, {"name": "8éšAç—…æ£Ÿ", "actual": 16.0, "target": 21.0, "rate": 76.2}, {"name": "8éšBç—…æ£Ÿ", "actual": 19.0, "target": 27.0, "rate": 70.4}, {"name": "7éšAç—…æ£Ÿ", "actual": 23.0, "target": 34.0, "rate": 67.6}, {"name": "4B-HCU", "actual": 15.0, "target": 30.0, "rate": 50.0}, {"name": "4B-ICU", "actual": 7.0, "target": 30.0, "rate": 23.3}], "28": [{"name": "6éšAç—…æ£Ÿ", "actual": 34.8, "target": 29.0, "rate": 119.8}, {"name": "8éšAç—…æ£Ÿ", "actual": 25.0, "target": 21.0, "rate": 119.0}, {"name": "7éšBç—…æ£Ÿ", "actual": 50.8, "target": 44.0, "rate": 115.3}, {"name": "4éšCç—…æ£Ÿ", "actual": 34.5, "target": 31.0, "rate": 111.3}, {"name": "5éšAç—…æ£Ÿ", "actual": 52.2, "target": 49.0, "rate": 106.6}, {"name": "4éšAç—…æ£Ÿ", "actual": 28.8, "target": 27.0, "rate": 106.5}, {"name": "6éšBç—…æ£Ÿ", "actual": 34.5, "target": 33.0, "rate": 104.5}, {"name": "5éšBç—…æ£Ÿ", "actual": 41.8, "target": 40.0, "rate": 104.4}, {"name": "9éšBç—…æ£Ÿ", "actual": 24.0, "target": 23.0, "rate": 104.3}, {"name": "3éšAç—…æ£Ÿ", "actual": 41.8, "target": 41.0, "rate": 101.8}, {"name": "7éšAç—…æ£Ÿ", "actual": 32.2, "target": 34.0, "rate": 94.9}, {"name": "9éšAç—…æ£Ÿ", "actual": 17.8, "target": 19.0, "rate": 93.4}, {"name": "2éšBç—…æ£Ÿ", "actual": 21.0, "target": 23.0, "rate": 91.3}, {"name": "2éšAç—…æ£Ÿ", "actual": 35.0, "target": 39.0, "rate": 89.7}, {"name": "8éšBç—…æ£Ÿ", "actual": 20.5, "target": 27.0, "rate": 75.9}, {"name": "4B-HCU", "actual": 18.0, "target": 30.0, "rate": 60.0}, {"name": "4B-ICU", "actual": 10.5, "target": 30.0, "rate": 35.0}], "fy": [{"name": "7éšBç—…æ£Ÿ", "actual": 49.8, "target": 44.0, "rate": 113.2}, {"name": "9éšBç—…æ£Ÿ", "actual": 24.7, "target": 23.0, "rate": 107.4}, {"name": "8éšAç—…æ£Ÿ", "actual": 22.5, "target": 21.0, "rate": 107.0}, {"name": "6éšAç—…æ£Ÿ", "actual": 30.5, "target": 29.0, "rate": 105.3}, {"name": "5éšAç—…æ£Ÿ", "actual": 51.0, "target": 49.0, "rate": 104.0}, {"name": "3éšAç—…æ£Ÿ", "actual": 42.3, "target": 41.0, "rate": 103.2}, {"name": "4éšCç—…æ£Ÿ", "actual": 31.3, "target": 31.0, "rate": 100.9}, {"name": "9éšAç—…æ£Ÿ", "actual": 19.0, "target": 19.0, "rate": 99.9}, {"name": "2éšBç—…æ£Ÿ", "actual": 22.9, "target": 23.0, "rate": 99.6}, {"name": "4éšAç—…æ£Ÿ", "actual": 26.9, "target": 27.0, "rate": 99.6}, {"name": "6éšBç—…æ£Ÿ", "actual": 32.1, "target": 33.0, "rate": 97.3}, {"name": "5éšBç—…æ£Ÿ", "actual": 38.3, "target": 40.0, "rate": 95.8}, {"name": "7éšAç—…æ£Ÿ", "actual": 30.7, "target": 34.0, "rate": 90.4}, {"name": "2éšAç—…æ£Ÿ", "actual": 33.2, "target": 39.0, "rate": 85.1}, {"name": "8éšBç—…æ£Ÿ", "actual": 17.9, "target": 27.0, "rate": 66.1}, {"name": "4B-ICU", "actual": 17.2, "target": 30.0, "rate": 57.2}, {"name": "4B-HCU", "actual": 14.0, "target": 30.0, "rate": 46.8}]}}, "meta": {"date_min": "2024-01-01", "date_max": "2026-02-15", "d7_from": "2026-02-09", "d28_from": "2026-01-19", "fy_from": "2025-04-01", "fy_year": "2025å¹´åº¦", "prev_year": "2024å¹´åº¦", "chart_from": "2025-09-01", "prev_avg_source": "data"}};

// ===== KPI æç”»ï¼ˆB+Cåˆä½“ï¼šã‚¢ã‚¤ã‚³ãƒ³ï¼‹å·¦ãƒœãƒ¼ãƒ€ãƒ¼ï¼‹ã‚²ãƒ¼ã‚¸ãƒãƒ¼ï¼‰ =====
function renderKPI() {
  const k = DATA.kpi;
  const grid = document.getElementById('kpi-grid');

  function card(label, value, sub, cls, icon, gaugePct, gaugeLabel) {
    const pctW = Math.min(gaugePct, 100).toFixed(1);
    const gaugeCls = gaugePct === null ? '' : cls;
    const gaugeHtml = gaugePct !== null ? `
      <div class="kpi-gauge-wrap"><div class="kpi-gauge-fill ${gaugeCls}" style="width:${pctW}%"></div></div>
      <div class="kpi-gauge-pct" style="color:${gaugeCls==='success'?'var(--success)':gaugeCls==='warn'?'var(--warning)':gaugeCls==='danger'?'var(--danger)':'#94A3B8'}">${gaugeLabel}</div>
    ` : '';
    return `
      <div class="kpi-card ${cls}">
        <div class="kpi-card-header">
          <div class="kpi-label">${label}</div>
          <div class="kpi-icon">${icon}</div>
        </div>
        <div class="kpi-value ${cls}">${value}</div>
        <div class="kpi-sub">${sub}</div>
        ${gaugeHtml}
      </div>`;
  }

  const fyIcon    = k.fy_avg  >= k.target_weekly ? 'âœ…' : (k.fy_avg  >= k.target_weekly * 0.8 ? 'âš ï¸' : 'ğŸ”´');
  const rateIcon  = k.fy_rate >= 100             ? 'âœ…' : (k.fy_rate >= 80                    ? 'âš ï¸' : 'ğŸ”´');
  const d7Icon    = k.actual_7d >= k.target_weekly ? 'âœ…' : (k.actual_7d >= k.target_weekly * 0.8 ? 'âš ï¸' : 'ğŸ”´');
  const r7Icon    = k.rate_7d >= 100              ? 'âœ…' : (k.rate_7d  >= 80                     ? 'âš ï¸' : 'ğŸ”´');

  const fyCls  = k.fy_avg  >= k.target_weekly ? 'success' : (k.fy_avg  >= k.target_weekly * 0.8 ? 'warn' : 'danger');
  const rateCls= k.fy_rate >= 100             ? 'success' : (k.fy_rate >= 80                    ? 'warn' : 'danger');
  const d7Cls  = k.actual_7d >= k.target_weekly ? 'success' : (k.actual_7d >= k.target_weekly * 0.8 ? 'warn' : 'danger');
  const r7Cls  = k.rate_7d >= 100              ? 'success' : (k.rate_7d  >= 80                     ? 'warn' : 'danger');

  const prevRatio = k.prev_avg ? ((k.fy_avg / k.prev_avg) * 100).toFixed(1) + '%' : 'â€•';

  grid.innerHTML = [
    card(k.fy_year + 'ï¼ˆé€±å¹³å‡ï¼‰',
         k.fy_avg.toFixed(1) + ' äºº',
         'ç›®æ¨™ ' + k.target_weekly + ' äºº/é€±',
         fyCls, fyIcon,
         k.fy_avg / k.target_weekly * 100,
         k.fy_avg.toFixed(1) + ' / ' + k.target_weekly + ' äºº/é€±'),

    card(k.fy_year + ' é”æˆç‡',
         k.fy_rate.toFixed(1) + '%',
         k.fy_avg.toFixed(1) + ' / ' + k.target_weekly + ' äºº/é€±',
         rateCls, rateIcon,
         k.fy_rate,
         k.fy_rate.toFixed(1) + '%'),

    card('ç›´è¿‘7æ—¥ åˆè¨ˆ',
         k.actual_7d + ' äºº',
         'ç›®æ¨™æ›ç®— ' + k.target_weekly + ' äºº/é€±',
         d7Cls, d7Icon,
         k.actual_7d / k.target_weekly * 100,
         (k.actual_7d / k.target_weekly * 100).toFixed(1) + '%'),

    card('ç›´è¿‘7æ—¥ é”æˆç‡',
         k.rate_7d.toFixed(1) + '%',
         'æ—¥å¹³å‡ ' + (k.actual_7d / 7).toFixed(1) + ' äºº/æ—¥',
         r7Cls, r7Icon,
         k.rate_7d,
         k.rate_7d.toFixed(1) + '%'),

    card((k.prev_year || 'æ˜¨å¹´åº¦') + 'ï¼ˆé€±å¹³å‡ï¼‰',
         k.prev_avg !== null ? k.prev_avg.toFixed(1) + ' äºº' : 'â€•',
         k.prev_avg !== null ? 'å‰å¹´æ¯” ' + prevRatio : 'ãƒ‡ãƒ¼ã‚¿æœªå…¥åŠ›',
         'flat', 'â€•',
         k.prev_avg !== null ? k.prev_avg / k.target_weekly * 100 : null,
         k.prev_avg !== null ? (k.prev_avg / k.target_weekly * 100).toFixed(1) + '%' : ''),
  ].join('');
}

// ===== æ¨ç§»ã‚°ãƒ©ãƒ• =====
let chartOpen = true;
function toggleChart() {
  chartOpen = !chartOpen;
  document.getElementById('chart-container').style.display = chartOpen ? '' : 'none';
  document.getElementById('chart-toggle-icon').textContent = chartOpen ? 'â–² é–‰ã˜ã‚‹' : 'â–¼ é–‹ã';
}

function renderChart() {
  const cd     = DATA.chart;
  const tgt    = DATA.kpi.target_weekly / 7;
  const yMin   = DATA.chart_axis.yMin;
  const yMax   = DATA.chart_axis.yMax;
  const labels = cd.map(d => d.d.slice(5).replace('-', '/'));

  const canvas = document.getElementById('mainChart');

  const datasets = [
    {
      label: '28æ—¥ç§»å‹•å¹³å‡',
      data: cd.map(d => d.ma),
      borderColor: '#1D4ED8',
      backgroundColor: 'rgba(29,78,216,0.08)',
      borderWidth: 3,
      pointRadius: 0,
      pointHoverRadius: 4,
      fill: true,
      tension: 0.3
    },
    {
      label: 'ç›®æ¨™ ' + DATA.kpi.target_weekly + 'äºº/é€±',
      data: Array(cd.length).fill(tgt),
      borderColor: '#EF4444',
      borderDash: [6, 4],
      borderWidth: 2,
      pointRadius: 0,
      fill: false
    }
  ];

  // å‰å¹´åº¦é€±å¹³å‡ãƒ©ã‚¤ãƒ³ã‚’è¿½åŠ ï¼ˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
  if (DATA.kpi.prev_avg !== null) {
    datasets.push({
      label: DATA.kpi.prev_year + ' ' + DATA.kpi.prev_avg + 'äºº/é€±',
      data: Array(cd.length).fill(DATA.kpi.prev_avg / 7),
      borderColor: '#F59E0B',
      borderDash: [3, 3],
      borderWidth: 2,
      pointRadius: 0,
      fill: false
    });
  }

  new Chart(canvas, {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: true, position: 'top', labels: { usePointStyle: true, padding: 14, font: { size: 11 } } },
        tooltip: { backgroundColor: 'rgba(15,23,42,0.88)', padding: 10, bodyFont: { size: 12 } }
      },
      scales: {
        x: { ticks: { font: { size: 10 }, maxRotation: 45, maxTicksLimit: 24 }, grid: { display: false } },
        y: {
          min: yMin,
          max: yMax,
          ticks: { font: { size: 11 } },
          grid: { color: 'rgba(0,0,0,0.05)' }
        }
      }
    }
  });
}

// ===== ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¼ HTML ç”Ÿæˆ =====
function buildPerfRows(rows) {
  if (!rows || rows.length === 0) return '<p style="color:#9CA3AF;font-size:0.82rem;">ãƒ‡ãƒ¼ã‚¿ãªã—</p>';
  const maxAct = Math.max(...rows.map(r => r.actual), ...rows.map(r => r.target), 1);
  return rows.map(r => {
    const cls = r.rate >= 100 ? 'achieved' : (r.rate >= 80 ? 'near' : 'below');
    const badge = r.rate >= 100 ? 'âœ…' : (r.rate >= 80 ? 'ğŸŸ¡' : 'ğŸ”´');
    const fillPct = Math.min(r.actual / maxAct * 100, 100).toFixed(1);
    const tgtPct  = Math.min(r.target / maxAct * 100, 100).toFixed(1);
    return `<div class="perf-row">
      <div class="perf-name ${cls}" title="${r.name}">${r.name}</div>
      <div class="perf-nums">${r.actual}äºº / ç›®æ¨™${r.target}äºº</div>
      <div class="perf-bar-wrap">
        <div class="perf-bar-fill ${cls}" style="width:${fillPct}%"></div>
        <div class="perf-target-line" style="left:0;width:${tgtPct}%"></div>
      </div>
      <div class="perf-rate">${r.rate}%</div>
      <div class="perf-badge">${badge}</div>
    </div>`;
  }).join('');
}

function renderPerf() {
  const p = DATA.perf;
  ['7','28','fy'].forEach(t => {
    document.getElementById('dept-'+t).innerHTML = buildPerfRows(p.dept[t]);
    document.getElementById('ward-'+t).innerHTML = buildPerfRows(p.ward[t]);
  });
}

// ===== ã‚¿ãƒ–ãƒ©ãƒ™ãƒ« =====
function setLabels() {
  const m = DATA.meta;
  document.getElementById('lbl-7').textContent  = m.d7_from  +' ã€œ '+ m.date_max;
  document.getElementById('lbl-28').textContent = m.d28_from +' ã€œ '+ m.date_max;
  document.getElementById('lbl-fy').textContent = m.fy_year  +' ('+ m.fy_from +' ã€œ '+ m.date_max +')';
}

// ===== åˆ‡æ›¿ =====
let currentView = 'dept';
let currentTab  = '7';

function switchView(v) {
  currentView = v;
  document.getElementById('perf-dept').style.display = v==='dept' ? '' : 'none';
  document.getElementById('perf-ward').style.display = v==='ward' ? '' : 'none';
  document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('vbtn-'+v).classList.add('active');
}

function switchTab(t) {
  currentTab = t;
  ['7','28','fy'].forEach(x => {
    const panels = document.querySelectorAll('#dept-'+x+', #ward-'+x);
    panels.forEach(p => p.classList.toggle('active', x===t));
    document.getElementById('tbtn-'+x).classList.toggle('active', x===t);
  });
}

// ===== åˆæœŸåŒ– =====
renderKPI();
renderChart();
renderPerf();
setLabels();
</script>
</body>
</html>
