
    <!DOCTYPE html>
    <html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ğŸ¥ è¨ºç™‚ç§‘åˆ¥é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆçµ±åˆç‰ˆï¼ˆä»Šå¹´åº¦ï¼‰</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
            :root { 
                --primary: #667eea; 
                --success: #10B981; 
                --danger: #EF4444;
                --info: #3B82F6; 
                --text: #1F2937; 
                --bg: #F3F4F6; 
            }
            * { box-sizing: border-box; margin: 0; padding: 0; }
            body { 
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                background: var(--bg); 
                color: var(--text); 
                line-height: 1.6;
            }
            .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
            
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
            .header { 
                background: white;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin-bottom: 20px;
                text-align: center;
            }
            .header h1 { 
                font-size: clamp(1.5rem, 4vw, 2.2rem);
                color: var(--primary);
                margin-bottom: 10px;
            }
            .header .period { 
                font-size: clamp(0.9rem, 2vw, 1.1rem);
                color: #6B7280;
                margin-bottom: 15px;
            }
            .portal-btn {
                display: inline-block;
                padding: 10px 20px;
                background: white;
                color: var(--primary);
                text-decoration: none;
                border: 2px solid var(--primary);
                border-radius: 8px;
                font-weight: bold;
                margin: 10px 5px;
                transition: all 0.3s;
            }
            .portal-btn:hover { background: var(--primary); color: white; }
            
            /* è¨ºç™‚ç§‘é¸æŠ */
            .dept-selector-area {
                background: white;
                padding: 20px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin-bottom: 20px;
            }
            .dept-selector-area h2 {
                font-size: 1.3rem;
                margin-bottom: 15px;
                color: var(--text);
            }
            #dept-selector {
                width: 100%;
                padding: 12px;
                font-size: 1.1rem;
                border: 2px solid #E5E7EB;
                border-radius: 8px;
                background: white;
                cursor: pointer;
                transition: border-color 0.3s;
            }
            #dept-selector:hover { border-color: var(--primary); }
            #dept-selector:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }
            
            /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
            .content-area {
                background: white;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                min-height: 600px;
            }
            .dept-fragment { 
                display: none; 
            }
            .dept-fragment.active { 
                display: block !important; 
            }
            
            /* è¨ºç™‚ç§‘ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
            .dept-header {
                text-align: center;
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 2px solid #E5E7EB;
            }
            .dept-header h2 {
                font-size: clamp(1.5rem, 4vw, 2rem);
                color: var(--primary);
                margin-bottom: 10px;
            }
            .dept-target {
                font-size: 1.2rem;
                color: #6B7280;
            }
            
            .summary-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 30px;
            }
            .summary-card {
                background: #F9FAFB;
                padding: 20px;
                border-radius: 8px;
                text-align: center;
                transition: transform 0.2s;
            }
            .summary-card:hover { transform: translateY(-2px); }
            .summary-card.alert {
                border: 2px solid var(--danger);
                background: #FEF2F2;
            }
            .metric-label {
                font-size: 0.9rem;
                color: #6B7280;
                margin-bottom: 8px;
            }
            .metric-value {
                font-size: clamp(1.5rem, 4vw, 2rem);
                font-weight: bold;
                color: var(--text);
            }
            .metric-value.success { color: var(--success); }
            .metric-value.danger { color: var(--danger); }
            
            .chart-container {
                position: relative;
                height: 500px;
                margin-top: 30px;
            }
            
            /* å¹´åº¦äºˆæ¸¬ã‚¢ãƒ©ãƒ¼ãƒˆ */
            .needed-alert {
                background: #FEF3C7;
                border: 1px solid #F59E0B;
                color: #92400E;
                padding: 10px 16px;
                border-radius: 8px;
                margin-bottom: 20px;
                font-size: 0.95rem;
            }
            .needed-ok {
                background: #D1FAE5;
                border: 1px solid #10B981;
                color: #065F46;
                padding: 10px 16px;
                border-radius: 8px;
                margin-bottom: 20px;
                font-size: 0.95rem;
            }
            
            /* ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ£’ã‚°ãƒ©ãƒ• */
            .perf-chart-area {
                background: white;
                padding: 20px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin-bottom: 20px;
            }
            .perf-chart-area h2 {
                font-size: 1.4rem;
                color: var(--primary);
                margin-bottom: 18px;
            }
            .perf-row {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 10px;
                min-height: 32px;
            }
            .perf-dept {
                width: 120px;
                font-size: 0.85rem;
                font-weight: 600;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                flex-shrink: 0;
                padding: 2px 8px;
                border-radius: 6px;
                text-align: center;
            }
            /* é”æˆåº¦åˆ¥ è¨ºç™‚ç§‘å èƒŒæ™¯è‰² */
            .perf-dept.achieved {
                background: #D1FAE5;
                color: #065F46;
            }
            .perf-dept.near {
                background: #FEF3C7;
                color: #92400E;
            }
            .perf-dept.below {
                background: #FEE2E2;
                color: #991B1B;
            }
            .perf-act-tgt {
                width: 150px;
                font-size: 0.8rem;
                color: #6B7280;
                flex-shrink: 0;
                text-align: right;
            }
            .perf-bar-wrap {
                flex: 1;
                height: 18px;
                background: transparent;   /* ã‚°ãƒ¬ãƒ¼èƒŒæ™¯ã‚’å‰Šé™¤ */
                border-radius: 4px;
                position: relative;
                overflow: visible;
            }
            .perf-bar-fill {
                height: 100%;
                border-radius: 3px;
                transition: width 0.6s ease;
                position: relative;
                z-index: 1;
            }
            .perf-bar-fill.achieved { background: #10B981; }
            .perf-bar-fill.near     { background: #F59E0B; }
            .perf-bar-fill.below    { background: #EF4444; }
            /* ã€Œã‚³ã€å‹ç›®æ¨™ãƒ•ãƒ¬ãƒ¼ãƒ :
               left:0 ã‹ã‚‰ width=ç›®æ¨™% ã¾ã§åºƒãŒã‚‹é€æ˜ãƒœãƒƒã‚¯ã‚¹ã€‚
               border-top + border-right + border-bottom ã§ã€Œã‚³ã€å­—ã‚’æã */
            .perf-target-line {
                position: absolute;
                top: -3px;
                left: 0;
                height: calc(100% + 6px);
                background: transparent;
                border-top:    2.5px solid #1D4ED8;
                border-right:  2.5px solid #1D4ED8;
                border-bottom: 2.5px solid #1D4ED8;
                border-left:   none;
                border-radius: 0 3px 3px 0;
                pointer-events: none;
                z-index: 2;
            }
            .perf-rate {
                width: 48px;
                font-size: 0.85rem;
                font-weight: bold;
                text-align: right;
                flex-shrink: 0;
            }
            .perf-badge { font-size: 1rem; flex-shrink: 0; }

            /* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒãƒ¼ï¼ˆçµ±åˆHTMLç”¨ï¼‰ */
            .mode-switch-bar {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }
            .mode-btn {
                flex: 1;
                padding: 10px 14px;
                background: white;
                border: 2px solid #E5E7EB;
                border-radius: 8px;
                font-weight: bold;
                font-size: clamp(0.8rem, 1.8vw, 0.95rem);
                cursor: pointer;
                color: #6B7280;
                transition: all 0.25s;
            }
            .mode-btn:hover { border-color: var(--primary); color: var(--primary); }
            .mode-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

            /* ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆå†…ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒãƒ¼ */
            .frag-mode-bar {
                display: flex;
                gap: 8px;
                margin-bottom: 16px;
            }
            .frag-mode-btn {
                flex: 1;
                padding: 8px 12px;
                background: #F9FAFB;
                border: 2px solid #E5E7EB;
                border-radius: 8px;
                font-weight: bold;
                font-size: clamp(0.78rem, 1.6vw, 0.9rem);
                cursor: pointer;
                color: #6B7280;
                transition: all 0.2s;
            }
            .frag-mode-btn:hover { border-color: var(--primary); color: var(--primary); }
            .frag-mode-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
            
            /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ */
            .placeholder {
                text-align: center;
                padding: 60px 20px;
                color: #9CA3AF;
            }
            .placeholder .icon {
                font-size: 4rem;
                margin-bottom: 20px;
            }
            .placeholder h3 {
                font-size: 1.5rem;
                margin-bottom: 10px;
            }
            
            /* å°åˆ·ç”¨ */
            @media print {
                body { background: white; }
                .portal-btn { display: none; }
                .dept-selector-area { display: none; }
                .perf-chart-area { page-break-after: always; }
            }
            
            /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
            @media (max-width: 768px) {
                .container { padding: 10px; }
                .header { padding: 20px; }
                .content-area { padding: 20px; }
                .chart-container { height: 400px; }
                .perf-act-tgt { display: none; }
                .perf-dept { width: 90px; }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>ğŸ¥ è¨ºç™‚ç§‘åˆ¥é€±æ¬¡å®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆ</h1>
                <div class="period">åˆ†ææœŸé–“ï¼ˆä»Šå¹´åº¦ï¼‰: 2025-04-01 ã€œ 2026-02-16</div>
                <div class="update-time">ğŸ“… ä½œæˆæ—¥æ™‚: 2026å¹´02æœˆ18æ—¥ 09:12</div>
                <div>
                    <a href="../index.html" class="portal-btn">ğŸ“Š ãƒãƒ¼ã‚¿ãƒ«ã«æˆ»ã‚‹</a>
                    <button onclick="window.print()" class="portal-btn">ğŸ–¨ï¸ å°åˆ·</button>
                </div>
            </div>
            
            
        <div class="mode-switch-bar"><button id="int-btn-annual" class="mode-btn active" onclick="switchIntMode('annual')">&#128197; å¹´åº¦æ¯”è¼ƒï¼ˆä»Šå¹´åº¦ vs æ˜¨å¹´åº¦ï¼‰</button><button id="int-btn-rolling" class="mode-btn " onclick="switchIntMode('rolling')">&#128260; ç›´è¿‘365æ—¥ï¼ˆç›´è¿‘ vs å‰æœŸï¼‰</button></div>
        <div class="perf-chart-area">
            <h2 id="perf-chart-title">&#128202; è¨ºç™‚ç§‘åˆ¥ å…¨èº«éº»é…”ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆä»Šå¹´åº¦ï¼‰</h2>
            <div id="perf-rows"><div class="perf-row"><div class="perf-dept achieved" title="çš®è†šç§‘">çš®è†šç§‘</div><div class="perf-act-tgt">1.6ä»¶/é€± / ç›®æ¨™1.2ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill achieved" style="width:5.7%"></div><div class="perf-target-line" style="width:4.3%"></div></div><div class="perf-rate">134%</div><div class="perf-badge">âœ…</div></div><div class="perf-row"><div class="perf-dept achieved" title="æ­¯ç§‘å£è…”å¤–ç§‘">æ­¯ç§‘å£è…”å¤–ç§‘</div><div class="perf-act-tgt">3.6ä»¶/é€± / ç›®æ¨™3.2ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill achieved" style="width:12.9%"></div><div class="perf-target-line" style="width:11.3%"></div></div><div class="perf-rate">113%</div><div class="perf-badge">âœ…</div></div><div class="perf-row"><div class="perf-dept achieved" title="æ³Œå°¿å™¨ç§‘">æ³Œå°¿å™¨ç§‘</div><div class="perf-act-tgt">10.7ä»¶/é€± / ç›®æ¨™10.2ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill achieved" style="width:38.1%"></div><div class="perf-target-line" style="width:36.2%"></div></div><div class="perf-rate">105%</div><div class="perf-badge">âœ…</div></div><div class="perf-row"><div class="perf-dept achieved" title="æ•´å½¢å¤–ç§‘">æ•´å½¢å¤–ç§‘</div><div class="perf-act-tgt">28.2ä»¶/é€± / ç›®æ¨™27.2ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill achieved" style="width:100.0%"></div><div class="perf-target-line" style="width:96.5%"></div></div><div class="perf-rate">104%</div><div class="perf-badge">âœ…</div></div><div class="perf-row"><div class="perf-dept near" title="è€³é¼»å’½å–‰ç§‘">è€³é¼»å’½å–‰ç§‘</div><div class="perf-act-tgt">7.6ä»¶/é€± / ç›®æ¨™8.1ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill near" style="width:27.0%"></div><div class="perf-target-line" style="width:28.7%"></div></div><div class="perf-rate">94%</div><div class="perf-badge">ğŸŸ¡</div></div><div class="perf-row"><div class="perf-dept near" title="è„³ç¥çµŒå¤–ç§‘">è„³ç¥çµŒå¤–ç§‘</div><div class="perf-act-tgt">2.7ä»¶/é€± / ç›®æ¨™3.0ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill near" style="width:9.6%"></div><div class="perf-target-line" style="width:10.6%"></div></div><div class="perf-rate">90%</div><div class="perf-badge">ğŸŸ¡</div></div><div class="perf-row"><div class="perf-dept near" title="ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘</div><div class="perf-act-tgt">12.6ä»¶/é€± / ç›®æ¨™14.1ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill near" style="width:44.6%"></div><div class="perf-target-line" style="width:50.0%"></div></div><div class="perf-rate">89%</div><div class="perf-badge">ğŸŸ¡</div></div><div class="perf-row"><div class="perf-dept near" title="ç”£å©¦äººç§‘">ç”£å©¦äººç§‘</div><div class="perf-act-tgt">10.9ä»¶/é€± / ç›®æ¨™12.5ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill near" style="width:38.8%"></div><div class="perf-target-line" style="width:44.3%"></div></div><div class="perf-rate">87%</div><div class="perf-badge">ğŸŸ¡</div></div><div class="perf-row"><div class="perf-dept below" title="ä¹³è…ºå¤–ç§‘">ä¹³è…ºå¤–ç§‘</div><div class="perf-act-tgt">6.5ä»¶/é€± / ç›®æ¨™8.1ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill below" style="width:23.0%"></div><div class="perf-target-line" style="width:28.7%"></div></div><div class="perf-rate">80%</div><div class="perf-badge">ğŸ”´</div></div><div class="perf-row"><div class="perf-dept below" title="å‘¼å¸å™¨å¤–ç§‘">å‘¼å¸å™¨å¤–ç§‘</div><div class="perf-act-tgt">2.2ä»¶/é€± / ç›®æ¨™2.8ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill below" style="width:7.7%"></div><div class="perf-target-line" style="width:9.9%"></div></div><div class="perf-rate">78%</div><div class="perf-badge">ğŸ”´</div></div><div class="perf-row"><div class="perf-dept below" title="å½¢æˆå¤–ç§‘">å½¢æˆå¤–ç§‘</div><div class="perf-act-tgt">2.3ä»¶/é€± / ç›®æ¨™3.0ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill below" style="width:8.2%"></div><div class="perf-target-line" style="width:10.6%"></div></div><div class="perf-rate">77%</div><div class="perf-badge">ğŸ”´</div></div><div class="perf-row"><div class="perf-dept below" title="å¿ƒè‡“è¡€ç®¡å¤–ç§‘">å¿ƒè‡“è¡€ç®¡å¤–ç§‘</div><div class="perf-act-tgt">1.4ä»¶/é€± / ç›®æ¨™2.1ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill below" style="width:4.9%"></div><div class="perf-target-line" style="width:7.4%"></div></div><div class="perf-rate">65%</div><div class="perf-badge">ğŸ”´</div></div></div>
            <div style="font-size:0.8rem;color:#6B7280;margin-top:12px;">
                &#128309; ç¸¦ç·š = é€±æ¬¡ç›®æ¨™ &#9989; &#8805;100% &#128993; 80&#12316;99% &#128308; &lt;80%
            </div>
        </div>
            
            <div class="dept-selector-area">
                <h2>ğŸ“‹ è¨ºç™‚ç§‘ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                <select id="dept-selector" onchange="switchDepartment()">
                    <option value="">-- è¨ºç™‚ç§‘ã‚’é¸æŠ --</option>
                    <option value="ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘</option>
<option value="ä¹³è…ºå¤–ç§‘">ä¹³è…ºå¤–ç§‘</option>
<option value="å‘¼å¸å™¨å¤–ç§‘">å‘¼å¸å™¨å¤–ç§‘</option>
<option value="å½¢æˆå¤–ç§‘">å½¢æˆå¤–ç§‘</option>
<option value="å¿ƒè‡“è¡€ç®¡å¤–ç§‘">å¿ƒè‡“è¡€ç®¡å¤–ç§‘</option>
<option value="æ•´å½¢å¤–ç§‘">æ•´å½¢å¤–ç§‘</option>
<option value="æ­¯ç§‘å£è…”å¤–ç§‘">æ­¯ç§‘å£è…”å¤–ç§‘</option>
<option value="æ³Œå°¿å™¨ç§‘">æ³Œå°¿å™¨ç§‘</option>
<option value="ç”£å©¦äººç§‘">ç”£å©¦äººç§‘</option>
<option value="çš®è†šç§‘">çš®è†šç§‘</option>
<option value="è€³é¼»å’½å–‰ç§‘">è€³é¼»å’½å–‰ç§‘</option>
<option value="è„³ç¥çµŒå¤–ç§‘">è„³ç¥çµŒå¤–ç§‘</option>

                </select>
            </div>
            
            <div class="content-area">
                <div id="placeholder" class="placeholder">
                    <div class="icon">ğŸ“Š</div>
                    <h3>è¨ºç™‚ç§‘ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
                    <p>ä¸Šã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‹ã‚‰è¨ºç™‚ç§‘ã‚’é¸ã‚“ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã™</p>
                </div>
                <div id="fragment-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">
        <div class="dept-header">
            <h2>&#128202; ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 14.1ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">12.6 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">89.3%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">12.8 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">15.8 ä»¶/é€±<br><span style="font-size:0.75em">(112%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">&#9989; ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":13,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.2,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":8,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":74.5,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":12,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.0,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":12,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.8,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":11,"MA8":11.2,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":13,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":15,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.1,"\u9054\u6210":true,"\u9054\u6210\u7387":106.4},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":19,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":91.3,"\u9054\u6210":true,"\u9054\u6210\u7387":134.8},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":10,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":14,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.1,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":11,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":13,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":89.2,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":10,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.8,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":18,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.7,"\u9054\u6210":true,"\u9054\u6210\u7387":127.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":14,"MA8":13.625,"\u7d2f\u7a4d\u9054\u6210\u7387":91.3,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":8,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":89.1,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":13,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":12,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":12,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":88.8,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":16,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":90.1,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":16,"MA8":13.625,"\u7d2f\u7a4d\u9054\u6210\u7387":91.2,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":10,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":90.3,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":13,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":90.3,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":14,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.7,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":11,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":90.2,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":8,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":88.9,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":13,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":16,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":11,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.3,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":13,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.8,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":88.3,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":14,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":88.5,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":14,"MA8":12.75,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":87.1,"\u9054\u6210":false,"\u9054\u6210\u7387":21.3},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":11,"MA8":11.125,"\u7d2f\u7a4d\u9054\u6210\u7387":86.8,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":87.1,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":16,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":87.7,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":16,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":88.3,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":17,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":true,"\u9054\u6210\u7387":120.6},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":14,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3}], metrics: {"avg_weekly": 12.59, "achieve_rate": 89.3, "last_year_avg": 12.85, "last4_avg": 15.75, "last4_achieve_rate": 111.7, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/11","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":21.3,"\u9054\u6210":false,"\u9054\u6210\u7387":21.3},{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":9,"MA8":6.0,"\u7d2f\u7a4d\u9054\u6210\u7387":42.6,"\u9054\u6210":false,"\u9054\u6210\u7387":63.8},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":17,"MA8":9.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":68.6,"\u9054\u6210":true,"\u9054\u6210\u7387":120.6},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":10,"MA8":9.75,"\u7d2f\u7a4d\u9054\u6210\u7387":69.1,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":13,"MA8":10.4,"\u7d2f\u7a4d\u9054\u6210\u7387":73.8,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":11,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":74.5,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":14,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.0,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":13,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.8,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":8,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":77.2,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":12,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":78.0,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":12,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":78.7,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":11,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":78.6,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":13,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":79.7,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":15,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":true,"\u9054\u6210\u7387":106.4},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":19,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":85.1,"\u9054\u6210":true,"\u9054\u6210\u7387":134.8},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":10,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.2,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":14,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":85.1,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":11,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":13,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":85.1,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":10,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":18,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.5,"\u9054\u6210":true,"\u9054\u6210\u7387":127.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":14,"MA8":13.625,"\u7d2f\u7a4d\u9054\u6210\u7387":87.0,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":8,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":13,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.0,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":12,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.0,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":12,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":85.9,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":16,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":86.9,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":16,"MA8":13.625,"\u7d2f\u7a4d\u9054\u6210\u7387":87.9,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":10,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":87.3,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":13,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":87.5,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":14,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":87.9,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":11,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":87.5,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":8,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":13,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.8,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":86.3,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":16,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":87.1,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":11,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.7,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":13,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":86.9,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":86.5,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":14,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.9,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.8,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":14,"MA8":12.75,"\u7d2f\u7a4d\u9054\u6210\u7387":87.1,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":21.3},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":11,"MA8":11.125,"\u7d2f\u7a4d\u9054\u6210\u7387":85.5,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":85.8,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":16,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":16,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":86.9,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":17,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.6,"\u9054\u6210":true,"\u9054\u6210\u7387":120.6},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":14,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.8,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3}], metrics: {"avg_weekly": 12.58, "achieve_rate": 89.2, "last_year_avg": 12.72, "last4_avg": 15.75, "last4_achieve_rate": 111.7, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 14.1;
        const canvasId     = 'chart-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘';
        const safeName     = 'ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘';
        const fragId       = 'frag-mode-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-ä¹³è…ºå¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-ä¹³è…ºå¤–ç§‘">
        <div class="dept-header">
            <h2>&#128202; ä¹³è…ºå¤–ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 8.1ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-ä¹³è…ºå¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-ä¹³è…ºå¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-ä¹³è…ºå¤–ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-ä¹³è…ºå¤–ç§‘">6.5 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-ä¹³è…ºå¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-ä¹³è…ºå¤–ç§‘">80.0%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-ä¹³è…ºå¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-ä¹³è…ºå¤–ç§‘">7.1 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-ä¹³è…ºå¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-ä¹³è…ºå¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-ä¹³è…ºå¤–ç§‘">6.5 ä»¶/é€±<br><span style="font-size:0.75em">(80%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-ä¹³è…ºå¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>1.6 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-ä¹³è…ºå¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":8,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":8,"MA8":6.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":6,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":77.2,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":5,"MA8":6.0,"\u7d2f\u7a4d\u9054\u6210\u7387":74.1,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":3,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":8,"MA8":5.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":72.3,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":8,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":9,"MA8":6.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.1,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":7,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":7,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":8,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":9,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":6,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":6,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":5,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":80.5,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":8,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":8,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":3,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":7,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":6,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.1,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.3,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":6,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":9,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":6,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":6,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":5,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":7,"MA8":6.875,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":6,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":6,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":7,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":6,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4}], metrics: {"avg_weekly": 6.48, "achieve_rate": 80.0, "last_year_avg": 7.08, "last4_avg": 6.5, "last4_achieve_rate": 80.2, "needed_per_week": 1.6} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":8,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":8,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":6,"MA8":7.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":8,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":92.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":4,"MA8":6.8,"\u7d2f\u7a4d\u9054\u6210\u7387":84.0,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":7,"MA8":6.8333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":8,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":8,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":6,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":5,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":79.7,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":3,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.1,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":8,"MA8":6.0,"\u7d2f\u7a4d\u9054\u6210\u7387":77.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":8,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":9,"MA8":6.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.5,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":7,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.7,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":7,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":8,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":84.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":9,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":6,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":6,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.5,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":5,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.2,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":8,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":8,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":3,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":7,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":6,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":6,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":9,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":6,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":6,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":5,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.2,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":7,"MA8":6.875,"\u7d2f\u7a4d\u9054\u6210\u7387":82.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":6,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.2,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":6,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":7,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":6,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4}], metrics: {"avg_weekly": 6.5, "achieve_rate": 80.3, "last_year_avg": 7.06, "last4_avg": 6.5, "last4_achieve_rate": 80.2, "needed_per_week": 1.6} },
        };
        const weeklyTarget = 8.1;
        const canvasId     = 'chart-ä¹³è…ºå¤–ç§‘';
        const safeName     = 'ä¹³è…ºå¤–ç§‘';
        const fragId       = 'frag-mode-ä¹³è…ºå¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-å‘¼å¸å™¨å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-å‘¼å¸å™¨å¤–ç§‘">
        <div class="dept-header">
            <h2>&#128202; å‘¼å¸å™¨å¤–ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 2.8ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-å‘¼å¸å™¨å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-å‘¼å¸å™¨å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-å‘¼å¸å™¨å¤–ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-å‘¼å¸å™¨å¤–ç§‘">2.2 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-å‘¼å¸å™¨å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-å‘¼å¸å™¨å¤–ç§‘">77.6%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-å‘¼å¸å™¨å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-å‘¼å¸å™¨å¤–ç§‘">2.2 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-å‘¼å¸å™¨å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-å‘¼å¸å™¨å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-å‘¼å¸å™¨å¤–ç§‘">3.2 ä»¶/é€±<br><span style="font-size:0.75em">(116%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-å‘¼å¸å™¨å¤–ç§‘">&#9989; ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-å‘¼å¸å™¨å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":1,"MA8":1.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":66.3,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":4,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.9,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":77.9,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":77.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":76.5,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":4,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.8,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":78.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.5,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.7,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.8,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.3,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":79.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":79.0,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":4,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.9,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.6,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":79.2,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":78.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":77.7,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.7,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9}], metrics: {"avg_weekly": 2.17, "achieve_rate": 77.6, "last_year_avg": 2.22, "last4_avg": 3.25, "last4_achieve_rate": 116.1, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":4,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":142.9,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":3,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":1,"MA8":2.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":3,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":98.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":3,"MA8":2.8,"\u7d2f\u7a4d\u9054\u6210\u7387":100.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":2,"MA8":2.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":102.0,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":98.2,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":96.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":90.9,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":85.2,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":4,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.1,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":86.5,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":4,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":87.7,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":87.0,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.5,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.0,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":85.5,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":86.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.9,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":4,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.1,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.1,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.3,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9}], metrics: {"avg_weekly": 2.26, "achieve_rate": 80.8, "last_year_avg": 2.13, "last4_avg": 3.25, "last4_achieve_rate": 116.1, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 2.8;
        const canvasId     = 'chart-å‘¼å¸å™¨å¤–ç§‘';
        const safeName     = 'å‘¼å¸å™¨å¤–ç§‘';
        const fragId       = 'frag-mode-å‘¼å¸å™¨å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-å½¢æˆå¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-å½¢æˆå¤–ç§‘">
        <div class="dept-header">
            <h2>&#128202; å½¢æˆå¤–ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 3.0ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-å½¢æˆå¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-å½¢æˆå¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-å½¢æˆå¤–ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-å½¢æˆå¤–ç§‘">2.3 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-å½¢æˆå¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-å½¢æˆå¤–ç§‘">76.8%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-å½¢æˆå¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-å½¢æˆå¤–ç§‘">2.0 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-å½¢æˆå¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-å½¢æˆå¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-å½¢æˆå¤–ç§‘">2.5 ä»¶/é€±<br><span style="font-size:0.75em">(83%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-å½¢æˆå¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.5 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-å½¢æˆå¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":33.3,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":1,"MA8":1.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":55.6,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":3,"MA8":2.2,"\u7d2f\u7a4d\u9054\u6210\u7387":73.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":3,"MA8":2.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":3,"MA8":2.4285714286,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.8,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":74.4,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":73.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":5,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":4,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":84.2,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":3,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":85.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":2,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":84.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":1,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":1,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":79.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.2,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":76.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":74.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":3,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":75.3,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":76.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":76.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.5,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":4,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":78.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":77.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.6,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":3,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":79.1,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":78.5,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0}], metrics: {"avg_weekly": 2.3, "achieve_rate": 76.8, "last_year_avg": 2.01, "last4_avg": 2.5, "last4_achieve_rate": 83.3, "needed_per_week": 0.5} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":3,"MA8":2.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":1,"MA8":1.8333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":61.1,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":62.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":70.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":72.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":78.6,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":72.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":74.5,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":72.2,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":71.9,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":73.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":5,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.3,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":4,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":80.6,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":3,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":81.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":2,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":80.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":1,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":79.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":1,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.4,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":77.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":76.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":75.3,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":73.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":73.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":3,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":74.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":74.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":74.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.4,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":76.1,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":75.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":4,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":77.0,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":76.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":76.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.3,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":3,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0}], metrics: {"avg_weekly": 2.22, "achieve_rate": 74.2, "last_year_avg": 2.05, "last4_avg": 2.5, "last4_achieve_rate": 83.3, "needed_per_week": 0.5} },
        };
        const weeklyTarget = 3.0;
        const canvasId     = 'chart-å½¢æˆå¤–ç§‘';
        const safeName     = 'å½¢æˆå¤–ç§‘';
        const fragId       = 'frag-mode-å½¢æˆå¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-å¿ƒè‡“è¡€ç®¡å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">
        <div class="dept-header">
            <h2>&#128202; å¿ƒè‡“è¡€ç®¡å¤–ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 2.1ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-å¿ƒè‡“è¡€ç®¡å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-å¿ƒè‡“è¡€ç®¡å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">1.4 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">65.2%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">1.4 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">1.8 ä»¶/é€±<br><span style="font-size:0.75em">(83%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.4 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-å¿ƒè‡“è¡€ç®¡å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":1,"MA8":1.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.6,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":76.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":190.5},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":3,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":85.0,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":1,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.1,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2}], metrics: {"avg_weekly": 1.37, "achieve_rate": 65.2, "last_year_avg": 1.44, "last4_avg": 1.75, "last4_achieve_rate": 83.3, "needed_per_week": 0.35} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/11","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":47.6,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":2,"MA8":1.8,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":2,"MA8":1.8333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":87.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":2,"MA8":1.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":89.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":90.9,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":91.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":87.9,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":true,"\u9054\u6210\u7387":190.5},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.1,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":84.5,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":3,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":85.4,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":1,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2}], metrics: {"avg_weekly": 1.42, "achieve_rate": 67.6, "last_year_avg": 1.34, "last4_avg": 1.75, "last4_achieve_rate": 83.3, "needed_per_week": 0.35} },
        };
        const weeklyTarget = 2.1;
        const canvasId     = 'chart-å¿ƒè‡“è¡€ç®¡å¤–ç§‘';
        const safeName     = 'å¿ƒè‡“è¡€ç®¡å¤–ç§‘';
        const fragId       = 'frag-mode-å¿ƒè‡“è¡€ç®¡å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-æ•´å½¢å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-æ•´å½¢å¤–ç§‘">
        <div class="dept-header">
            <h2>&#128202; æ•´å½¢å¤–ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 27.2ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-æ•´å½¢å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-æ•´å½¢å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-æ•´å½¢å¤–ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-æ•´å½¢å¤–ç§‘">28.2 ä»¶</div>
            </div>
            <div class="summary-card " id="card-ach-æ•´å½¢å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value success" id="val-ach-æ•´å½¢å¤–ç§‘">103.7%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-æ•´å½¢å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-æ•´å½¢å¤–ç§‘">25.3 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-æ•´å½¢å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-æ•´å½¢å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-æ•´å½¢å¤–ç§‘">31.2 ä»¶/é€±<br><span style="font-size:0.75em">(115%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-æ•´å½¢å¤–ç§‘">&#9989; ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-æ•´å½¢å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":29,"MA8":29.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":32,"MA8":30.5,"\u7d2f\u7a4d\u9054\u6210\u7387":112.1,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":32,"MA8":31.0,"\u7d2f\u7a4d\u9054\u6210\u7387":114.0,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":31,"MA8":31.0,"\u7d2f\u7a4d\u9054\u6210\u7387":114.0,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":19,"MA8":28.6,"\u7d2f\u7a4d\u9054\u6210\u7387":105.1,"\u9054\u6210":false,"\u9054\u6210\u7387":69.9},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":28,"MA8":28.5,"\u7d2f\u7a4d\u9054\u6210\u7387":104.8,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":29,"MA8":28.5714285714,"\u7d2f\u7a4d\u9054\u6210\u7387":105.0,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":26,"MA8":28.25,"\u7d2f\u7a4d\u9054\u6210\u7387":103.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":36,"MA8":29.125,"\u7d2f\u7a4d\u9054\u6210\u7387":107.0,"\u9054\u6210":true,"\u9054\u6210\u7387":132.4},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":28,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":30,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":107.0,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":32,"MA8":28.5,"\u7d2f\u7a4d\u9054\u6210\u7387":107.8,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":32,"MA8":30.125,"\u7d2f\u7a4d\u9054\u6210\u7387":108.6,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":24,"MA8":29.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":27,"MA8":29.375,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":25,"MA8":29.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.7,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":28,"MA8":28.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.5,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":29,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":105.6,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":25,"MA8":27.75,"\u7d2f\u7a4d\u9054\u6210\u7387":104.9,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":37,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":106.4,"\u9054\u6210":true,"\u9054\u6210\u7387":136.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":34,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.3,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":26,"MA8":28.875,"\u7d2f\u7a4d\u9054\u6210\u7387":106.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":30,"MA8":29.25,"\u7d2f\u7a4d\u9054\u6210\u7387":106.9,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":22,"MA8":28.875,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":false,"\u9054\u6210\u7387":80.9},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":30,"MA8":29.125,"\u7d2f\u7a4d\u9054\u6210\u7387":106.0,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":26,"MA8":28.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.6,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":31,"MA8":29.5,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":25,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.4,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":29,"MA8":27.375,"\u7d2f\u7a4d\u9054\u6210\u7387":105.5,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":27,"MA8":27.5,"\u7d2f\u7a4d\u9054\u6210\u7387":105.3,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":21,"MA8":26.375,"\u7d2f\u7a4d\u9054\u6210\u7387":104.4,"\u9054\u6210":false,"\u9054\u6210\u7387":77.2},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":32,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.8,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":33,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.3,"\u9054\u6210":true,"\u9054\u6210\u7387":121.3},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":23,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.7,"\u9054\u6210":false,"\u9054\u6210\u7387":84.6},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":27,"MA8":27.125,"\u7d2f\u7a4d\u9054\u6210\u7387":104.5,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":28,"MA8":27.5,"\u7d2f\u7a4d\u9054\u6210\u7387":104.5,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":30,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.6,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":36,"MA8":28.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.4,"\u9054\u6210":true,"\u9054\u6210\u7387":132.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":20,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.5,"\u9054\u6210":false,"\u9054\u6210\u7387":73.5},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":8,"MA8":25.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.7,"\u9054\u6210":false,"\u9054\u6210\u7387":29.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":23,"MA8":24.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":false,"\u9054\u6210\u7387":84.6},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":32,"MA8":25.5,"\u7d2f\u7a4d\u9054\u6210\u7387":102.6,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":33,"MA8":26.25,"\u7d2f\u7a4d\u9054\u6210\u7387":103.0,"\u9054\u6210":true,"\u9054\u6210\u7387":121.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":32,"MA8":26.75,"\u7d2f\u7a4d\u9054\u6210\u7387":103.4,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":34,"MA8":27.25,"\u7d2f\u7a4d\u9054\u6210\u7387":103.8,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":26,"MA8":26.0,"\u7d2f\u7a4d\u9054\u6210\u7387":103.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6}], metrics: {"avg_weekly": 28.2, "achieve_rate": 103.7, "last_year_avg": 25.32, "last4_avg": 31.25, "last4_achieve_rate": 114.9, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/11","\u9031\u4ef6\u6570":8,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":29.4,"\u9054\u6210":false,"\u9054\u6210\u7387":29.4},{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":23,"MA8":15.5,"\u7d2f\u7a4d\u9054\u6210\u7387":57.0,"\u9054\u6210":false,"\u9054\u6210\u7387":84.6},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":31,"MA8":20.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":76.0,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":29,"MA8":22.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":32,"MA8":24.6,"\u7d2f\u7a4d\u9054\u6210\u7387":90.4,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":29,"MA8":25.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":93.1,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":24,"MA8":25.1428571429,"\u7d2f\u7a4d\u9054\u6210\u7387":92.4,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":29,"MA8":25.625,"\u7d2f\u7a4d\u9054\u6210\u7387":94.2,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":32,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":96.8,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":32,"MA8":29.75,"\u7d2f\u7a4d\u9054\u6210\u7387":98.9,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":31,"MA8":29.75,"\u7d2f\u7a4d\u9054\u6210\u7387":100.3,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":19,"MA8":28.5,"\u7d2f\u7a4d\u9054\u6210\u7387":97.7,"\u9054\u6210":false,"\u9054\u6210\u7387":69.9},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":28,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.1,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":29,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.7,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":26,"MA8":28.25,"\u7d2f\u7a4d\u9054\u6210\u7387":98.5,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":36,"MA8":29.125,"\u7d2f\u7a4d\u9054\u6210\u7387":100.6,"\u9054\u6210":true,"\u9054\u6210\u7387":132.4},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":28,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":100.8,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":30,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":101.3,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":32,"MA8":28.5,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":32,"MA8":30.125,"\u7d2f\u7a4d\u9054\u6210\u7387":102.9,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":24,"MA8":29.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":27,"MA8":29.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.1,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":25,"MA8":29.25,"\u7d2f\u7a4d\u9054\u6210\u7387":101.7,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":28,"MA8":28.25,"\u7d2f\u7a4d\u9054\u6210\u7387":101.7,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":29,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":101.9,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":25,"MA8":27.75,"\u7d2f\u7a4d\u9054\u6210\u7387":101.5,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":37,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.8,"\u9054\u6210":true,"\u9054\u6210\u7387":136.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":34,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":103.6,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":26,"MA8":28.875,"\u7d2f\u7a4d\u9054\u6210\u7387":103.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":30,"MA8":29.25,"\u7d2f\u7a4d\u9054\u6210\u7387":103.6,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":22,"MA8":28.875,"\u7d2f\u7a4d\u9054\u6210\u7387":102.8,"\u9054\u6210":false,"\u9054\u6210\u7387":80.9},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":30,"MA8":29.125,"\u7d2f\u7a4d\u9054\u6210\u7387":103.1,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":26,"MA8":28.75,"\u7d2f\u7a4d\u9054\u6210\u7387":102.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":31,"MA8":29.5,"\u7d2f\u7a4d\u9054\u6210\u7387":103.2,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":25,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":102.8,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":29,"MA8":27.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.9,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":27,"MA8":27.5,"\u7d2f\u7a4d\u9054\u6210\u7387":102.8,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":21,"MA8":26.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":false,"\u9054\u6210\u7387":77.2},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":32,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.6,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":33,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":103.0,"\u9054\u6210":true,"\u9054\u6210\u7387":121.3},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":23,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.6,"\u9054\u6210":false,"\u9054\u6210\u7387":84.6},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":27,"MA8":27.125,"\u7d2f\u7a4d\u9054\u6210\u7387":102.5,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":28,"MA8":27.5,"\u7d2f\u7a4d\u9054\u6210\u7387":102.5,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":30,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.7,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":36,"MA8":28.75,"\u7d2f\u7a4d\u9054\u6210\u7387":103.3,"\u9054\u6210":true,"\u9054\u6210\u7387":132.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":20,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.7,"\u9054\u6210":false,"\u9054\u6210\u7387":73.5},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":8,"MA8":25.625,"\u7d2f\u7a4d\u9054\u6210\u7387":101.1,"\u9054\u6210":false,"\u9054\u6210\u7387":29.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":23,"MA8":24.375,"\u7d2f\u7a4d\u9054\u6210\u7387":100.8,"\u9054\u6210":false,"\u9054\u6210\u7387":84.6},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":32,"MA8":25.5,"\u7d2f\u7a4d\u9054\u6210\u7387":101.1,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":33,"MA8":26.25,"\u7d2f\u7a4d\u9054\u6210\u7387":101.5,"\u9054\u6210":true,"\u9054\u6210\u7387":121.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":32,"MA8":26.75,"\u7d2f\u7a4d\u9054\u6210\u7387":101.9,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":34,"MA8":27.25,"\u7d2f\u7a4d\u9054\u6210\u7387":102.3,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":26,"MA8":26.0,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6}], metrics: {"avg_weekly": 28.25, "achieve_rate": 103.9, "last_year_avg": 24.8, "last4_avg": 31.25, "last4_achieve_rate": 114.9, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 27.2;
        const canvasId     = 'chart-æ•´å½¢å¤–ç§‘';
        const safeName     = 'æ•´å½¢å¤–ç§‘';
        const fragId       = 'frag-mode-æ•´å½¢å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-æ­¯ç§‘å£è…”å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-æ­¯ç§‘å£è…”å¤–ç§‘">
        <div class="dept-header">
            <h2>&#128202; æ­¯ç§‘å£è…”å¤–ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 3.2ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-æ­¯ç§‘å£è…”å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-æ­¯ç§‘å£è…”å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-æ­¯ç§‘å£è…”å¤–ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-æ­¯ç§‘å£è…”å¤–ç§‘">3.6 ä»¶</div>
            </div>
            <div class="summary-card " id="card-ach-æ­¯ç§‘å£è…”å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value success" id="val-ach-æ­¯ç§‘å£è…”å¤–ç§‘">113.5%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-æ­¯ç§‘å£è…”å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-æ­¯ç§‘å£è…”å¤–ç§‘">2.8 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-æ­¯ç§‘å£è…”å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-æ­¯ç§‘å£è…”å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-æ­¯ç§‘å£è…”å¤–ç§‘">4.2 ä»¶/é€±<br><span style="font-size:0.75em">(133%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-æ­¯ç§‘å£è…”å¤–ç§‘">&#9989; ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-æ­¯ç§‘å£è…”å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":2,"MA8":2.8,"\u7d2f\u7a4d\u9054\u6210\u7387":87.5,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.1,"\u9054\u6210":false,"\u9054\u6210\u7387":31.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":2.4285714286,"\u7d2f\u7a4d\u9054\u6210\u7387":75.9,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":70.3,"\u9054\u6210":false,"\u9054\u6210\u7387":31.2},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":69.4,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":68.8,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":71.0,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":70.3,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":5,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":5,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":3,"MA8":3.125,"\u7d2f\u7a4d\u9054\u6210\u7387":84.0,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":7,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":true,"\u9054\u6210\u7387":218.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.7,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":95.3,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":6,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":99.7,"\u9054\u6210":true,"\u9054\u6210\u7387":187.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.0,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":5,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":100.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":4,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":101.6,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":103.8,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":103.4,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":5,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.3,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":5,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.7,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":4,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":107.3,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.9,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":4,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":107.4,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":2,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":106.1,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":5,"MA8":3.875,"\u7d2f\u7a4d\u9054\u6210\u7387":107.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":3,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":5,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":108.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":5,"MA8":3.875,"\u7d2f\u7a4d\u9054\u6210\u7387":109.8,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":7,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":112.7,"\u9054\u6210":true,"\u9054\u6210\u7387":218.8},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":5,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":113.8,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":5,"MA8":4.625,"\u7d2f\u7a4d\u9054\u6210\u7387":114.8,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":3,"MA8":4.75,"\u7d2f\u7a4d\u9054\u6210\u7387":114.3,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":4,"MA8":4.625,"\u7d2f\u7a4d\u9054\u6210\u7387":114.6,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":5,"MA8":4.875,"\u7d2f\u7a4d\u9054\u6210\u7387":115.6,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":5,"MA8":4.875,"\u7d2f\u7a4d\u9054\u6210\u7387":116.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":3,"MA8":4.625,"\u7d2f\u7a4d\u9054\u6210\u7387":116.0,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8}], metrics: {"avg_weekly": 3.63, "achieve_rate": 113.5, "last_year_avg": 2.78, "last4_avg": 4.25, "last4_achieve_rate": 132.8, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":5,"MA8":5.0,"\u7d2f\u7a4d\u9054\u6210\u7387":156.2,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":4,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":140.6,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":4,"MA8":4.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":135.4,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":2,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":117.2,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":2,"MA8":3.4,"\u7d2f\u7a4d\u9054\u6210\u7387":106.2,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":3,"MA8":3.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":104.2,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":3.2857142857,"\u7d2f\u7a4d\u9054\u6210\u7387":102.7,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":3.125,"\u7d2f\u7a4d\u9054\u6210\u7387":97.7,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":100.7,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":2,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":96.9,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":1,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":90.9,"\u9054\u6210":false,"\u9054\u6210\u7387":31.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":88.5,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.1,"\u9054\u6210":false,"\u9054\u6210\u7387":31.2},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":80.9,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":5,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":85.1,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":5,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":88.8,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.1,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":3,"MA8":3.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":90.9,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":7,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.5,"\u9054\u6210":true,"\u9054\u6210\u7387":218.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.4,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":97.5,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":6,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":101.0,"\u9054\u6210":true,"\u9054\u6210\u7387":187.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":99.5,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":5,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":101.6,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":4,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.4,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":104.2,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":103.8,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":5,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":5,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":107.0,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":4,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.8,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":4,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":107.3,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":2,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":106.1,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":5,"MA8":3.875,"\u7d2f\u7a4d\u9054\u6210\u7387":107.4,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":3,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.0,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":5,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":108.2,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":5,"MA8":3.875,"\u7d2f\u7a4d\u9054\u6210\u7387":109.4,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":7,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.9,"\u9054\u6210":true,"\u9054\u6210\u7387":218.8},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":5,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":112.9,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":5,"MA8":4.625,"\u7d2f\u7a4d\u9054\u6210\u7387":113.9,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":3,"MA8":4.75,"\u7d2f\u7a4d\u9054\u6210\u7387":113.5,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":4,"MA8":4.625,"\u7d2f\u7a4d\u9054\u6210\u7387":113.7,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":5,"MA8":4.875,"\u7d2f\u7a4d\u9054\u6210\u7387":114.6,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":5,"MA8":4.875,"\u7d2f\u7a4d\u9054\u6210\u7387":115.4,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":3,"MA8":4.625,"\u7d2f\u7a4d\u9054\u6210\u7387":115.0,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8}], metrics: {"avg_weekly": 3.53, "achieve_rate": 110.3, "last_year_avg": 2.72, "last4_avg": 4.25, "last4_achieve_rate": 132.8, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 3.2;
        const canvasId     = 'chart-æ­¯ç§‘å£è…”å¤–ç§‘';
        const safeName     = 'æ­¯ç§‘å£è…”å¤–ç§‘';
        const fragId       = 'frag-mode-æ­¯ç§‘å£è…”å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-æ³Œå°¿å™¨ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-æ³Œå°¿å™¨ç§‘">
        <div class="dept-header">
            <h2>&#128202; æ³Œå°¿å™¨ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 10.2ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-æ³Œå°¿å™¨ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-æ³Œå°¿å™¨ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-æ³Œå°¿å™¨ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-æ³Œå°¿å™¨ç§‘">10.7 ä»¶</div>
            </div>
            <div class="summary-card " id="card-ach-æ³Œå°¿å™¨ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value success" id="val-ach-æ³Œå°¿å™¨ç§‘">105.3%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-æ³Œå°¿å™¨ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-æ³Œå°¿å™¨ç§‘">9.6 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-æ³Œå°¿å™¨ç§‘">
                <div class="metric-label" id="lbl-fcst-æ³Œå°¿å™¨ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-æ³Œå°¿å™¨ç§‘">11.5 ä»¶/é€±<br><span style="font-size:0.75em">(113%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-æ³Œå°¿å™¨ç§‘">&#9989; ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-æ³Œå°¿å™¨ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":9,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":10,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":93.1,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":8,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":11,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":93.1,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":8,"MA8":9.2,"\u7d2f\u7a4d\u9054\u6210\u7387":90.2,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":8,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":15,"MA8":9.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":96.6,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":17,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":13,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":107.8,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":111.8,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":110.5,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":10,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":109.5,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":16,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":113.1,"\u9054\u6210":true,"\u9054\u6210\u7387":156.9},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":11,"MA8":13.375,"\u7d2f\u7a4d\u9054\u6210\u7387":112.7,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":13,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":113.7,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":12,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":114.0,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":8,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":111.9,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":10,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":8,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":109.4,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":7,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.4,"\u9054\u6210":false,"\u9054\u6210\u7387":68.6},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":10,"MA8":9.875,"\u7d2f\u7a4d\u9054\u6210\u7387":106.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":9,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":106.1,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":10,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":6,"MA8":8.5,"\u7d2f\u7a4d\u9054\u6210\u7387":103.8,"\u9054\u6210":false,"\u9054\u6210\u7387":58.8},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":101.6,"\u9054\u6210":false,"\u9054\u6210\u7387":49.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":11,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":101.8,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":11,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":11,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":11,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":102.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":15,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":103.9,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":8,"MA8":9.75,"\u7d2f\u7a4d\u9054\u6210\u7387":103.1,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":13,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":103.9,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":105.2,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":11,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":105.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":12,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":106.2,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":106.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.8,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":9,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":106.3,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":2,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":104.2,"\u9054\u6210":false,"\u9054\u6210\u7387":19.6},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":11,"MA8":10.25,"\u7d2f\u7a4d\u9054\u6210\u7387":104.3,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":12,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":104.6,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":14,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":105.3,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":8,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":104.7,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":11,"MA8":10.125,"\u7d2f\u7a4d\u9054\u6210\u7387":104.8,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":13,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.3,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5}], metrics: {"avg_weekly": 10.74, "achieve_rate": 105.3, "last_year_avg": 9.65, "last4_avg": 11.5, "last4_achieve_rate": 112.7, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/11","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":19.6,"\u9054\u6210":false,"\u9054\u6210\u7387":19.6},{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":6,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":39.2,"\u9054\u6210":false,"\u9054\u6210\u7387":58.8},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":9,"MA8":5.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":55.6,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":7,"MA8":6.0,"\u7d2f\u7a4d\u9054\u6210\u7387":58.8,"\u9054\u6210":false,"\u9054\u6210\u7387":68.6},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":9,"MA8":6.6,"\u7d2f\u7a4d\u9054\u6210\u7387":64.7,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":5,"MA8":6.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":62.1,"\u9054\u6210":false,"\u9054\u6210\u7387":49.0},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":7,"MA8":6.4285714286,"\u7d2f\u7a4d\u9054\u6210\u7387":63.0,"\u9054\u6210":false,"\u9054\u6210\u7387":68.6},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":9,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":66.2,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":10,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":69.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":8,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":70.6,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":11,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":74.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":8,"MA8":8.375,"\u7d2f\u7a4d\u9054\u6210\u7387":74.3,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":8,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":74.7,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":15,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":79.8,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":17,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.6,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":13,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":91.7,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":92.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":10,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":16,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.6,"\u9054\u6210":true,"\u9054\u6210\u7387":156.9},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":11,"MA8":13.375,"\u7d2f\u7a4d\u9054\u6210\u7387":96.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":13,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":97.6,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":12,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":98.5,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":8,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":97.6,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":10,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":97.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":8,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.9,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":7,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":95.9,"\u9054\u6210":false,"\u9054\u6210\u7387":68.6},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":10,"MA8":9.875,"\u7d2f\u7a4d\u9054\u6210\u7387":95.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":9,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":95.7,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":10,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":95.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":6,"MA8":8.5,"\u7d2f\u7a4d\u9054\u6210\u7387":94.6,"\u9054\u6210":false,"\u9054\u6210\u7387":58.8},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":93.1,"\u9054\u6210":false,"\u9054\u6210\u7387":49.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":11,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":93.6,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":11,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":94.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":11,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":94.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":11,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":94.8,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":15,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.2,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":8,"MA8":9.75,"\u7d2f\u7a4d\u9054\u6210\u7387":95.7,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":13,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":96.5,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":97.8,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":11,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":98.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":98.7,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":12,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":99.2,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":99.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":100.0,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":9,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":99.7,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":2,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":98.0,"\u9054\u6210":false,"\u9054\u6210\u7387":19.6},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":11,"MA8":10.25,"\u7d2f\u7a4d\u9054\u6210\u7387":98.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":12,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":98.6,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":14,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":99.4,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":8,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":99.0,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":11,"MA8":10.125,"\u7d2f\u7a4d\u9054\u6210\u7387":99.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":13,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":99.7,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5}], metrics: {"avg_weekly": 10.34, "achieve_rate": 101.3, "last_year_avg": 9.78, "last4_avg": 11.5, "last4_achieve_rate": 112.7, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 10.2;
        const canvasId     = 'chart-æ³Œå°¿å™¨ç§‘';
        const safeName     = 'æ³Œå°¿å™¨ç§‘';
        const fragId       = 'frag-mode-æ³Œå°¿å™¨ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-ç”£å©¦äººç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-ç”£å©¦äººç§‘">
        <div class="dept-header">
            <h2>&#128202; ç”£å©¦äººç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 12.5ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-ç”£å©¦äººç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-ç”£å©¦äººç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-ç”£å©¦äººç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-ç”£å©¦äººç§‘">10.9 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-ç”£å©¦äººç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-ç”£å©¦äººç§‘">87.5%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-ç”£å©¦äººç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-ç”£å©¦äººç§‘">10.5 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-ç”£å©¦äººç§‘">
                <div class="metric-label" id="lbl-fcst-ç”£å©¦äººç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-ç”£å©¦äººç§‘">12.2 ä»¶/é€±<br><span style="font-size:0.75em">(98%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-ç”£å©¦äººç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.2 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-ç”£å©¦äººç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":11,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":11,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":11,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":11,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":5,"MA8":9.8,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":false,"\u9054\u6210\u7387":40.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":10,"MA8":9.8333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":78.7,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":12,"MA8":10.1428571429,"\u7d2f\u7a4d\u9054\u6210\u7387":81.1,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":9,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":7,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":10,"MA8":9.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.6,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":13,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":9,"MA8":9.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.3,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":7,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.5,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":10,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.7,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":9,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":8,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":76.5,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":14,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.6,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":8,"MA8":9.75,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":12,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":78.7,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":14,"MA8":10.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":15,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":11,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":8,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":16,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.9,"\u9054\u6210":true,"\u9054\u6210\u7387":128.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":7,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":9,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":11,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":12,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":8,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":12,"MA8":11.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":18,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":true,"\u9054\u6210\u7387":144.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":10,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":85.3,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":12,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.6,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":12,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":85.8,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.5,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":14,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.2,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.6,"\u9054\u6210":false,"\u9054\u6210\u7387":24.0},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":12,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":85.9,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":14,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.5,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":13,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.9,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":15,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.6,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":9,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":87.3,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":12,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":87.5,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0}], metrics: {"avg_weekly": 10.93, "achieve_rate": 87.5, "last_year_avg": 10.53, "last4_avg": 12.25, "last4_achieve_rate": 98.0, "needed_per_week": 0.25} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/11","\u9031\u4ef6\u6570":4,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":32.0,"\u9054\u6210":false,"\u9054\u6210\u7387":32.0},{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":12,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":64.0,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":13,"MA8":9.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":12,"MA8":10.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":12,"MA8":10.6,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":10,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.0,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":12,"MA8":10.7142857143,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":11,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":11,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.2,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":11,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":11,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":86.5,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":5,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":40.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":10,"MA8":10.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":12,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.4,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":9,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":7,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":10,"MA8":9.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.9,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":13,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.2,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":9,"MA8":9.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":7,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":10,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":9,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":8,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":79.3,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":14,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":8,"MA8":9.75,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":12,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":80.6,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":14,"MA8":10.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":15,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.1,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":11,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":8,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":16,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.5,"\u9054\u6210":true,"\u9054\u6210\u7387":128.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":7,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.5,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":9,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":11,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":12,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.7,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":8,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":12,"MA8":11.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.5,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":18,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":85.0,"\u9054\u6210":true,"\u9054\u6210\u7387":144.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":10,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.9,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":85.3,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":12,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.6,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":12,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":85.8,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":14,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.0,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.6,"\u9054\u6210":false,"\u9054\u6210\u7387":24.0},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":12,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":85.8,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":14,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":13,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.7,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":15,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.4,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":9,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":87.1,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":12,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":87.2,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0}], metrics: {"avg_weekly": 11.08, "achieve_rate": 88.7, "last_year_avg": 10.16, "last4_avg": 12.25, "last4_achieve_rate": 98.0, "needed_per_week": 0.25} },
        };
        const weeklyTarget = 12.5;
        const canvasId     = 'chart-ç”£å©¦äººç§‘';
        const safeName     = 'ç”£å©¦äººç§‘';
        const fragId       = 'frag-mode-ç”£å©¦äººç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-çš®è†šç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-çš®è†šç§‘">
        <div class="dept-header">
            <h2>&#128202; çš®è†šç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 1.2ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-çš®è†šç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-çš®è†šç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-çš®è†šç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-çš®è†šç§‘">1.6 ä»¶</div>
            </div>
            <div class="summary-card " id="card-ach-çš®è†šç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value success" id="val-ach-çš®è†šç§‘">134.1%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-çš®è†šç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-çš®è†šç§‘">1.0 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-çš®è†šç§‘">
                <div class="metric-label" id="lbl-fcst-çš®è†šç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-çš®è†šç§‘">1.5 ä»¶/é€±<br><span style="font-size:0.75em">(125%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-çš®è†šç§‘">&#9989; ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-çš®è†šç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":1,"MA8":1.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":2,"MA8":1.6,"\u7d2f\u7a4d\u9054\u6210\u7387":133.3,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":1.5714285714,"\u7d2f\u7a4d\u9054\u6210\u7387":131.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":120.4,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":116.7,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":113.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":109.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":1,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":104.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":2,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":107.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":2,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":109.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":112.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":4,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":121.2,"\u9054\u6210":true,"\u9054\u6210\u7387":333.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":126.8,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":128.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":130.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":131.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":135.8,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":136.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":137.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":138.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":139.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":140.6,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":141.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":144.6,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":142.9,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":141.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":141.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":142.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":141.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":141.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":1,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":140.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":138.9,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":139.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":140.2,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7}], metrics: {"avg_weekly": 1.61, "achieve_rate": 134.1, "last_year_avg": 1.02, "last4_avg": 1.5, "last4_achieve_rate": 125.0, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":1,"MA8":1.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":104.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":1,"MA8":1.2,"\u7d2f\u7a4d\u9054\u6210\u7387":100.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":2,"MA8":1.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":1,"MA8":1.2857142857,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":114.6,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":2,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":116.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":121.2,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":118.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":121.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":119.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":116.7,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":114.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":112.7,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":109.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":1,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":108.3,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":2,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":108.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":2,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":110.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":112.2,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":4,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":119.0,"\u9054\u6210":true,"\u9054\u6210\u7387":333.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":123.6,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":126.3,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":127.6,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":131.3,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":132.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":133.3,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":134.3,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":135.1,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":136.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":136.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":139.6,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":138.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":136.9,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":137.6,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":138.3,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":137.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":137.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":1,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":136.5,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":135.4,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":136.1,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":136.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7}], metrics: {"avg_weekly": 1.57, "achieve_rate": 131.1, "last_year_avg": 0.98, "last4_avg": 1.5, "last4_achieve_rate": 125.0, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 1.2;
        const canvasId     = 'chart-çš®è†šç§‘';
        const safeName     = 'çš®è†šç§‘';
        const fragId       = 'frag-mode-çš®è†šç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-è€³é¼»å’½å–‰ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-è€³é¼»å’½å–‰ç§‘">
        <div class="dept-header">
            <h2>&#128202; è€³é¼»å’½å–‰ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 8.1ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-è€³é¼»å’½å–‰ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-è€³é¼»å’½å–‰ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-è€³é¼»å’½å–‰ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-è€³é¼»å’½å–‰ç§‘">7.6 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-è€³é¼»å’½å–‰ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-è€³é¼»å’½å–‰ç§‘">93.9%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-è€³é¼»å’½å–‰ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-è€³é¼»å’½å–‰ç§‘">6.8 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-è€³é¼»å’½å–‰ç§‘">
                <div class="metric-label" id="lbl-fcst-è€³é¼»å’½å–‰ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-è€³é¼»å’½å–‰ç§‘">9.0 ä»¶/é€±<br><span style="font-size:0.75em">(111%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-è€³é¼»å’½å–‰ç§‘">&#9989; ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-è€³é¼»å’½å–‰ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":7,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":4,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":3,"MA8":4.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":57.6,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":8,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":4.6,"\u7d2f\u7a4d\u9054\u6210\u7387":56.8,"\u9054\u6210":false,"\u9054\u6210\u7387":12.3},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":9,"MA8":5.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":65.8,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":6,"MA8":5.4285714286,"\u7d2f\u7a4d\u9054\u6210\u7387":67.0,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":6,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":5,"MA8":5.25,"\u7d2f\u7a4d\u9054\u6210\u7387":67.2,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":6,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":70.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":9,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":74.1,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":5,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":73.1,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":9,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":75.8,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":9,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":3,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":77.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":11,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":6,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":79.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":8,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":10,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.9,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":12,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":148.1},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":7,"MA8":8.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":11,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":10,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":89.7,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":7,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":4,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":10,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.4,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":9,"MA8":8.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.1,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":24.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":11,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":89.5,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":10,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":5,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":89.7,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":91.7,"\u9054\u6210":true,"\u9054\u6210\u7387":160.5},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":9,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":92.2,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":6,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":91.8,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":10,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":92.6,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":8,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":91.4,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":8,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":91.5,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":10,"MA8":8.375,"\u7d2f\u7a4d\u9054\u6210\u7387":92.3,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":8,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":12,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":93.7,"\u9054\u6210":true,"\u9054\u6210\u7387":148.1},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":10,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":94.4,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":6,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":93.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1}], metrics: {"avg_weekly": 7.61, "achieve_rate": 93.9, "last_year_avg": 6.85, "last4_avg": 9.0, "last4_achieve_rate": 111.1, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/11","\u9031\u4ef6\u6570":4,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":49.4,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":5,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":55.6,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":7,"MA8":5.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":65.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":11,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":10,"MA8":7.4,"\u7d2f\u7a4d\u9054\u6210\u7387":91.4,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":7,"MA8":7.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":9,"MA8":7.5714285714,"\u7d2f\u7a4d\u9054\u6210\u7387":93.5,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":7,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":92.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":4,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":87.8,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":3,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":8,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":false,"\u9054\u6210\u7387":12.3},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":9,"MA8":6.0,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":6,"MA8":5.875,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":6,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":79.8,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":5,"MA8":5.25,"\u7d2f\u7a4d\u9054\u6210\u7387":78.7,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":6,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":79.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":9,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":5,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":9,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":9,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.1,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":3,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.1,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":11,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.0,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":6,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":8,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.1,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":10,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.5,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":86.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":12,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":88.1,"\u9054\u6210":true,"\u9054\u6210\u7387":148.1},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":7,"MA8":8.75,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":11,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.5,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":10,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":7,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":90.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":4,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.2,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":10,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":90.2,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":9,"MA8":8.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.8,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":24.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":11,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":90.2,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":10,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":91.0,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":5,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.3,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.0,"\u9054\u6210":true,"\u9054\u6210\u7387":160.5},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":9,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":92.4,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":6,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":92.0,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":10,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":92.7,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":8,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":91.7,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":8,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":91.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":10,"MA8":8.375,"\u7d2f\u7a4d\u9054\u6210\u7387":92.5,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":8,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":12,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":93.7,"\u9054\u6210":true,"\u9054\u6210\u7387":148.1},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":10,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":94.3,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":6,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":93.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1}], metrics: {"avg_weekly": 7.73, "achieve_rate": 95.4, "last_year_avg": 6.83, "last4_avg": 9.0, "last4_achieve_rate": 111.1, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 8.1;
        const canvasId     = 'chart-è€³é¼»å’½å–‰ç§‘';
        const safeName     = 'è€³é¼»å’½å–‰ç§‘';
        const fragId       = 'frag-mode-è€³é¼»å’½å–‰ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-è„³ç¥çµŒå¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-è„³ç¥çµŒå¤–ç§‘">
        <div class="dept-header">
            <h2>&#128202; è„³ç¥çµŒå¤–ç§‘</h2>
            <div class="dept-target">é€±æ¬¡ç›®æ¨™: 3.0ä»¶</div>
        </div>

        <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-è„³ç¥çµŒå¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-è„³ç¥çµŒå¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-è„³ç¥çµŒå¤–ç§‘">é€±å¹³å‡ä»¶æ•°ï¼ˆé›†è¨ˆæœŸé–“ï¼‰</div>
                <div class="metric-value" id="val-avg-è„³ç¥çµŒå¤–ç§‘">2.7 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-è„³ç¥çµŒå¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-è„³ç¥çµŒå¤–ç§‘">89.9%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-è„³ç¥çµŒå¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-è„³ç¥çµŒå¤–ç§‘">2.2 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-è„³ç¥çµŒå¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-è„³ç¥çµŒå¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-è„³ç¥çµŒå¤–ç§‘">3.2 ä»¶/é€±<br><span style="font-size:0.75em">(108%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-è„³ç¥çµŒå¤–ç§‘">&#9989; ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-è„³ç¥çµŒå¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":100.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":3,"MA8":2.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":62.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":73.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":69.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":72.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":71.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.2,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":79.2,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.4,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":1,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":79.6,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":6,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":88.3,"\u9054\u6210":true,"\u9054\u6210\u7387":200.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":4,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":89.4,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":91.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":4,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":93.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":92.3,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":95.1,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":3,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":96.6,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":98.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":98.9,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":1,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":96.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":98.0,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":3.25,"\u7d2f\u7a4d\u9054\u6210\u7387":96.1,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":95.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":93.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":4,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":94.9,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":7,"MA8":3.125,"\u7d2f\u7a4d\u9054\u6210\u7387":98.3,"\u9054\u6210":true,"\u9054\u6210\u7387":233.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.4,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":1,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.8,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":2,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7}], metrics: {"avg_weekly": 2.7, "achieve_rate": 89.9, "last_year_avg": 2.21, "last4_avg": 3.25, "last4_achieve_rate": 108.3, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/11","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":33.3,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":33.3,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":4,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":1,"MA8":1.8333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":61.1,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":70.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":70.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":69.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":64.4,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":70.6,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":68.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":70.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":70.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":73.0,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":72.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":75.4,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":1,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":76.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":6,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":true,"\u9054\u6210\u7387":200.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":4,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":84.5,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.9,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":86.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":4,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":87.5,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.9,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":89.2,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":3,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":89.5,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":90.7,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":93.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":1,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":91.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":92.5,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":3.25,"\u7d2f\u7a4d\u9054\u6210\u7387":91.1,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":91.5,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.9,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":89.6,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":4,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":90.6,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":7,"MA8":3.125,"\u7d2f\u7a4d\u9054\u6210\u7387":93.6,"\u9054\u6210":true,"\u9054\u6210\u7387":233.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":1,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":2,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7}], metrics: {"avg_weekly": 2.65, "achieve_rate": 88.2, "last_year_avg": 2.22, "last4_avg": 3.25, "last4_achieve_rate": 108.3, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 3.0;
        const canvasId     = 'chart-è„³ç¥çµŒå¤–ç§‘';
        const safeName     = 'è„³ç¥çµŒå¤–ç§‘';
        const fragId       = 'frag-mode-è„³ç¥çµŒå¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last4_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last4_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last4_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last4_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘4é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>

            </div>
        </div>
        
        <script>
            // Chart.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded!');
            }
            
            function switchDepartment() {
                const selector = document.getElementById('dept-selector');
                const selectedValue = selector.value;
                const placeholder = document.getElementById('placeholder');
                const allFragments = document.querySelectorAll('.dept-fragment');
                
                // ã™ã¹ã¦éè¡¨ç¤º
                placeholder.style.display = 'none';
                allFragments.forEach(f => {
                    f.classList.remove('active');
                    f.style.display = 'none';
                });
                
                if (!selectedValue) {
                    placeholder.style.display = 'block';
                    return;
                }
                
                // é¸æŠã•ã‚ŒãŸè¨ºç™‚ç§‘ã‚’è¡¨ç¤º
                const targetFragment = document.getElementById('fragment-' + selectedValue);
                if (targetFragment) {
                    targetFragment.classList.add('active');
                    targetFragment.style.display = 'block';
                } else {
                    placeholder.style.display = 'block';
                }
            }

            // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚°ãƒ©ãƒ•ç”¨ï¼‰ â”€â”€
            const INT_DUAL = true;
            const annPerfData = [{"dept": "çš®è†šç§‘", "avg": 1.61, "tgt": 1.2, "rate": 134.1, "pct_fill": 5.7, "tgt_pct": 4.3, "css": "achieved", "badge": "âœ…"}, {"dept": "æ­¯ç§‘å£è…”å¤–ç§‘", "avg": 3.63, "tgt": 3.2, "rate": 113.5, "pct_fill": 12.9, "tgt_pct": 11.3, "css": "achieved", "badge": "âœ…"}, {"dept": "æ³Œå°¿å™¨ç§‘", "avg": 10.74, "tgt": 10.2, "rate": 105.3, "pct_fill": 38.1, "tgt_pct": 36.2, "css": "achieved", "badge": "âœ…"}, {"dept": "æ•´å½¢å¤–ç§‘", "avg": 28.2, "tgt": 27.2, "rate": 103.7, "pct_fill": 100.0, "tgt_pct": 96.5, "css": "achieved", "badge": "âœ…"}, {"dept": "è€³é¼»å’½å–‰ç§‘", "avg": 7.61, "tgt": 8.1, "rate": 93.9, "pct_fill": 27.0, "tgt_pct": 28.7, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "è„³ç¥çµŒå¤–ç§‘", "avg": 2.7, "tgt": 3.0, "rate": 89.9, "pct_fill": 9.6, "tgt_pct": 10.6, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘", "avg": 12.59, "tgt": 14.1, "rate": 89.3, "pct_fill": 44.6, "tgt_pct": 50.0, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ç”£å©¦äººç§‘", "avg": 10.93, "tgt": 12.5, "rate": 87.5, "pct_fill": 38.8, "tgt_pct": 44.3, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ä¹³è…ºå¤–ç§‘", "avg": 6.48, "tgt": 8.1, "rate": 80.0, "pct_fill": 23.0, "tgt_pct": 28.7, "css": "below", "badge": "ğŸ”´"}, {"dept": "å‘¼å¸å™¨å¤–ç§‘", "avg": 2.17, "tgt": 2.8, "rate": 77.6, "pct_fill": 7.7, "tgt_pct": 9.9, "css": "below", "badge": "ğŸ”´"}, {"dept": "å½¢æˆå¤–ç§‘", "avg": 2.3, "tgt": 3.0, "rate": 76.8, "pct_fill": 8.2, "tgt_pct": 10.6, "css": "below", "badge": "ğŸ”´"}, {"dept": "å¿ƒè‡“è¡€ç®¡å¤–ç§‘", "avg": 1.37, "tgt": 2.1, "rate": 65.2, "pct_fill": 4.9, "tgt_pct": 7.4, "css": "below", "badge": "ğŸ”´"}];
            const rolPerfData = [{"dept": "çš®è†šç§‘", "avg": 1.57, "tgt": 1.2, "rate": 131.1, "pct_fill": 5.6, "tgt_pct": 4.2, "css": "achieved", "badge": "âœ…"}, {"dept": "æ­¯ç§‘å£è…”å¤–ç§‘", "avg": 3.53, "tgt": 3.2, "rate": 110.3, "pct_fill": 12.5, "tgt_pct": 11.3, "css": "achieved", "badge": "âœ…"}, {"dept": "æ•´å½¢å¤–ç§‘", "avg": 28.25, "tgt": 27.2, "rate": 103.9, "pct_fill": 100.0, "tgt_pct": 96.3, "css": "achieved", "badge": "âœ…"}, {"dept": "æ³Œå°¿å™¨ç§‘", "avg": 10.34, "tgt": 10.2, "rate": 101.3, "pct_fill": 36.6, "tgt_pct": 36.1, "css": "achieved", "badge": "âœ…"}, {"dept": "è€³é¼»å’½å–‰ç§‘", "avg": 7.73, "tgt": 8.1, "rate": 95.4, "pct_fill": 27.4, "tgt_pct": 28.7, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘", "avg": 12.58, "tgt": 14.1, "rate": 89.2, "pct_fill": 44.5, "tgt_pct": 49.9, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ç”£å©¦äººç§‘", "avg": 11.08, "tgt": 12.5, "rate": 88.7, "pct_fill": 39.2, "tgt_pct": 44.2, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "è„³ç¥çµŒå¤–ç§‘", "avg": 2.65, "tgt": 3.0, "rate": 88.2, "pct_fill": 9.4, "tgt_pct": 10.6, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "å‘¼å¸å™¨å¤–ç§‘", "avg": 2.26, "tgt": 2.8, "rate": 80.8, "pct_fill": 8.0, "tgt_pct": 9.9, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ä¹³è…ºå¤–ç§‘", "avg": 6.5, "tgt": 8.1, "rate": 80.3, "pct_fill": 23.0, "tgt_pct": 28.7, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "å½¢æˆå¤–ç§‘", "avg": 2.22, "tgt": 3.0, "rate": 74.2, "pct_fill": 7.9, "tgt_pct": 10.6, "css": "below", "badge": "ğŸ”´"}, {"dept": "å¿ƒè‡“è¡€ç®¡å¤–ç§‘", "avg": 1.42, "tgt": 2.1, "rate": 67.6, "pct_fill": 5.0, "tgt_pct": 7.4, "css": "below", "badge": "ğŸ”´"}];
            let intCurrentMode = 'annual';

            function switchIntMode(mode) {
                if (!INT_DUAL) return;
                intCurrentMode = mode;
                const isRolling = (mode === 'rolling');
                document.getElementById('int-btn-annual') .classList.toggle('active', !isRolling);
                document.getElementById('int-btn-rolling').classList.toggle('active',  isRolling);
                const title = document.getElementById('perf-chart-title');
                if (title) title.textContent = 'ğŸ“Š è¨ºç™‚ç§‘åˆ¥ å…¨èº«éº»é…”ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆ' + (isRolling ? 'ç›´è¿‘365æ—¥' : 'ä»Šå¹´åº¦') + 'ï¼‰';
                renderPerfRows(isRolling ? rolPerfData : annPerfData);
            }

            function renderPerfRows(data) {
                if (!data || !data.length) return;
                const container = document.getElementById('perf-rows');
                if (!container) return;
                container.innerHTML = data.map(r => `
                    <div class="perf-row">
                        <div class="perf-dept ${r.css}" title="${r.dept}">${r.dept}</div>
                        <div class="perf-act-tgt">${r.avg.toFixed(1)}ä»¶/é€± / ç›®æ¨™${r.tgt}ä»¶</div>
                        <div class="perf-bar-wrap">
                            <div class="perf-bar-fill ${r.css}" style="width:${r.pct_fill}%"></div>
                            <div class="perf-target-line" style="width:${r.tgt_pct}%"></div>
                        </div>
                        <div class="perf-rate">${r.rate.toFixed(0)}%</div>
                        <div class="perf-badge">${r.badge}</div>
                    </div>
                `).join('');
            }
        </script>
    </body>
    </html>
    