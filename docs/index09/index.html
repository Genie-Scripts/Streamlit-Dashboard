
    <!DOCTYPE html>
    <html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ğŸ¥ è¨ºç™‚ç§‘åˆ¥é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆçµ±åˆç‰ˆï¼ˆä»Šå¹´åº¦ï¼‰</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
        <style>
            /* â•â• DESIGN TOKENS â•â• */
            :root {
                --bg-page:      #F0F2F5;
                --bg-card:      #FFFFFF;
                --bg-elevated:  #F7F9FC;
                --bg-header:    #1D2B3A;
                --border:       #DCE1E9;
                --border-mid:   #C4CCD8;
                --accent:       #3A6EA5;
                --accent-light: #EEF3FA;
                --accent-hover: #2F5A8A;
                --text-primary:   #1A2535;
                --text-secondary: #5A6A82;
                --text-muted:     #94A3B8;
                --success:      #1A9E6A;
                --success-bg:   #EDFAF4;
                --warning:      #C87A00;
                --warning-bg:   #FEF6E4;
                --danger:       #C0293B;
                --danger-bg:    #FEF0F2;
                --bar-achieved: #1A9E6A;
                --bar-near:     #E09B00;
                --bar-below:    #D93650;
                --font-ui:   'Noto Sans JP', sans-serif;
                --font-mono: 'IBM Plex Mono', monospace;
                --r-sm: 6px; --r-md: 10px; --r-lg: 14px;
            }
            * { box-sizing: border-box; margin: 0; padding: 0; }
            body {
                font-family: var(--font-ui);
                background: var(--bg-page);
                color: var(--text-primary);
                line-height: 1.6;
                min-height: 100vh;
            }
            ::-webkit-scrollbar { width: 6px; }
            ::-webkit-scrollbar-track { background: var(--bg-page); }
            ::-webkit-scrollbar-thumb { background: var(--border-mid); border-radius: 3px; }

            /* â•â• HEADER â•â• */
            .site-header {
                background: var(--bg-header);
                color: #E8EEF5;
                padding: 0 40px;
                height: 64px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                position: sticky;
                top: 0;
                z-index: 200;
                border-bottom: 2px solid var(--accent);
            }
            .header-brand { display: flex; align-items: center; gap: 14px; }
            .header-badge {
                background: var(--accent); color: #fff;
                font-size: 0.62rem; font-weight: 700;
                letter-spacing: 0.14em; text-transform: uppercase;
                padding: 3px 9px; border-radius: 4px;
            }
            .header-title { font-size: 1.05rem; font-weight: 600; color: #E8EEF5; }
            .header-meta-row {
                display: flex; align-items: center; gap: 20px;
                font-size: 0.75rem; color: #7A90A8;
                font-family: var(--font-mono); margin-left: 20px;
            }
            .header-meta-row span { display: flex; align-items: center; gap: 5px; }
            .header-actions { display: flex; gap: 8px; }

            /* â•â• BUTTONS â•â• */
            .btn {
                display: inline-flex; align-items: center; gap: 6px;
                padding: 7px 16px; border-radius: var(--r-sm);
                font-size: 0.8rem; font-weight: 500; cursor: pointer;
                transition: all 0.15s; text-decoration: none;
                border: 1px solid transparent; font-family: var(--font-ui); line-height: 1;
            }
            .btn-outline {
                background: transparent; color: #AAB8C8; border-color: #3A4E62;
            }
            .btn-outline:hover { background: rgba(255,255,255,0.06); color: #E8EEF5; border-color: #6A8098; }
            .btn-solid { background: var(--accent); color: #fff; border-color: var(--accent); }
            .btn-solid:hover { background: var(--accent-hover); }

            /* â•â• LAYOUT â•â• */
            .container { max-width: 1280px; margin: 0 auto; padding: 28px 32px; }

            /* â•â• SECTION HEAD â•â• */
            .section-head { display: flex; align-items: center; gap: 10px; margin: 0 0 14px; }
            .section-head-label {
                font-size: 0.68rem; font-weight: 700; letter-spacing: 0.14em;
                color: var(--text-muted); text-transform: uppercase; white-space: nowrap;
            }
            .section-head::after { content: ''; flex: 1; height: 1px; background: var(--border); }

            /* â•â• TAB BAR â•â• */
            .tab-bar {
                display: flex; gap: 2px;
                background: var(--bg-card); border: 1px solid var(--border);
                border-radius: var(--r-md); padding: 4px; margin-bottom: 24px;
                width: fit-content; box-shadow: 0 1px 3px rgba(0,0,0,0.06);
            }
            .tab-btn {
                padding: 8px 20px; border-radius: var(--r-sm);
                font-size: 0.82rem; font-weight: 500; cursor: pointer;
                border: 1px solid transparent; background: transparent;
                color: var(--text-secondary); transition: all 0.15s;
                font-family: var(--font-ui); display: flex; align-items: center; gap: 7px;
            }
            .tab-btn.active {
                background: var(--accent); color: #fff; border-color: var(--accent);
                box-shadow: 0 1px 4px rgba(58,110,165,0.25);
            }
            .tab-btn:hover:not(.active) { background: var(--accent-light); color: var(--accent); }

            /* â•â• PERF CARD â•â• */
            .perf-card {
                background: var(--bg-card); border: 1px solid var(--border);
                border-radius: var(--r-lg); overflow: hidden; margin-bottom: 28px;
                box-shadow: 0 1px 4px rgba(0,0,0,0.06);
            }
            .perf-card-header {
                padding: 16px 24px; border-bottom: 1px solid var(--border);
                display: flex; justify-content: space-between; align-items: center;
                background: var(--bg-elevated);
            }
            .perf-card-title { font-size: 0.9rem; font-weight: 600; color: var(--text-primary); }

            /* mode buttons (inside perf card & fragments) */
            .mode-switch-bar, .frag-mode-bar { display: flex; gap: 3px; }
            .mode-btn, .frag-mode-btn {
                padding: 5px 14px; border-radius: 5px;
                font-size: 0.75rem; font-weight: 500; cursor: pointer;
                border: 1px solid var(--border); background: transparent;
                color: var(--text-secondary); transition: all 0.15s; font-family: var(--font-ui);
            }
            .mode-btn.active, .frag-mode-btn.active {
                background: var(--accent); color: #fff; border-color: var(--accent);
            }
            .mode-btn:hover:not(.active), .frag-mode-btn:hover:not(.active) {
                background: var(--accent-light); color: var(--accent); border-color: var(--accent);
            }

            /* â•â• PERF ROWS â•â• */
            .perf-row {
                display: grid;
                grid-template-columns: 148px 200px 1fr 68px 28px;
                align-items: center; gap: 16px; padding: 9px 24px;
                border-bottom: 1px solid var(--border); transition: background 0.1s;
            }
            .perf-row:last-child { border-bottom: none; }
            .perf-row:hover { background: var(--bg-elevated); }
            .perf-dept {
                font-size: 0.78rem; font-weight: 600; padding: 3px 10px;
                border-radius: 4px; text-align: center;
                white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            }
            .perf-dept.achieved { background: var(--success-bg); color: var(--success); }
            .perf-dept.near     { background: var(--warning-bg); color: var(--warning); }
            .perf-dept.below    { background: var(--danger-bg);  color: var(--danger);  }
            .perf-act-tgt {
                font-family: var(--font-mono); font-size: 0.77rem; color: var(--text-secondary);
            }
            .perf-act-tgt strong { color: var(--text-primary); font-size: 0.85rem; }
            .perf-bar-wrap {
                position: relative; height: 7px;
                background: var(--bg-elevated); border-radius: 4px;
                border: 1px solid var(--border); overflow: visible;
            }
            .perf-bar-fill {
                position: absolute; left: 0; top: -1px;
                height: calc(100% + 2px); border-radius: 3px;
                transition: width 0.7s cubic-bezier(.22,.68,0,1.1);
            }
            .perf-bar-fill.achieved { background: var(--bar-achieved); }
            .perf-bar-fill.near     { background: var(--bar-near); }
            .perf-bar-fill.below    { background: var(--bar-below); }
            .perf-target-line {
                position: absolute; top: -5px; width: 2px; height: 17px;
                background: var(--accent); border-radius: 1px; opacity: 0.6;
            }
            .perf-rate {
                font-family: var(--font-mono); font-size: 0.88rem;
                font-weight: 600; text-align: right;
            }
            .perf-rate.achieved { color: var(--success); }
            .perf-rate.near     { color: var(--warning); }
            .perf-rate.below    { color: var(--danger);  }
            .perf-badge {
                width: 8px; height: 8px; border-radius: 50%; margin: auto;
            }
            .perf-badge.achieved { background: var(--success); }
            .perf-badge.near     { background: var(--warning); }
            .perf-badge.below    { background: var(--danger);  }
            .perf-legend {
                padding: 9px 24px; display: flex; gap: 20px;
                font-size: 0.72rem; color: var(--text-muted);
                border-top: 1px solid var(--border); background: var(--bg-elevated);
            }
            .legend-item { display: flex; align-items: center; gap: 6px; }
            .legend-dot { width: 7px; height: 7px; border-radius: 50%; }

            /* â•â• SELECTOR â•â• */
            .selector-card {
                background: var(--bg-card); border: 1px solid var(--border);
                border-radius: var(--r-lg); padding: 20px 24px; margin-bottom: 20px;
                box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            }
            .selector-label {
                font-size: 0.72rem; font-weight: 700; letter-spacing: 0.1em;
                color: var(--text-muted); text-transform: uppercase; margin-bottom: 10px;
            }
            #dept-selector {
                width: 100%; padding: 11px 40px 11px 14px;
                font-size: 0.9rem; background: var(--bg-elevated);
                color: var(--text-primary); border: 1.5px solid var(--border);
                border-radius: var(--r-sm); cursor: pointer;
                transition: border-color 0.15s, box-shadow 0.15s;
                font-family: var(--font-ui); appearance: none;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='none'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%235A6A82' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
                background-repeat: no-repeat; background-position: right 14px center;
            }
            #dept-selector:focus {
                outline: none; border-color: var(--accent);
                box-shadow: 0 0 0 3px rgba(58,110,165,0.12);
            }

            /* â•â• CONTENT AREA â•â• */
            .content-area {
                position: relative; min-height: 480px;
            }

            /* â•â• PLACEHOLDER â•â• */
            .placeholder {
                background: var(--bg-card); border: 1px solid var(--border);
                border-radius: var(--r-lg); overflow: hidden; position: relative;
                min-height: 480px; display: flex; flex-direction: column;
                align-items: center; justify-content: center;
                box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            }
            .placeholder::before {
                content: ''; position: absolute; inset: 0;
                background-image: linear-gradient(var(--border) 1px,transparent 1px),
                                  linear-gradient(90deg,var(--border) 1px,transparent 1px);
                background-size: 40px 40px; opacity: 0.5;
            }
            .placeholder::after {
                content: ''; position: absolute; inset: 0;
                background: radial-gradient(ellipse 60% 55% at 50% 50%, transparent 20%, var(--bg-card) 75%);
            }
            .placeholder-inner {
                position: relative; z-index: 1; text-align: center; padding: 40px;
                animation: ph-float 4s ease-in-out infinite;
            }
            @keyframes ph-float {
                0%,100% { transform: translateY(0); } 50% { transform: translateY(-6px); }
            }
            .placeholder-rings {
                position: relative; width: 88px; height: 88px; margin: 0 auto 22px;
            }
            .ring {
                position: absolute; border-radius: 50%;
                border: 1px solid var(--accent); opacity: 0;
                animation: ring-pulse 3.6s ease-out infinite;
            }
            .ring-1 { inset:20px; animation-delay:0s;   opacity:0.6; }
            .ring-2 { inset:10px; animation-delay:0.6s; }
            .ring-3 { inset:0;    animation-delay:1.2s; }
            @keyframes ring-pulse {
                0%   { opacity:0;   transform:scale(0.85); }
                30%  { opacity:0.4; }
                100% { opacity:0;   transform:scale(1.15); }
            }
            .placeholder-icon-circle {
                position:absolute; inset:20px; background:var(--accent-light);
                border-radius:50%; display:flex; align-items:center; justify-content:center;
            }
            .placeholder-title { font-size:1rem; font-weight:600; color:var(--text-primary); margin-bottom:6px; }
            .placeholder-sub { font-size:0.8rem; color:var(--text-secondary); line-height:1.7; }
            .placeholder-chips {
                display:flex; flex-wrap:wrap; justify-content:center;
                gap:6px; margin-top:18px; max-width:420px;
            }
            .ph-chip {
                font-size:0.72rem; padding:4px 12px; border-radius:20px;
                background:var(--accent-light); color:var(--accent);
                border:1px solid rgba(58,110,165,0.2); font-weight:500;
            }

            /* â•â• DEPT FRAGMENT â•â• */
            .dept-fragment { display: none; }
            .dept-fragment.active {
                display: block !important;
                animation: slide-in 0.28s cubic-bezier(.22,.68,0,1.1);
            }
            @keyframes slide-in {
                from { opacity:0; transform:translateY(10px); }
                to   { opacity:1; transform:translateY(0); }
            }

            /* â•â• DEPT DETAIL (fragmentå†…) â•â• */
            .dept-content {
                background: var(--bg-card); border: 1px solid var(--border);
                border-radius: var(--r-lg); overflow: hidden;
                box-shadow: 0 1px 4px rgba(0,0,0,0.06);
            }
            .dept-header {
                padding: 20px 28px 16px; border-bottom: 1px solid var(--border);
                background: var(--bg-elevated);
                display: flex; align-items: center; justify-content: space-between; gap: 16px;
            }
            .dept-header h2 {
                font-size: 1.15rem; font-weight: 700; color: var(--text-primary); line-height: 1;
            }
            .dept-target {
                font-size: 0.76rem; color: var(--text-secondary);
                font-family: var(--font-mono); margin-top: 4px;
            }

            /* â•â• KPI CARDS (summary-cards) â•â• */
            .summary-cards {
                display: grid; grid-template-columns: repeat(4,1fr);
                background: var(--border); gap: 1px;
                border-bottom: 1px solid var(--border);
            }
            .summary-card {
                background: var(--bg-card); padding: 18px 24px;
            }
            .summary-card.alert { background: var(--danger-bg); }
            .metric-label {
                font-size: 0.7rem; font-weight: 700; letter-spacing: 0.08em;
                text-transform: uppercase; color: var(--text-muted); margin-bottom: 6px;
            }
            .metric-value {
                font-size: 1.9rem; font-weight: 700;
                font-family: var(--font-mono); color: var(--text-primary); line-height: 1.1;
            }
            .metric-value.success { color: var(--success); }
            .metric-value.danger  { color: var(--danger);  }

            /* â•â• ALERT BANNERS â•â• */
            .needed-alert {
                margin: 14px 24px; padding: 10px 16px; border-radius: var(--r-sm);
                font-size: 0.82rem; display: flex; align-items: center; gap: 9px; font-weight: 500;
                background: var(--warning-bg); border: 1px solid rgba(200,122,0,0.3); color: var(--warning);
            }
            .needed-ok {
                margin: 14px 24px; padding: 10px 16px; border-radius: var(--r-sm);
                font-size: 0.82rem; display: flex; align-items: center; gap: 9px; font-weight: 500;
                background: var(--success-bg); border: 1px solid rgba(26,158,106,0.3); color: var(--success);
            }

            /* â•â• CHART â•â• */
            .chart-container {
                position: relative; height: 460px; padding: 20px 24px 26px;
            }

            /* â•â• PRINT â•â• */
            @media print {
                .site-header { position: static; }
                .selector-card { display: none; }
            }

            /* â•â• RESPONSIVE â•â• */
            @media (max-width: 768px) {
                .container { padding: 16px; }
                .site-header { padding: 0 16px; height: auto; min-height: 56px; flex-wrap: wrap; gap: 8px; padding: 8px 16px; }
                .header-meta-row { display: none; }
                .summary-cards { grid-template-columns: repeat(2,1fr); }
                .perf-row { grid-template-columns: 110px 1fr 52px 20px; }
                .perf-act-tgt { display: none; }
            }
        </style>
    </head>
    <body>
        <header class="site-header">
            <div class="header-brand">
                <div class="header-badge">å…¨èº«éº»é…”æ‰‹è¡“</div>
                <div class="header-title">è¨ºç™‚ç§‘åˆ¥é€±æ¬¡å®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆ</div>
                <div class="header-meta-row">
                    <span>&#128197; åˆ†ææœŸé–“ï¼ˆä»Šå¹´åº¦ï¼‰: 2025-04-01 ã€œ 2026-02-23</span>
                    <span>&#128336; ä½œæˆ: 2026å¹´02æœˆ24æ—¥ 07:20</span>
                </div>
            </div>
            <div class="header-actions">
                <button onclick="window.print()" class="btn btn-outline">&#128424; å°åˆ·</button>
                <a href="../index.html" class="btn btn-solid">&#8593; ãƒãƒ¼ã‚¿ãƒ«ã«æˆ»ã‚‹</a>
            </div>
        </header>

        <div class="container">
            
        <div class="section-head"><span class="section-head-label">å…¨è¨ºç™‚ç§‘ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¦‚è¦§</span></div>
        <div class="tab-bar"><button id="int-btn-annual" class="tab-btn active" onclick="switchIntMode('annual')">&#128197; å¹´åº¦æ¯”è¼ƒï¼ˆä»Šå¹´åº¦ vs æ˜¨å¹´åº¦ï¼‰</button><button id="int-btn-rolling" class="tab-btn " onclick="switchIntMode('rolling')">&#128260; ç›´è¿‘365æ—¥ï¼ˆç›´è¿‘ vs å‰æœŸï¼‰</button></div>
        <div class="perf-card">
            <div class="perf-card-header">
                <span class="perf-card-title" id="perf-chart-title">è¨ºç™‚ç§‘åˆ¥ å…¨èº«éº»é…”ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆä»Šå¹´åº¦ï¼‰</span>
            </div>
            <div id="perf-rows"><div class="perf-row"><div class="perf-dept achieved" title="çš®è†šç§‘">çš®è†šç§‘</div><div class="perf-act-tgt">1.6ä»¶/é€± / ç›®æ¨™1.2ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill achieved" style="width:5.7%"></div><div class="perf-target-line" style="width:4.3%"></div></div><div class="perf-rate">133%</div><div class="perf-badge">âœ…</div></div><div class="perf-row"><div class="perf-dept achieved" title="æ­¯ç§‘å£è…”å¤–ç§‘">æ­¯ç§‘å£è…”å¤–ç§‘</div><div class="perf-act-tgt">3.7ä»¶/é€± / ç›®æ¨™3.2ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill achieved" style="width:13.1%"></div><div class="perf-target-line" style="width:11.3%"></div></div><div class="perf-rate">116%</div><div class="perf-badge">âœ…</div></div><div class="perf-row"><div class="perf-dept achieved" title="æ³Œå°¿å™¨ç§‘">æ³Œå°¿å™¨ç§‘</div><div class="perf-act-tgt">10.8ä»¶/é€± / ç›®æ¨™10.2ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill achieved" style="width:38.3%"></div><div class="perf-target-line" style="width:36.2%"></div></div><div class="perf-rate">106%</div><div class="perf-badge">âœ…</div></div><div class="perf-row"><div class="perf-dept achieved" title="æ•´å½¢å¤–ç§‘">æ•´å½¢å¤–ç§‘</div><div class="perf-act-tgt">28.2ä»¶/é€± / ç›®æ¨™27.2ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill achieved" style="width:100.0%"></div><div class="perf-target-line" style="width:96.4%"></div></div><div class="perf-rate">104%</div><div class="perf-badge">âœ…</div></div><div class="perf-row"><div class="perf-dept near" title="è€³é¼»å’½å–‰ç§‘">è€³é¼»å’½å–‰ç§‘</div><div class="perf-act-tgt">7.6ä»¶/é€± / ç›®æ¨™8.1ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill near" style="width:26.8%"></div><div class="perf-target-line" style="width:28.7%"></div></div><div class="perf-rate">94%</div><div class="perf-badge">ğŸŸ¡</div></div><div class="perf-row"><div class="perf-dept near" title="ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘</div><div class="perf-act-tgt">12.7ä»¶/é€± / ç›®æ¨™14.1ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill near" style="width:45.1%"></div><div class="perf-target-line" style="width:50.0%"></div></div><div class="perf-rate">90%</div><div class="perf-badge">ğŸŸ¡</div></div><div class="perf-row"><div class="perf-dept near" title="è„³ç¥çµŒå¤–ç§‘">è„³ç¥çµŒå¤–ç§‘</div><div class="perf-act-tgt">2.7ä»¶/é€± / ç›®æ¨™3.0ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill near" style="width:9.5%"></div><div class="perf-target-line" style="width:10.6%"></div></div><div class="perf-rate">89%</div><div class="perf-badge">ğŸŸ¡</div></div><div class="perf-row"><div class="perf-dept near" title="ç”£å©¦äººç§‘">ç”£å©¦äººç§‘</div><div class="perf-act-tgt">10.9ä»¶/é€± / ç›®æ¨™12.5ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill near" style="width:38.7%"></div><div class="perf-target-line" style="width:44.3%"></div></div><div class="perf-rate">87%</div><div class="perf-badge">ğŸŸ¡</div></div><div class="perf-row"><div class="perf-dept near" title="ä¹³è…ºå¤–ç§‘">ä¹³è…ºå¤–ç§‘</div><div class="perf-act-tgt">6.5ä»¶/é€± / ç›®æ¨™8.1ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill near" style="width:23.0%"></div><div class="perf-target-line" style="width:28.7%"></div></div><div class="perf-rate">80%</div><div class="perf-badge">ğŸŸ¡</div></div><div class="perf-row"><div class="perf-dept below" title="å‘¼å¸å™¨å¤–ç§‘">å‘¼å¸å™¨å¤–ç§‘</div><div class="perf-act-tgt">2.2ä»¶/é€± / ç›®æ¨™2.8ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill below" style="width:7.7%"></div><div class="perf-target-line" style="width:9.9%"></div></div><div class="perf-rate">78%</div><div class="perf-badge">ğŸ”´</div></div><div class="perf-row"><div class="perf-dept below" title="å½¢æˆå¤–ç§‘">å½¢æˆå¤–ç§‘</div><div class="perf-act-tgt">2.3ä»¶/é€± / ç›®æ¨™3.0ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill below" style="width:8.1%"></div><div class="perf-target-line" style="width:10.6%"></div></div><div class="perf-rate">77%</div><div class="perf-badge">ğŸ”´</div></div><div class="perf-row"><div class="perf-dept below" title="å¿ƒè‡“è¡€ç®¡å¤–ç§‘">å¿ƒè‡“è¡€ç®¡å¤–ç§‘</div><div class="perf-act-tgt">1.4ä»¶/é€± / ç›®æ¨™2.1ä»¶</div><div class="perf-bar-wrap"><div class="perf-bar-fill below" style="width:4.9%"></div><div class="perf-target-line" style="width:7.4%"></div></div><div class="perf-rate">66%</div><div class="perf-badge">ğŸ”´</div></div></div>
            <div class="perf-legend">
                <div class="legend-item"><div class="legend-dot" style="background:#1A9E6A"></div>é”æˆç‡ â‰¥ 100%</div>
                <div class="legend-item"><div class="legend-dot" style="background:#E09B00"></div>80ã€œ99%</div>
                <div class="legend-item"><div class="legend-dot" style="background:#D93650"></div>&lt; 80%</div>
                <span style="margin-left:auto;font-size:0.7rem;font-family:var(--font-mono);color:var(--text-muted)">ç¸¦ç·š = é€±æ¬¡ç›®æ¨™</span>
            </div>
        </div>

            <div class="section-head"><span class="section-head-label">è¨ºç™‚ç§‘è©³ç´°</span></div>
            <div class="selector-card">
                <div class="selector-label">è¨ºç™‚ç§‘ã‚’é¸æŠ</div>
                <select id="dept-selector" onchange="switchDepartment()">
                    <option value="">-- è¨ºç™‚ç§‘ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                    <option value="ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘</option>
<option value="ä¹³è…ºå¤–ç§‘">ä¹³è…ºå¤–ç§‘</option>
<option value="å‘¼å¸å™¨å¤–ç§‘">å‘¼å¸å™¨å¤–ç§‘</option>
<option value="å½¢æˆå¤–ç§‘">å½¢æˆå¤–ç§‘</option>
<option value="å¿ƒè‡“è¡€ç®¡å¤–ç§‘">å¿ƒè‡“è¡€ç®¡å¤–ç§‘</option>
<option value="æ•´å½¢å¤–ç§‘">æ•´å½¢å¤–ç§‘</option>
<option value="æ­¯ç§‘å£è…”å¤–ç§‘">æ­¯ç§‘å£è…”å¤–ç§‘</option>
<option value="æ³Œå°¿å™¨ç§‘">æ³Œå°¿å™¨ç§‘</option>
<option value="ç”£å©¦äººç§‘">ç”£å©¦äººç§‘</option>
<option value="çš®è†šç§‘">çš®è†šç§‘</option>
<option value="è€³é¼»å’½å–‰ç§‘">è€³é¼»å’½å–‰ç§‘</option>
<option value="è„³ç¥çµŒå¤–ç§‘">è„³ç¥çµŒå¤–ç§‘</option>

                </select>
            </div>

            <div class="content-area">
                <div id="placeholder" class="placeholder">
                    <div class="placeholder-inner">
                        <div class="placeholder-rings">
                            <div class="ring ring-1"></div>
                            <div class="ring ring-2"></div>
                            <div class="ring ring-3"></div>
                            <div class="placeholder-icon-circle">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#3A6EA5" stroke-width="1.6" stroke-linecap="round">
                                    <path d="M3 3v18h18"/><path d="M7 16l4-5 4 3 4-6"/>
                                </svg>
                            </div>
                        </div>
                        <div class="placeholder-title">è¨ºç™‚ç§‘ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                        <div class="placeholder-sub">ä¸Šã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‹ã‚‰è¨ºç™‚ç§‘ã‚’é¸ã¶ã¨<br>é€±æ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰ã¨é”æˆçŠ¶æ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
                        <div class="placeholder-chips" id="ph-chips"></div>
                    </div>
                </div>
                <div id="fragment-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">
        <div class="dept-header">
            <div>
                <h2>ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 14.1ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">12.7 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">90.2%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">12.8 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">13.8 ä»¶/é€±<br><span style="font-size:0.75em">(98%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.3 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":13,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.2,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":8,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":74.5,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":12,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.0,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":12,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.8,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":11,"MA8":11.2,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":13,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":15,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.1,"\u9054\u6210":true,"\u9054\u6210\u7387":106.4},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":19,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":91.3,"\u9054\u6210":true,"\u9054\u6210\u7387":134.8},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":10,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":14,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.1,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":11,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":13,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":89.2,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":10,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.8,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":18,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.7,"\u9054\u6210":true,"\u9054\u6210\u7387":127.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":14,"MA8":13.625,"\u7d2f\u7a4d\u9054\u6210\u7387":91.3,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":8,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":89.1,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":13,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":12,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":12,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":88.8,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":16,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":90.1,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":16,"MA8":13.625,"\u7d2f\u7a4d\u9054\u6210\u7387":91.2,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":10,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":90.3,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":13,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":90.3,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":14,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.7,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":11,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":90.2,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":8,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":88.9,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":13,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":16,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":11,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.3,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":13,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.8,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":88.3,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":14,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":88.5,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":14,"MA8":12.75,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":87.1,"\u9054\u6210":false,"\u9054\u6210\u7387":21.3},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":13,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":87.2,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":17,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":true,"\u9054\u6210\u7387":120.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":16,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.6,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":16,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.1,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":17,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":89.8,"\u9054\u6210":true,"\u9054\u6210\u7387":120.6},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":14,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.0,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":14,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.2,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3}], metrics: {"avg_weekly": 12.72, "achieve_rate": 90.2, "last_year_avg": 12.85, "last8_avg": 13.75, "last8_achieve_rate": 97.5, "needed_per_week": 0.35} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":17,"MA8":17.0,"\u7d2f\u7a4d\u9054\u6210\u7387":120.6,"\u9054\u6210":true,"\u9054\u6210\u7387":120.6},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":10,"MA8":13.5,"\u7d2f\u7a4d\u9054\u6210\u7387":95.7,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":13,"MA8":13.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":94.6,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":11,"MA8":12.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.4,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":14,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.2,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":13,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.2,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":8,"MA8":12.2857142857,"\u7d2f\u7a4d\u9054\u6210\u7387":87.1,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":12,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":86.9,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":12,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.7,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":11,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.8,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":13,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":15,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":88.1,"\u9054\u6210":true,"\u9054\u6210\u7387":106.4},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":19,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":91.7,"\u9054\u6210":true,"\u9054\u6210\u7387":134.8},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":10,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":90.2,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":14,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.8,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":11,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":90.0,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":13,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.1,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":10,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":18,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":91.1,"\u9054\u6210":true,"\u9054\u6210\u7387":127.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":14,"MA8":13.625,"\u7d2f\u7a4d\u9054\u6210\u7387":91.5,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":8,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":89.8,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":13,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.9,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":12,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":89.7,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":12,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":89.5,"\u9054\u6210":false,"\u9054\u6210\u7387":85.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":16,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":16,"MA8":13.625,"\u7d2f\u7a4d\u9054\u6210\u7387":91.4,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":10,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":90.6,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":13,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":90.7,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":14,"MA8":13.25,"\u7d2f\u7a4d\u9054\u6210\u7387":91.0,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":11,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":8,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":89.5,"\u9054\u6210":false,"\u9054\u6210\u7387":56.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":13,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.5,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.0,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":16,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.7,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.2,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":11,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.8,"\u9054\u6210":false,"\u9054\u6210\u7387":78.0},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.1,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":13,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.2,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":88.8,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":14,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.1,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":10,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.7,"\u9054\u6210":false,"\u9054\u6210\u7387":70.9},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":88.9,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":14,"MA8":12.75,"\u7d2f\u7a4d\u9054\u6210\u7387":89.1,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":87.6,"\u9054\u6210":false,"\u9054\u6210\u7387":21.3},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":13,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":87.7,"\u9054\u6210":false,"\u9054\u6210\u7387":92.2},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":17,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":true,"\u9054\u6210\u7387":120.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":16,"MA8":12.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.9,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":16,"MA8":12.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.4,"\u9054\u6210":true,"\u9054\u6210\u7387":113.5},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":17,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.1,"\u9054\u6210":true,"\u9054\u6210\u7387":120.6},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":14,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.3,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":14,"MA8":13.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.4,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3}], metrics: {"avg_weekly": 12.72, "achieve_rate": 90.2, "last_year_avg": 12.77, "last8_avg": 13.75, "last8_achieve_rate": 97.5, "needed_per_week": 0.35} },
        };
        const weeklyTarget = 14.1;
        const canvasId     = 'chart-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘';
        const safeName     = 'ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘';
        const fragId       = 'frag-mode-ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-ä¹³è…ºå¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-ä¹³è…ºå¤–ç§‘">
        <div class="dept-header">
            <div>
                <h2>ä¹³è…ºå¤–ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 8.1ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-ä¹³è…ºå¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-ä¹³è…ºå¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-ä¹³è…ºå¤–ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-ä¹³è…ºå¤–ç§‘">6.5 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-ä¹³è…ºå¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-ä¹³è…ºå¤–ç§‘">80.1%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-ä¹³è…ºå¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-ä¹³è…ºå¤–ç§‘">7.1 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-ä¹³è…ºå¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-ä¹³è…ºå¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-ä¹³è…ºå¤–ç§‘">6.6 ä»¶/é€±<br><span style="font-size:0.75em">(82%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-ä¹³è…ºå¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>1.5 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-ä¹³è…ºå¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":8,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":8,"MA8":6.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":6,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":77.2,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":5,"MA8":6.0,"\u7d2f\u7a4d\u9054\u6210\u7387":74.1,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":3,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":8,"MA8":5.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":72.3,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":8,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":9,"MA8":6.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.1,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":7,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":7,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":8,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":9,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":6,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":6,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":5,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":80.5,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":8,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":8,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":3,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":7,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":6,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.1,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.3,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":6,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":9,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":6,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":6,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":5,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":7,"MA8":6.875,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":6,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":6,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":7,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":6,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4}], metrics: {"avg_weekly": 6.49, "achieve_rate": 80.1, "last_year_avg": 7.08, "last8_avg": 6.62, "last8_achieve_rate": 81.8, "needed_per_week": 1.47} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":8,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":6,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":8,"MA8":7.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":4,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":7,"MA8":6.6,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":8,"MA8":6.8333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":6.2857142857,"\u7d2f\u7a4d\u9054\u6210\u7387":77.6,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":8,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":6,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.6,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":5,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":3,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":74.1,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":8,"MA8":6.0,"\u7d2f\u7a4d\u9054\u6210\u7387":76.1,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":77.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":8,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":9,"MA8":6.875,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":7,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":7,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":8,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":9,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.9,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":6,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":6,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":5,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":8,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":8,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":3,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":7,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":6,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.3,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":6,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":9,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.2,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":6,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.4,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":6,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.2,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":5,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":7,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":7,"MA8":6.875,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":6,"MA8":6.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":6,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":7,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":6,"MA8":6.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":7,"MA8":6.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4}], metrics: {"avg_weekly": 6.48, "achieve_rate": 80.0, "last_year_avg": 7.08, "last8_avg": 6.62, "last8_achieve_rate": 81.8, "needed_per_week": 1.47} },
        };
        const weeklyTarget = 8.1;
        const canvasId     = 'chart-ä¹³è…ºå¤–ç§‘';
        const safeName     = 'ä¹³è…ºå¤–ç§‘';
        const fragId       = 'frag-mode-ä¹³è…ºå¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-å‘¼å¸å™¨å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-å‘¼å¸å™¨å¤–ç§‘">
        <div class="dept-header">
            <div>
                <h2>å‘¼å¸å™¨å¤–ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 2.8ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-å‘¼å¸å™¨å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-å‘¼å¸å™¨å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-å‘¼å¸å™¨å¤–ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-å‘¼å¸å™¨å¤–ç§‘">2.2 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-å‘¼å¸å™¨å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-å‘¼å¸å™¨å¤–ç§‘">77.5%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-å‘¼å¸å™¨å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-å‘¼å¸å™¨å¤–ç§‘">2.2 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-å‘¼å¸å™¨å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-å‘¼å¸å™¨å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-å‘¼å¸å™¨å¤–ç§‘">2.5 ä»¶/é€±<br><span style="font-size:0.75em">(89%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-å‘¼å¸å™¨å¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.3 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-å‘¼å¸å™¨å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":1,"MA8":1.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":66.3,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":4,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.9,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":77.9,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":77.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":76.5,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":4,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.8,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":78.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.5,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.7,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.8,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.3,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":79.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":79.0,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":4,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.9,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.6,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":79.2,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":78.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":77.7,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.7,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4}], metrics: {"avg_weekly": 2.17, "achieve_rate": 77.5, "last_year_avg": 2.22, "last8_avg": 2.5, "last8_achieve_rate": 89.3, "needed_per_week": 0.3} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":71.4,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":3,"MA8":2.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":4,"MA8":2.8,"\u7d2f\u7a4d\u9054\u6210\u7387":100.0,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":2,"MA8":2.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":2.5714285714,"\u7d2f\u7a4d\u9054\u6210\u7387":91.8,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":91.3,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":4,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":85.2,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":86.7,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":84.0,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":4,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":85.0,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.3,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.8,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":85.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.5,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.9,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":81.3,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":4,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":false,"\u9054\u6210\u7387":35.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":true,"\u9054\u6210\u7387":107.1},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":80.5,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.1,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.9,"\u9054\u6210":false,"\u9054\u6210\u7387":71.4}], metrics: {"avg_weekly": 2.22, "achieve_rate": 79.5, "last_year_avg": 2.19, "last8_avg": 2.5, "last8_achieve_rate": 89.3, "needed_per_week": 0.3} },
        };
        const weeklyTarget = 2.8;
        const canvasId     = 'chart-å‘¼å¸å™¨å¤–ç§‘';
        const safeName     = 'å‘¼å¸å™¨å¤–ç§‘';
        const fragId       = 'frag-mode-å‘¼å¸å™¨å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-å½¢æˆå¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-å½¢æˆå¤–ç§‘">
        <div class="dept-header">
            <div>
                <h2>å½¢æˆå¤–ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 3.0ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-å½¢æˆå¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-å½¢æˆå¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-å½¢æˆå¤–ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-å½¢æˆå¤–ç§‘">2.3 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-å½¢æˆå¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-å½¢æˆå¤–ç§‘">76.6%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-å½¢æˆå¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-å½¢æˆå¤–ç§‘">2.0 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-å½¢æˆå¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-å½¢æˆå¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-å½¢æˆå¤–ç§‘">2.4 ä»¶/é€±<br><span style="font-size:0.75em">(79%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-å½¢æˆå¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.6 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-å½¢æˆå¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":33.3,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":1,"MA8":1.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":55.6,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":3,"MA8":2.2,"\u7d2f\u7a4d\u9054\u6210\u7387":73.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":3,"MA8":2.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":3,"MA8":2.4285714286,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.8,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":74.4,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":73.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":5,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":4,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":84.2,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":3,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":85.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":2,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":84.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":1,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":1,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":79.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":79.2,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":76.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":74.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":3,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":75.3,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":76.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":76.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.5,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":4,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":78.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":77.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.6,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":3,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":79.1,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":78.5,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":78.3,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7}], metrics: {"avg_weekly": 2.3, "achieve_rate": 76.6, "last_year_avg": 2.01, "last8_avg": 2.38, "last8_achieve_rate": 79.2, "needed_per_week": 0.62} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":3,"MA8":2.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":1,"MA8":1.8333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":61.1,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":62.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":70.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":72.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":78.6,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":72.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":74.5,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":72.2,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":71.9,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":73.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":5,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.3,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":4,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":80.6,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":3,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":81.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":2,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":80.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":1,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":79.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":1,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.4,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":77.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":76.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":75.3,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":73.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":73.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":3,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":74.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":74.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":74.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":75.4,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":76.1,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":75.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":4,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":77.0,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":76.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":76.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.3,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":3,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7}], metrics: {"avg_weekly": 2.26, "achieve_rate": 75.4, "last_year_avg": 1.99, "last8_avg": 2.38, "last8_achieve_rate": 79.2, "needed_per_week": 0.62} },
        };
        const weeklyTarget = 3.0;
        const canvasId     = 'chart-å½¢æˆå¤–ç§‘';
        const safeName     = 'å½¢æˆå¤–ç§‘';
        const fragId       = 'frag-mode-å½¢æˆå¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-å¿ƒè‡“è¡€ç®¡å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">
        <div class="dept-header">
            <div>
                <h2>å¿ƒè‡“è¡€ç®¡å¤–ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 2.1ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-å¿ƒè‡“è¡€ç®¡å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-å¿ƒè‡“è¡€ç®¡å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">1.4 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">65.9%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">1.4 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">1.6 ä»¶/é€±<br><span style="font-size:0.75em">(77%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-å¿ƒè‡“è¡€ç®¡å¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.5 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-å¿ƒè‡“è¡€ç®¡å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":1,"MA8":1.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":89.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.6,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":76.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":190.5},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":3,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":85.0,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":1,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":80.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.1,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2}], metrics: {"avg_weekly": 1.38, "achieve_rate": 65.9, "last_year_avg": 1.44, "last8_avg": 1.62, "last8_achieve_rate": 77.4, "needed_per_week": 0.48} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":3,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":119.0,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":100.5,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":91.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":91.6,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":91.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":88.9,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":86.8,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.2,"\u9054\u6210":true,"\u9054\u6210\u7387":190.5},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":84.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":85.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":86.1,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.0,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.4,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.5,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":3,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":true,"\u9054\u6210\u7387":142.9},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":1,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.4,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":false,"\u9054\u6210\u7387":47.6},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.1,"\u9054\u6210":false,"\u9054\u6210\u7387":95.2}], metrics: {"avg_weekly": 1.44, "achieve_rate": 68.5, "last_year_avg": 1.34, "last8_avg": 1.62, "last8_achieve_rate": 77.4, "needed_per_week": 0.48} },
        };
        const weeklyTarget = 2.1;
        const canvasId     = 'chart-å¿ƒè‡“è¡€ç®¡å¤–ç§‘';
        const safeName     = 'å¿ƒè‡“è¡€ç®¡å¤–ç§‘';
        const fragId       = 'frag-mode-å¿ƒè‡“è¡€ç®¡å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-æ•´å½¢å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-æ•´å½¢å¤–ç§‘">
        <div class="dept-header">
            <div>
                <h2>æ•´å½¢å¤–ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 27.2ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-æ•´å½¢å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-æ•´å½¢å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-æ•´å½¢å¤–ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-æ•´å½¢å¤–ç§‘">28.2 ä»¶</div>
            </div>
            <div class="summary-card " id="card-ach-æ•´å½¢å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value success" id="val-ach-æ•´å½¢å¤–ç§‘">103.7%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-æ•´å½¢å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-æ•´å½¢å¤–ç§‘">25.3 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-æ•´å½¢å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-æ•´å½¢å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-æ•´å½¢å¤–ç§‘">27.1 ä»¶/é€±<br><span style="font-size:0.75em">(100%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-æ•´å½¢å¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.1 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-æ•´å½¢å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":29,"MA8":29.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":32,"MA8":30.5,"\u7d2f\u7a4d\u9054\u6210\u7387":112.1,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":32,"MA8":31.0,"\u7d2f\u7a4d\u9054\u6210\u7387":114.0,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":31,"MA8":31.0,"\u7d2f\u7a4d\u9054\u6210\u7387":114.0,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":19,"MA8":28.6,"\u7d2f\u7a4d\u9054\u6210\u7387":105.1,"\u9054\u6210":false,"\u9054\u6210\u7387":69.9},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":28,"MA8":28.5,"\u7d2f\u7a4d\u9054\u6210\u7387":104.8,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":29,"MA8":28.5714285714,"\u7d2f\u7a4d\u9054\u6210\u7387":105.0,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":26,"MA8":28.25,"\u7d2f\u7a4d\u9054\u6210\u7387":103.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":36,"MA8":29.125,"\u7d2f\u7a4d\u9054\u6210\u7387":107.0,"\u9054\u6210":true,"\u9054\u6210\u7387":132.4},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":28,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":30,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":107.0,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":32,"MA8":28.5,"\u7d2f\u7a4d\u9054\u6210\u7387":107.8,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":32,"MA8":30.125,"\u7d2f\u7a4d\u9054\u6210\u7387":108.6,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":24,"MA8":29.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":27,"MA8":29.375,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":25,"MA8":29.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.7,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":28,"MA8":28.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.5,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":29,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":105.6,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":25,"MA8":27.75,"\u7d2f\u7a4d\u9054\u6210\u7387":104.9,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":37,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":106.4,"\u9054\u6210":true,"\u9054\u6210\u7387":136.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":34,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.3,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":26,"MA8":28.875,"\u7d2f\u7a4d\u9054\u6210\u7387":106.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":30,"MA8":29.25,"\u7d2f\u7a4d\u9054\u6210\u7387":106.9,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":22,"MA8":28.875,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":false,"\u9054\u6210\u7387":80.9},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":30,"MA8":29.125,"\u7d2f\u7a4d\u9054\u6210\u7387":106.0,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":26,"MA8":28.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.6,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":31,"MA8":29.5,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":25,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.4,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":29,"MA8":27.375,"\u7d2f\u7a4d\u9054\u6210\u7387":105.5,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":27,"MA8":27.5,"\u7d2f\u7a4d\u9054\u6210\u7387":105.3,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":21,"MA8":26.375,"\u7d2f\u7a4d\u9054\u6210\u7387":104.4,"\u9054\u6210":false,"\u9054\u6210\u7387":77.2},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":32,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.8,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":33,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.3,"\u9054\u6210":true,"\u9054\u6210\u7387":121.3},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":23,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.7,"\u9054\u6210":false,"\u9054\u6210\u7387":84.6},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":27,"MA8":27.125,"\u7d2f\u7a4d\u9054\u6210\u7387":104.5,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":28,"MA8":27.5,"\u7d2f\u7a4d\u9054\u6210\u7387":104.5,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":30,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.6,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":36,"MA8":28.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.4,"\u9054\u6210":true,"\u9054\u6210\u7387":132.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":20,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.5,"\u9054\u6210":false,"\u9054\u6210\u7387":73.5},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":8,"MA8":25.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.7,"\u9054\u6210":false,"\u9054\u6210\u7387":29.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":23,"MA8":24.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":false,"\u9054\u6210\u7387":84.6},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":32,"MA8":25.5,"\u7d2f\u7a4d\u9054\u6210\u7387":102.6,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":33,"MA8":26.25,"\u7d2f\u7a4d\u9054\u6210\u7387":103.0,"\u9054\u6210":true,"\u9054\u6210\u7387":121.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":32,"MA8":26.75,"\u7d2f\u7a4d\u9054\u6210\u7387":103.4,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":34,"MA8":27.25,"\u7d2f\u7a4d\u9054\u6210\u7387":103.8,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":26,"MA8":26.0,"\u7d2f\u7a4d\u9054\u6210\u7387":103.7,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":29,"MA8":27.125,"\u7d2f\u7a4d\u9054\u6210\u7387":103.7,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6}], metrics: {"avg_weekly": 28.21, "achieve_rate": 103.7, "last_year_avg": 25.32, "last8_avg": 27.12, "last8_achieve_rate": 99.7, "needed_per_week": 0.07} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":31,"MA8":31.0,"\u7d2f\u7a4d\u9054\u6210\u7387":114.0,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":29,"MA8":30.0,"\u7d2f\u7a4d\u9054\u6210\u7387":110.3,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":32,"MA8":30.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":112.7,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":29,"MA8":30.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.2,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":24,"MA8":29.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":29,"MA8":29.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":32,"MA8":29.4285714286,"\u7d2f\u7a4d\u9054\u6210\u7387":108.2,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":32,"MA8":29.75,"\u7d2f\u7a4d\u9054\u6210\u7387":109.4,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":31,"MA8":29.75,"\u7d2f\u7a4d\u9054\u6210\u7387":109.9,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":19,"MA8":28.5,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":false,"\u9054\u6210\u7387":69.9},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":28,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.6,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":29,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.7,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":26,"MA8":28.25,"\u7d2f\u7a4d\u9054\u6210\u7387":104.9,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":36,"MA8":29.125,"\u7d2f\u7a4d\u9054\u6210\u7387":106.9,"\u9054\u6210":true,"\u9054\u6210\u7387":132.4},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":28,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":30,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":106.8,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":32,"MA8":28.5,"\u7d2f\u7a4d\u9054\u6210\u7387":107.5,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":32,"MA8":30.125,"\u7d2f\u7a4d\u9054\u6210\u7387":108.0,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":24,"MA8":29.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":27,"MA8":29.375,"\u7d2f\u7a4d\u9054\u6210\u7387":106.6,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":25,"MA8":29.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":28,"MA8":28.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.8,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":29,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":105.8,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":25,"MA8":27.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.2,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":37,"MA8":28.375,"\u7d2f\u7a4d\u9054\u6210\u7387":106.5,"\u9054\u6210":true,"\u9054\u6210\u7387":136.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":34,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.2,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":26,"MA8":28.875,"\u7d2f\u7a4d\u9054\u6210\u7387":106.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":30,"MA8":29.25,"\u7d2f\u7a4d\u9054\u6210\u7387":106.9,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":22,"MA8":28.875,"\u7d2f\u7a4d\u9054\u6210\u7387":106.0,"\u9054\u6210":false,"\u9054\u6210\u7387":80.9},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":30,"MA8":29.125,"\u7d2f\u7a4d\u9054\u6210\u7387":106.1,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":26,"MA8":28.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.8,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":31,"MA8":29.5,"\u7d2f\u7a4d\u9054\u6210\u7387":106.0,"\u9054\u6210":true,"\u9054\u6210\u7387":114.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":25,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.6,"\u9054\u6210":false,"\u9054\u6210\u7387":91.9},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":29,"MA8":27.375,"\u7d2f\u7a4d\u9054\u6210\u7387":105.6,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":27,"MA8":27.5,"\u7d2f\u7a4d\u9054\u6210\u7387":105.5,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":21,"MA8":26.375,"\u7d2f\u7a4d\u9054\u6210\u7387":104.7,"\u9054\u6210":false,"\u9054\u6210\u7387":77.2},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":32,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":105.0,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":33,"MA8":28.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.5,"\u9054\u6210":true,"\u9054\u6210\u7387":121.3},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":23,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.9,"\u9054\u6210":false,"\u9054\u6210\u7387":84.6},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":27,"MA8":27.125,"\u7d2f\u7a4d\u9054\u6210\u7387":104.8,"\u9054\u6210":false,"\u9054\u6210\u7387":99.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":28,"MA8":27.5,"\u7d2f\u7a4d\u9054\u6210\u7387":104.7,"\u9054\u6210":true,"\u9054\u6210\u7387":102.9},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":30,"MA8":27.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.9,"\u9054\u6210":true,"\u9054\u6210\u7387":110.3},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":36,"MA8":28.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.5,"\u9054\u6210":true,"\u9054\u6210\u7387":132.4},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":20,"MA8":28.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.8,"\u9054\u6210":false,"\u9054\u6210\u7387":73.5},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":8,"MA8":25.625,"\u7d2f\u7a4d\u9054\u6210\u7387":103.1,"\u9054\u6210":false,"\u9054\u6210\u7387":29.4},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":23,"MA8":24.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.7,"\u9054\u6210":false,"\u9054\u6210\u7387":84.6},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":32,"MA8":25.5,"\u7d2f\u7a4d\u9054\u6210\u7387":103.0,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":33,"MA8":26.25,"\u7d2f\u7a4d\u9054\u6210\u7387":103.4,"\u9054\u6210":true,"\u9054\u6210\u7387":121.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":32,"MA8":26.75,"\u7d2f\u7a4d\u9054\u6210\u7387":103.7,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":34,"MA8":27.25,"\u7d2f\u7a4d\u9054\u6210\u7387":104.1,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":26,"MA8":26.0,"\u7d2f\u7a4d\u9054\u6210\u7387":104.0,"\u9054\u6210":false,"\u9054\u6210\u7387":95.6},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":29,"MA8":27.125,"\u7d2f\u7a4d\u9054\u6210\u7387":104.0,"\u9054\u6210":true,"\u9054\u6210\u7387":106.6}], metrics: {"avg_weekly": 28.21, "achieve_rate": 103.7, "last_year_avg": 24.89, "last8_avg": 27.12, "last8_achieve_rate": 99.7, "needed_per_week": 0.07} },
        };
        const weeklyTarget = 27.2;
        const canvasId     = 'chart-æ•´å½¢å¤–ç§‘';
        const safeName     = 'æ•´å½¢å¤–ç§‘';
        const fragId       = 'frag-mode-æ•´å½¢å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-æ­¯ç§‘å£è…”å¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-æ­¯ç§‘å£è…”å¤–ç§‘">
        <div class="dept-header">
            <div>
                <h2>æ­¯ç§‘å£è…”å¤–ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 3.2ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-æ­¯ç§‘å£è…”å¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-æ­¯ç§‘å£è…”å¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-æ­¯ç§‘å£è…”å¤–ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-æ­¯ç§‘å£è…”å¤–ç§‘">3.7 ä»¶</div>
            </div>
            <div class="summary-card " id="card-ach-æ­¯ç§‘å£è…”å¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value success" id="val-ach-æ­¯ç§‘å£è…”å¤–ç§‘">115.7%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-æ­¯ç§‘å£è…”å¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-æ­¯ç§‘å£è…”å¤–ç§‘">2.8 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-æ­¯ç§‘å£è…”å¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-æ­¯ç§‘å£è…”å¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-æ­¯ç§‘å£è…”å¤–ç§‘">4.6 ä»¶/é€±<br><span style="font-size:0.75em">(145%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-æ­¯ç§‘å£è…”å¤–ç§‘">&#9989; ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-æ­¯ç§‘å£è…”å¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":2,"MA8":2.8,"\u7d2f\u7a4d\u9054\u6210\u7387":87.5,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":1,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":78.1,"\u9054\u6210":false,"\u9054\u6210\u7387":31.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":2.4285714286,"\u7d2f\u7a4d\u9054\u6210\u7387":75.9,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":70.3,"\u9054\u6210":false,"\u9054\u6210\u7387":31.2},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":69.4,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":68.8,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":71.0,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":70.3,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":5,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":5,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":3,"MA8":3.125,"\u7d2f\u7a4d\u9054\u6210\u7387":84.0,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":7,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":true,"\u9054\u6210\u7387":218.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.7,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":95.3,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":6,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":99.7,"\u9054\u6210":true,"\u9054\u6210\u7387":187.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.0,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":5,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":100.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":4,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":101.6,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":103.8,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":103.4,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":5,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.3,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":5,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.7,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":4,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":107.3,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.9,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":4,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":107.4,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":2,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":106.1,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":5,"MA8":3.875,"\u7d2f\u7a4d\u9054\u6210\u7387":107.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":3,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":5,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":108.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":5,"MA8":3.875,"\u7d2f\u7a4d\u9054\u6210\u7387":109.8,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":7,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":112.7,"\u9054\u6210":true,"\u9054\u6210\u7387":218.8},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":5,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":113.8,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":8,"MA8":5.0,"\u7d2f\u7a4d\u9054\u6210\u7387":117.2,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":3,"MA8":5.125,"\u7d2f\u7a4d\u9054\u6210\u7387":116.6,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":4,"MA8":5.0,"\u7d2f\u7a4d\u9054\u6210\u7387":116.8,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":5,"MA8":5.25,"\u7d2f\u7a4d\u9054\u6210\u7387":117.7,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":5,"MA8":5.25,"\u7d2f\u7a4d\u9054\u6210\u7387":118.6,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":3,"MA8":5.0,"\u7d2f\u7a4d\u9054\u6210\u7387":118.1,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":4,"MA8":4.625,"\u7d2f\u7a4d\u9054\u6210\u7387":118.2,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0}], metrics: {"avg_weekly": 3.7, "achieve_rate": 115.7, "last_year_avg": 2.78, "last8_avg": 4.62, "last8_achieve_rate": 144.5, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":4,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":4,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":2,"MA8":3.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":104.2,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":2,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.7,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":2,"MA8":2.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":89.3,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":2,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.3,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":1,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":31.2},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":82.4,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":78.1,"\u9054\u6210":false,"\u9054\u6210\u7387":31.2},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":76.9,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":75.9,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":77.1,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":76.2,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":5,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.9,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":5,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.1,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":3,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":85.5,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":3,"MA8":3.125,"\u7d2f\u7a4d\u9054\u6210\u7387":85.9,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":87.8,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":7,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.7,"\u9054\u6210":true,"\u9054\u6210\u7387":218.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.7,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":95.1,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":6,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":98.8,"\u9054\u6210":true,"\u9054\u6210\u7387":187.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":2,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":97.4,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":5,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":99.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":4,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":100.4,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":102.4,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":102.1,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":5,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":103.8,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":5,"MA8":4.375,"\u7d2f\u7a4d\u9054\u6210\u7387":105.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.1,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":4,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.7,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":3,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.4,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":4,"MA8":4.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":2,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":104.7,"\u9054\u6210":false,"\u9054\u6210\u7387":62.5},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":5,"MA8":3.875,"\u7d2f\u7a4d\u9054\u6210\u7387":106.1,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":3,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":105.8,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":5,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.0,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":5,"MA8":3.875,"\u7d2f\u7a4d\u9054\u6210\u7387":108.2,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":7,"MA8":4.25,"\u7d2f\u7a4d\u9054\u6210\u7387":110.9,"\u9054\u6210":true,"\u9054\u6210\u7387":218.8},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":5,"MA8":4.5,"\u7d2f\u7a4d\u9054\u6210\u7387":111.9,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":8,"MA8":5.0,"\u7d2f\u7a4d\u9054\u6210\u7387":115.1,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":3,"MA8":5.125,"\u7d2f\u7a4d\u9054\u6210\u7387":114.6,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":4,"MA8":5.0,"\u7d2f\u7a4d\u9054\u6210\u7387":114.8,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":5,"MA8":5.25,"\u7d2f\u7a4d\u9054\u6210\u7387":115.7,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":5,"MA8":5.25,"\u7d2f\u7a4d\u9054\u6210\u7387":116.5,"\u9054\u6210":true,"\u9054\u6210\u7387":156.2},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":3,"MA8":5.0,"\u7d2f\u7a4d\u9054\u6210\u7387":116.1,"\u9054\u6210":false,"\u9054\u6210\u7387":93.8},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":4,"MA8":4.625,"\u7d2f\u7a4d\u9054\u6210\u7387":116.3,"\u9054\u6210":true,"\u9054\u6210\u7387":125.0}], metrics: {"avg_weekly": 3.57, "achieve_rate": 111.5, "last_year_avg": 2.78, "last8_avg": 4.62, "last8_achieve_rate": 144.5, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 3.2;
        const canvasId     = 'chart-æ­¯ç§‘å£è…”å¤–ç§‘';
        const safeName     = 'æ­¯ç§‘å£è…”å¤–ç§‘';
        const fragId       = 'frag-mode-æ­¯ç§‘å£è…”å¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-æ³Œå°¿å™¨ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-æ³Œå°¿å™¨ç§‘">
        <div class="dept-header">
            <div>
                <h2>æ³Œå°¿å™¨ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 10.2ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-æ³Œå°¿å™¨ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-æ³Œå°¿å™¨ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-æ³Œå°¿å™¨ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-æ³Œå°¿å™¨ç§‘">10.8 ä»¶</div>
            </div>
            <div class="summary-card " id="card-ach-æ³Œå°¿å™¨ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value success" id="val-ach-æ³Œå°¿å™¨ç§‘">106.0%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-æ³Œå°¿å™¨ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-æ³Œå°¿å™¨ç§‘">9.6 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-æ³Œå°¿å™¨ç§‘">
                <div class="metric-label" id="lbl-fcst-æ³Œå°¿å™¨ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-æ³Œå°¿å™¨ç§‘">10.6 ä»¶/é€±<br><span style="font-size:0.75em">(104%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-æ³Œå°¿å™¨ç§‘">&#9989; ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-æ³Œå°¿å™¨ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":9,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":10,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":93.1,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":8,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":11,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":93.1,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":8,"MA8":9.2,"\u7d2f\u7a4d\u9054\u6210\u7387":90.2,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":8,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":15,"MA8":9.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":96.6,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":17,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":13,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":107.8,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":111.8,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":110.5,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":10,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":109.5,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":16,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":113.1,"\u9054\u6210":true,"\u9054\u6210\u7387":156.9},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":11,"MA8":13.375,"\u7d2f\u7a4d\u9054\u6210\u7387":112.7,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":13,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":113.7,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":12,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":114.0,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":8,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":111.9,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":10,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":8,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":109.4,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":7,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":107.4,"\u9054\u6210":false,"\u9054\u6210\u7387":68.6},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":10,"MA8":9.875,"\u7d2f\u7a4d\u9054\u6210\u7387":106.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":9,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":106.1,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":10,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":105.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":6,"MA8":8.5,"\u7d2f\u7a4d\u9054\u6210\u7387":103.8,"\u9054\u6210":false,"\u9054\u6210\u7387":58.8},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":101.6,"\u9054\u6210":false,"\u9054\u6210\u7387":49.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":11,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":101.8,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":11,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":11,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":11,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":102.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":15,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":103.9,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":8,"MA8":9.75,"\u7d2f\u7a4d\u9054\u6210\u7387":103.1,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":13,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":103.9,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":105.2,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":11,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":105.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":12,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":106.2,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":106.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":106.8,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":9,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":106.3,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":2,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":104.2,"\u9054\u6210":false,"\u9054\u6210\u7387":19.6},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":14,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":105.0,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":12,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":105.3,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":14,"MA8":10.875,"\u7d2f\u7a4d\u9054\u6210\u7387":106.0,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":8,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":105.4,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":11,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":105.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":13,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":105.9,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":11,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":106.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8}], metrics: {"avg_weekly": 10.81, "achieve_rate": 106.0, "last_year_avg": 9.65, "last8_avg": 10.62, "last8_achieve_rate": 104.2, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":9,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":7,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":false,"\u9054\u6210\u7387":68.6},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":9,"MA8":8.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":5,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":73.5,"\u9054\u6210":false,"\u9054\u6210\u7387":49.0},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":7,"MA8":7.4,"\u7d2f\u7a4d\u9054\u6210\u7387":72.5,"\u9054\u6210":false,"\u9054\u6210\u7387":68.6},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":9,"MA8":7.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":75.2,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":10,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":8,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":11,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":8,"MA8":8.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":8,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.1,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":15,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":17,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":13,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":98.7,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":98.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":10,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":16,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":101.9,"\u9054\u6210":true,"\u9054\u6210\u7387":156.9},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":11,"MA8":13.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":13,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":103.4,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":12,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":104.1,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":8,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":102.9,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":10,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":102.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":8,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":101.7,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":7,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":100.4,"\u9054\u6210":false,"\u9054\u6210\u7387":68.6},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":10,"MA8":9.875,"\u7d2f\u7a4d\u9054\u6210\u7387":100.3,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":9,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":99.9,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":10,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":99.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":6,"MA8":8.5,"\u7d2f\u7a4d\u9054\u6210\u7387":98.4,"\u9054\u6210":false,"\u9054\u6210\u7387":58.8},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":96.7,"\u9054\u6210":false,"\u9054\u6210\u7387":49.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":11,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":97.1,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":11,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":97.4,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":11,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":97.7,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":11,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":98.0,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":15,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":99.4,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":8,"MA8":9.75,"\u7d2f\u7a4d\u9054\u6210\u7387":98.9,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":13,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":99.6,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":100.9,"\u9054\u6210":true,"\u9054\u6210\u7387":147.1},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":11,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":101.1,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":101.7,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":12,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":102.1,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":10,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":102.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.0},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":102.8,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":9,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":102.5,"\u9054\u6210":false,"\u9054\u6210\u7387":88.2},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":2,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":100.7,"\u9054\u6210":false,"\u9054\u6210\u7387":19.6},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":14,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":101.4,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":12,"MA8":10.75,"\u7d2f\u7a4d\u9054\u6210\u7387":101.8,"\u9054\u6210":true,"\u9054\u6210\u7387":117.6},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":14,"MA8":10.875,"\u7d2f\u7a4d\u9054\u6210\u7387":102.5,"\u9054\u6210":true,"\u9054\u6210\u7387":137.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":8,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.0,"\u9054\u6210":false,"\u9054\u6210\u7387":78.4},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":11,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":102.2,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":13,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":102.7,"\u9054\u6210":true,"\u9054\u6210\u7387":127.5},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":11,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":102.8,"\u9054\u6210":true,"\u9054\u6210\u7387":107.8}], metrics: {"avg_weekly": 10.45, "achieve_rate": 102.5, "last_year_avg": 9.76, "last8_avg": 10.62, "last8_achieve_rate": 104.2, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 10.2;
        const canvasId     = 'chart-æ³Œå°¿å™¨ç§‘';
        const safeName     = 'æ³Œå°¿å™¨ç§‘';
        const fragId       = 'frag-mode-æ³Œå°¿å™¨ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-ç”£å©¦äººç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-ç”£å©¦äººç§‘">
        <div class="dept-header">
            <div>
                <h2>ç”£å©¦äººç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 12.5ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-ç”£å©¦äººç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-ç”£å©¦äººç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-ç”£å©¦äººç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-ç”£å©¦äººç§‘">10.9 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-ç”£å©¦äººç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-ç”£å©¦äººç§‘">87.3%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-ç”£å©¦äººç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-ç”£å©¦äººç§‘">10.5 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-ç”£å©¦äººç§‘">
                <div class="metric-label" id="lbl-fcst-ç”£å©¦äººç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-ç”£å©¦äººç§‘">11.0 ä»¶/é€±<br><span style="font-size:0.75em">(88%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-ç”£å©¦äººç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>1.5 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-ç”£å©¦äººç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":11,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":11,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":11,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":11,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":5,"MA8":9.8,"\u7d2f\u7a4d\u9054\u6210\u7387":78.4,"\u9054\u6210":false,"\u9054\u6210\u7387":40.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":10,"MA8":9.8333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":78.7,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":12,"MA8":10.1428571429,"\u7d2f\u7a4d\u9054\u6210\u7387":81.1,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":9,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":7,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":10,"MA8":9.375,"\u7d2f\u7a4d\u9054\u6210\u7387":77.6,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":13,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":9,"MA8":9.375,"\u7d2f\u7a4d\u9054\u6210\u7387":79.3,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":7,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.5,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":10,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.7,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":9,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":8,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":76.5,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":14,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":78.6,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":8,"MA8":9.75,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":12,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":78.7,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":14,"MA8":10.25,"\u7d2f\u7a4d\u9054\u6210\u7387":80.4,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":15,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.3,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":11,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.7,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":8,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.0,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":16,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.9,"\u9054\u6210":true,"\u9054\u6210\u7387":128.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":7,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":81.8,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":9,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":11,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":82.8,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":12,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":8,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":12,"MA8":11.125,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":18,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":true,"\u9054\u6210\u7387":144.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":10,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.7,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":85.3,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":12,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.6,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":12,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":85.8,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.5,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":14,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":87.2,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.6,"\u9054\u6210":false,"\u9054\u6210\u7387":24.0},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":12,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":85.9,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":86.7,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":13,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":87.1,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":15,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":87.8,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":9,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":87.5,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":12,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":87.7,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":9,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":87.3,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0}], metrics: {"avg_weekly": 10.91, "achieve_rate": 87.3, "last_year_avg": 10.53, "last8_avg": 11.0, "last8_achieve_rate": 88.0, "needed_per_week": 1.5} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":13,"MA8":13.0,"\u7d2f\u7a4d\u9054\u6210\u7387":104.0,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":12,"MA8":12.5,"\u7d2f\u7a4d\u9054\u6210\u7387":100.0,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":12,"MA8":12.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":98.7,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":10,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":94.0,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":12,"MA8":11.8,"\u7d2f\u7a4d\u9054\u6210\u7387":94.4,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":11,"MA8":11.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":93.3,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":11,"MA8":11.5714285714,"\u7d2f\u7a4d\u9054\u6210\u7387":92.6,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":11,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":92.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":11,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":91.6,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":5,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":40.0},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":10,"MA8":10.125,"\u7d2f\u7a4d\u9054\u6210\u7387":85.8,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":12,"MA8":10.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.7,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":9,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.5,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":7,"MA8":9.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.4,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":10,"MA8":9.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":13,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":84.5,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":9,"MA8":9.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.8,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":7,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.2,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":10,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.1,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":9,"MA8":9.25,"\u7d2f\u7a4d\u9054\u6210\u7387":81.6,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":8,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":80.8,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":14,"MA8":10.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.2,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":8,"MA8":9.75,"\u7d2f\u7a4d\u9054\u6210\u7387":81.4,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":12,"MA8":9.625,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":14,"MA8":10.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.2,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":15,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.6,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.9,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":11,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.0,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":8,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":16,"MA8":11.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":true,"\u9054\u6210\u7387":128.0},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":7,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":83.9,"\u9054\u6210":false,"\u9054\u6210\u7387":56.0},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":14,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":9,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":11,"MA8":10.5,"\u7d2f\u7a4d\u9054\u6210\u7387":84.5,"\u9054\u6210":false,"\u9054\u6210\u7387":88.0},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":12,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":84.8,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":8,"MA8":10.625,"\u7d2f\u7a4d\u9054\u6210\u7387":84.2,"\u9054\u6210":false,"\u9054\u6210\u7387":64.0},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":12,"MA8":11.125,"\u7d2f\u7a4d\u9054\u6210\u7387":84.5,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":18,"MA8":11.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.1,"\u9054\u6210":true,"\u9054\u6210\u7387":144.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":10,"MA8":11.75,"\u7d2f\u7a4d\u9054\u6210\u7387":85.9,"\u9054\u6210":false,"\u9054\u6210\u7387":80.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":12,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":12,"MA8":12.125,"\u7d2f\u7a4d\u9054\u6210\u7387":86.9,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":14,"MA8":12.375,"\u7d2f\u7a4d\u9054\u6210\u7387":87.4,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":14,"MA8":13.125,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":true,"\u9054\u6210\u7387":112.0},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":12.0,"\u7d2f\u7a4d\u9054\u6210\u7387":86.6,"\u9054\u6210":false,"\u9054\u6210\u7387":24.0},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":12,"MA8":11.25,"\u7d2f\u7a4d\u9054\u6210\u7387":86.8,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":15,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":87.5,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":13,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":87.8,"\u9054\u6210":true,"\u9054\u6210\u7387":104.0},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":15,"MA8":12.25,"\u7d2f\u7a4d\u9054\u6210\u7387":88.5,"\u9054\u6210":true,"\u9054\u6210\u7387":120.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":9,"MA8":11.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":12,"MA8":11.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.3,"\u9054\u6210":false,"\u9054\u6210\u7387":96.0},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":9,"MA8":11.0,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":72.0}], metrics: {"avg_weekly": 10.97, "achieve_rate": 87.8, "last_year_avg": 10.3, "last8_avg": 11.0, "last8_achieve_rate": 88.0, "needed_per_week": 1.5} },
        };
        const weeklyTarget = 12.5;
        const canvasId     = 'chart-ç”£å©¦äººç§‘';
        const safeName     = 'ç”£å©¦äººç§‘';
        const fragId       = 'frag-mode-ç”£å©¦äººç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-çš®è†šç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-çš®è†šç§‘">
        <div class="dept-header">
            <div>
                <h2>çš®è†šç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 1.2ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-çš®è†šç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-çš®è†šç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-çš®è†šç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-çš®è†šç§‘">1.6 ä»¶</div>
            </div>
            <div class="summary-card " id="card-ach-çš®è†šç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value success" id="val-ach-çš®è†šç§‘">133.0%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-çš®è†šç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-çš®è†šç§‘">1.0 ä»¶</div>
            </div>
            <div class="summary-card " id="card-fcst-çš®è†šç§‘">
                <div class="metric-label" id="lbl-fcst-çš®è†šç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value success" id="val-fcst-çš®è†šç§‘">1.5 ä»¶/é€±<br><span style="font-size:0.75em">(125%)</span></div>
            </div>
        </div>
        <div class="needed-ok" id="needed-çš®è†šç§‘">&#9989; ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­</div>

        <div class="chart-container">
            <canvas id="chart-çš®è†šç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":1,"MA8":1.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":2,"MA8":1.6,"\u7d2f\u7a4d\u9054\u6210\u7387":133.3,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":1.5714285714,"\u7d2f\u7a4d\u9054\u6210\u7387":131.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":120.4,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":116.7,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":113.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":109.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":1,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":105.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":104.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":2,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":107.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":2,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":109.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":112.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":4,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":121.2,"\u9054\u6210":true,"\u9054\u6210\u7387":333.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":126.8,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":128.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":130.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":131.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":135.8,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":136.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":137.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":138.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":139.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":140.6,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":141.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":144.6,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":142.9,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":141.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":141.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":142.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":141.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":141.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":1,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":140.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":138.9,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":139.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":140.2,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":138.9,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3}], metrics: {"avg_weekly": 1.6, "achieve_rate": 133.0, "last_year_avg": 1.02, "last8_avg": 1.5, "last8_achieve_rate": 125.0, "needed_per_week": 0.0} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":166.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":1,"MA8":1.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":104.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":2,"MA8":1.4,"\u7d2f\u7a4d\u9054\u6210\u7387":116.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":1,"MA8":1.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":2,"MA8":1.4285714286,"\u7d2f\u7a4d\u9054\u6210\u7387":119.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":114.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":2,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":120.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":121.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":121.8,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":119.0,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":116.7,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":114.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":112.7,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":1,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":1,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":109.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":108.3,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":107.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":2,"MA8":1.125,"\u7d2f\u7a4d\u9054\u6210\u7387":109.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":2,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":112.3,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":1,"MA8":1.25,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":2,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":113.3,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":112.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":4,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":120.4,"\u9054\u6210":true,"\u9054\u6210\u7387":333.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":3,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":125.0,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":126.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":127.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":129.0,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":132.8,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":133.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":134.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":135.7,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":136.6,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":137.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":138.2,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":3,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":141.0,"\u9054\u6210":true,"\u9054\u6210\u7387":250.0},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":139.6,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":138.2,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":138.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":2,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":139.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":1,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":138.3,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":2,"MA8":1.75,"\u7d2f\u7a4d\u9054\u6210\u7387":138.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":1,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":137.7,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":1,"MA8":1.375,"\u7d2f\u7a4d\u9054\u6210\u7387":136.5,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":2,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":137.2,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":2,"MA8":1.625,"\u7d2f\u7a4d\u9054\u6210\u7387":137.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":1,"MA8":1.5,"\u7d2f\u7a4d\u9054\u6210\u7387":136.7,"\u9054\u6210":false,"\u9054\u6210\u7387":83.3}], metrics: {"avg_weekly": 1.57, "achieve_rate": 131.1, "last_year_avg": 0.98, "last8_avg": 1.5, "last8_achieve_rate": 125.0, "needed_per_week": 0.0} },
        };
        const weeklyTarget = 1.2;
        const canvasId     = 'chart-çš®è†šç§‘';
        const safeName     = 'çš®è†šç§‘';
        const fragId       = 'frag-mode-çš®è†šç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-è€³é¼»å’½å–‰ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-è€³é¼»å’½å–‰ç§‘">
        <div class="dept-header">
            <div>
                <h2>è€³é¼»å’½å–‰ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 8.1ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-è€³é¼»å’½å–‰ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-è€³é¼»å’½å–‰ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-è€³é¼»å’½å–‰ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-è€³é¼»å’½å–‰ç§‘">7.6 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-è€³é¼»å’½å–‰ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-è€³é¼»å’½å–‰ç§‘">93.5%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-è€³é¼»å’½å–‰ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-è€³é¼»å’½å–‰ç§‘">6.8 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-è€³é¼»å’½å–‰ç§‘">
                <div class="metric-label" id="lbl-fcst-è€³é¼»å’½å–‰ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-è€³é¼»å’½å–‰ç§‘">7.9 ä»¶/é€±<br><span style="font-size:0.75em">(97%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-è€³é¼»å’½å–‰ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.2 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-è€³é¼»å’½å–‰ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":7,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":4,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":3,"MA8":4.6666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":57.6,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":8,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":4.6,"\u7d2f\u7a4d\u9054\u6210\u7387":56.8,"\u9054\u6210":false,"\u9054\u6210\u7387":12.3},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":9,"MA8":5.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":65.8,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":6,"MA8":5.4285714286,"\u7d2f\u7a4d\u9054\u6210\u7387":67.0,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":6,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":5,"MA8":5.25,"\u7d2f\u7a4d\u9054\u6210\u7387":67.2,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":6,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":67.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":70.7,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":9,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":74.1,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":5,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":73.1,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":9,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":75.8,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":9,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":78.2,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":3,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":77.0,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":11,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":80.2,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":6,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":79.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":8,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":80.9,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":10,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.9,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":12,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":148.1},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":7,"MA8":8.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":11,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":88.4,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":10,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":89.7,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":7,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":89.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":4,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":10,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":89.4,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":9,"MA8":8.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.1,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":88.0,"\u9054\u6210":false,"\u9054\u6210\u7387":24.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":11,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":89.5,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":10,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":5,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":89.7,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":91.7,"\u9054\u6210":true,"\u9054\u6210\u7387":160.5},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":9,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":92.2,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":6,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":91.8,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":10,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":92.6,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":8,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.8,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":91.4,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":8,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":91.5,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":10,"MA8":8.375,"\u7d2f\u7a4d\u9054\u6210\u7387":92.3,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":8,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":12,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":93.7,"\u9054\u6210":true,"\u9054\u6210\u7387":148.1},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":10,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":94.4,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":6,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":93.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":6,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":93.5,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1}], metrics: {"avg_weekly": 7.57, "achieve_rate": 93.5, "last_year_avg": 6.85, "last8_avg": 7.88, "last8_achieve_rate": 97.2, "needed_per_week": 0.22} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":7,"MA8":7.0,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":11,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":111.1,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":10,"MA8":9.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":115.2,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":7,"MA8":8.75,"\u7d2f\u7a4d\u9054\u6210\u7387":108.0,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":9,"MA8":8.8,"\u7d2f\u7a4d\u9054\u6210\u7387":108.6,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":7,"MA8":8.5,"\u7d2f\u7a4d\u9054\u6210\u7387":104.9,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":4,"MA8":7.8571428571,"\u7d2f\u7a4d\u9054\u6210\u7387":97.0,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":3,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":89.5,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":8,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.7,"\u9054\u6210":false,"\u9054\u6210\u7387":12.3},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":9,"MA8":6.0,"\u7d2f\u7a4d\u9054\u6210\u7387":85.3,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":6,"MA8":5.875,"\u7d2f\u7a4d\u9054\u6210\u7387":84.4,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":6,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.6,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":5,"MA8":5.25,"\u7d2f\u7a4d\u9054\u6210\u7387":82.0,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":6,"MA8":5.5,"\u7d2f\u7a4d\u9054\u6210\u7387":81.5,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"06\/10","\u9031\u4ef6\u6570":8,"MA8":6.125,"\u7d2f\u7a4d\u9054\u6210\u7387":82.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":9,"MA8":6.25,"\u7d2f\u7a4d\u9054\u6210\u7387":84.2,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":5,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.0,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":9,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":84.5,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":9,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":85.8,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":3,"MA8":6.75,"\u7d2f\u7a4d\u9054\u6210\u7387":83.5,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":8,"MA8":7.125,"\u7d2f\u7a4d\u9054\u6210\u7387":84.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":11,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":6,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":85.9,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":8,"MA8":7.375,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":10,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":87.8,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":8,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":88.2,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":12,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.4,"\u9054\u6210":true,"\u9054\u6210\u7387":148.1},{"\u9031\u30e9\u30d9\u30eb":"09\/09","\u9031\u4ef6\u6570":7,"MA8":8.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.3,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":11,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":91.8,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":10,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.8,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":7,"MA8":9.125,"\u7d2f\u7a4d\u9054\u6210\u7387":92.6,"\u9054\u6210":false,"\u9054\u6210\u7387":86.4},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":4,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":91.3,"\u9054\u6210":false,"\u9054\u6210\u7387":49.4},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":10,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":92.2,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":9,"MA8":8.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.8,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":2,"MA8":7.5,"\u7d2f\u7a4d\u9054\u6210\u7387":90.9,"\u9054\u6210":false,"\u9054\u6210\u7387":24.7},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":11,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.1,"\u9054\u6210":true,"\u9054\u6210\u7387":135.8},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":10,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":92.9,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":5,"MA8":7.25,"\u7d2f\u7a4d\u9054\u6210\u7387":92.1,"\u9054\u6210":false,"\u9054\u6210\u7387":61.7},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":13,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":true,"\u9054\u6210\u7387":160.5},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":9,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":94.2,"\u9054\u6210":true,"\u9054\u6210\u7387":111.1},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":6,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":10,"MA8":8.25,"\u7d2f\u7a4d\u9054\u6210\u7387":94.5,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":8,"MA8":9.0,"\u7d2f\u7a4d\u9054\u6210\u7387":94.6,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"12\/30","\u9031\u4ef6\u6570":3,"MA8":8.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.3,"\u9054\u6210":false,"\u9054\u6210\u7387":37.0},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":8,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":93.4,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":10,"MA8":8.375,"\u7d2f\u7a4d\u9054\u6210\u7387":94.0,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":8,"MA8":7.75,"\u7d2f\u7a4d\u9054\u6210\u7387":94.1,"\u9054\u6210":false,"\u9054\u6210\u7387":98.8},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":12,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":true,"\u9054\u6210\u7387":148.1},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":10,"MA8":8.625,"\u7d2f\u7a4d\u9054\u6210\u7387":95.8,"\u9054\u6210":true,"\u9054\u6210\u7387":123.5},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":6,"MA8":8.125,"\u7d2f\u7a4d\u9054\u6210\u7387":95.4,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":6,"MA8":7.875,"\u7d2f\u7a4d\u9054\u6210\u7387":95.0,"\u9054\u6210":false,"\u9054\u6210\u7387":74.1}], metrics: {"avg_weekly": 7.67, "achieve_rate": 94.7, "last_year_avg": 6.85, "last8_avg": 7.88, "last8_achieve_rate": 97.2, "needed_per_week": 0.22} },
        };
        const weeklyTarget = 8.1;
        const canvasId     = 'chart-è€³é¼»å’½å–‰ç§‘';
        const safeName     = 'è€³é¼»å’½å–‰ç§‘';
        const fragId       = 'frag-mode-è€³é¼»å’½å–‰ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>
<div id="fragment-è„³ç¥çµŒå¤–ç§‘" class="dept-fragment" style="display:none;">

    <div class="dept-content" id="frag-mode-è„³ç¥çµŒå¤–ç§‘">
        <div class="dept-header">
            <div>
                <h2>è„³ç¥çµŒå¤–ç§‘</h2>
                <div class="dept-target">é€±æ¬¡ç›®æ¨™: 3.0ä»¶</div>
            </div>
            <div class="frag-mode-bar"><button class="frag-mode-btn active" onclick="switchFragMode('frag-mode-è„³ç¥çµŒå¤–ç§‘','annual')">&#128197; ä»Šå¹´åº¦</button><button class="frag-mode-btn" onclick="switchFragMode('frag-mode-è„³ç¥çµŒå¤–ç§‘','rolling')">&#128260; ç›´è¿‘365æ—¥</button></div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="metric-label" id="lbl-avg-è„³ç¥çµŒå¤–ç§‘">é€±å¹³å‡ä»¶æ•°</div>
                <div class="metric-value" id="val-avg-è„³ç¥çµŒå¤–ç§‘">2.7 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-ach-è„³ç¥çµŒå¤–ç§‘">
                <div class="metric-label">ç›®æ¨™é”æˆç‡</div>
                <div class="metric-value danger" id="val-ach-è„³ç¥çµŒå¤–ç§‘">89.4%</div>
            </div>
            <div class="summary-card">
                <div class="metric-label" id="lbl-ly-è„³ç¥çµŒå¤–ç§‘">æ˜¨å¹´åº¦å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰</div>
                <div class="metric-value" id="val-ly-è„³ç¥çµŒå¤–ç§‘">2.2 ä»¶</div>
            </div>
            <div class="summary-card alert" id="card-fcst-è„³ç¥çµŒå¤–ç§‘">
                <div class="metric-label" id="lbl-fcst-è„³ç¥çµŒå¤–ç§‘">å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰</div>
                <div class="metric-value danger" id="val-fcst-è„³ç¥çµŒå¤–ç§‘">2.8 ä»¶/é€±<br><span style="font-size:0.75em">(92%)</span></div>
            </div>
        </div>
        <div class="needed-alert" id="needed-è„³ç¥çµŒå¤–ç§‘">&#9888;&#65039; å¹´åº¦æœ«ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>0.2 ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™</div>

        <div class="chart-container">
            <canvas id="chart-è„³ç¥çµŒå¤–ç§‘"></canvas>
        </div>
    </div>

    <script>
    (function() {
        // â”€â”€ ä¸¡ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ â”€â”€
        const fragModeData = {
            annual:  { chart: [{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":100.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":3,"MA8":2.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":62.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":73.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":69.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":72.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":71.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":76.2,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.6,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":79.2,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.4,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":1,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":79.6,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":82.5,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":6,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":88.3,"\u9054\u6210":true,"\u9054\u6210\u7387":200.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":4,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":90.5,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":89.4,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.8,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":91.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":4,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":93.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":92.3,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":95.1,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":3,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":96.6,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":98.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":98.9,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":1,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":96.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":98.0,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":3.25,"\u7d2f\u7a4d\u9054\u6210\u7387":96.1,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":95.2,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":95.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":93.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":4,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":94.9,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":7,"MA8":3.125,"\u7d2f\u7a4d\u9054\u6210\u7387":98.3,"\u9054\u6210":true,"\u9054\u6210\u7387":233.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":98.4,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":1,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.8,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":2,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":96.1,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":2,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":95.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7}], metrics: {"avg_weekly": 2.68, "achieve_rate": 89.4, "last_year_avg": 2.21, "last8_avg": 2.75, "last8_achieve_rate": 91.7, "needed_per_week": 0.25} },
            rolling: { chart: [{"\u9031\u30e9\u30d9\u30eb":"02\/18","\u9031\u4ef6\u6570":1,"MA8":1.0,"\u7d2f\u7a4d\u9054\u6210\u7387":33.3,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/25","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":83.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"03\/04","\u9031\u4ef6\u6570":2,"MA8":2.3333333333,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"03\/11","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"03\/18","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"03\/25","\u9031\u4ef6\u6570":3,"MA8":2.1666666667,"\u7d2f\u7a4d\u9054\u6210\u7387":72.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/01","\u9031\u4ef6\u6570":3,"MA8":2.2857142857,"\u7d2f\u7a4d\u9054\u6210\u7387":76.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/08","\u9031\u4ef6\u6570":1,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":70.8,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"04\/15","\u9031\u4ef6\u6570":3,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":74.1,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"04\/22","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":73.3,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"04\/29","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":69.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"05\/06","\u9031\u4ef6\u6570":2,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":69.4,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"05\/13","\u9031\u4ef6\u6570":2,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":69.2,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"05\/20","\u9031\u4ef6\u6570":1,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":66.7,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"05\/27","\u9031\u4ef6\u6570":3,"MA8":1.875,"\u7d2f\u7a4d\u9054\u6210\u7387":68.9,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"06\/03","\u9031\u4ef6\u6570":4,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":72.9,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"06\/17","\u9031\u4ef6\u6570":1,"MA8":2.0,"\u7d2f\u7a4d\u9054\u6210\u7387":70.6,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"06\/24","\u9031\u4ef6\u6570":3,"MA8":2.125,"\u7d2f\u7a4d\u9054\u6210\u7387":72.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"07\/01","\u9031\u4ef6\u6570":2,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":71.9,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/08","\u9031\u4ef6\u6570":4,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":75.0,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/15","\u9031\u4ef6\u6570":2,"MA8":2.5,"\u7d2f\u7a4d\u9054\u6210\u7387":74.6,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"07\/22","\u9031\u4ef6\u6570":4,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":77.3,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"07\/29","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":79.7,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/05","\u9031\u4ef6\u6570":1,"MA8":2.625,"\u7d2f\u7a4d\u9054\u6210\u7387":77.8,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"08\/12","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":80.0,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"08\/19","\u9031\u4ef6\u6570":6,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":84.6,"\u9054\u6210":true,"\u9054\u6210\u7387":200.0},{"\u9031\u30e9\u30d9\u30eb":"08\/26","\u9031\u4ef6\u6570":4,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":86.4,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"09\/02","\u9031\u4ef6\u6570":2,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":85.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/16","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":88.5,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"09\/23","\u9031\u4ef6\u6570":2,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":87.8,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"09\/30","\u9031\u4ef6\u6570":4,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":89.2,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"10\/07","\u9031\u4ef6\u6570":2,"MA8":3.625,"\u7d2f\u7a4d\u9054\u6210\u7387":88.5,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"10\/14","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":90.9,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"10\/21","\u9031\u4ef6\u6570":3,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":91.2,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"10\/28","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":92.4,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"11\/04","\u9031\u4ef6\u6570":5,"MA8":3.75,"\u7d2f\u7a4d\u9054\u6210\u7387":94.4,"\u9054\u6210":true,"\u9054\u6210\u7387":166.7},{"\u9031\u30e9\u30d9\u30eb":"11\/11","\u9031\u4ef6\u6570":3,"MA8":3.5,"\u7d2f\u7a4d\u9054\u6210\u7387":94.6,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"11\/18","\u9031\u4ef6\u6570":1,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":93.0,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"11\/25","\u9031\u4ef6\u6570":4,"MA8":3.375,"\u7d2f\u7a4d\u9054\u6210\u7387":94.0,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/02","\u9031\u4ef6\u6570":1,"MA8":3.25,"\u7d2f\u7a4d\u9054\u6210\u7387":92.5,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"12\/09","\u9031\u4ef6\u6570":2,"MA8":2.875,"\u7d2f\u7a4d\u9054\u6210\u7387":91.9,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"12\/16","\u9031\u4ef6\u6570":4,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":92.9,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"12\/23","\u9031\u4ef6\u6570":2,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.2,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"01\/06","\u9031\u4ef6\u6570":1,"MA8":2.25,"\u7d2f\u7a4d\u9054\u6210\u7387":90.9,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"01\/13","\u9031\u4ef6\u6570":4,"MA8":2.375,"\u7d2f\u7a4d\u9054\u6210\u7387":91.9,"\u9054\u6210":true,"\u9054\u6210\u7387":133.3},{"\u9031\u30e9\u30d9\u30eb":"01\/20","\u9031\u4ef6\u6570":7,"MA8":3.125,"\u7d2f\u7a4d\u9054\u6210\u7387":94.9,"\u9054\u6210":true,"\u9054\u6210\u7387":233.3},{"\u9031\u30e9\u30d9\u30eb":"01\/27","\u9031\u4ef6\u6570":3,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":95.0,"\u9054\u6210":true,"\u9054\u6210\u7387":100.0},{"\u9031\u30e9\u30d9\u30eb":"02\/03","\u9031\u4ef6\u6570":1,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.8,"\u9054\u6210":false,"\u9054\u6210\u7387":33.3},{"\u9031\u30e9\u30d9\u30eb":"02\/10","\u9031\u4ef6\u6570":2,"MA8":3.0,"\u7d2f\u7a4d\u9054\u6210\u7387":93.2,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7},{"\u9031\u30e9\u30d9\u30eb":"02\/17","\u9031\u4ef6\u6570":2,"MA8":2.75,"\u7d2f\u7a4d\u9054\u6210\u7387":92.7,"\u9054\u6210":false,"\u9054\u6210\u7387":66.7}], metrics: {"avg_weekly": 2.67, "achieve_rate": 88.9, "last_year_avg": 2.17, "last8_avg": 2.75, "last8_achieve_rate": 91.7, "needed_per_week": 0.25} },
        };
        const weeklyTarget = 3.0;
        const canvasId     = 'chart-è„³ç¥çµŒå¤–ç§‘';
        const safeName     = 'è„³ç¥çµŒå¤–ç§‘';
        const fragId       = 'frag-mode-è„³ç¥çµŒå¤–ç§‘';
        let currentMode    = 'annual';
        let chartInst      = null;

        // â”€â”€ ã‚°ãƒ©ãƒ•æç”» â”€â”€
        function buildChart(data) {
            if (!data || data.length === 0) return null;
            const bgColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,0.6)' : 'rgba(156,163,175,0.6)');
            const bdColors = data.map(d => d['é”æˆ'] ? 'rgba(16,185,129,1)'   : 'rgba(107,114,128,1)');
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d['é€±ãƒ©ãƒ™ãƒ«']),
                    datasets: [
                        {
                            label: 'é€±æ¬¡ä»¶æ•°',
                            data: data.map(d => d['é€±ä»¶æ•°']),
                            backgroundColor: bgColors, borderColor: bdColors,
                            borderWidth: 2, type: 'bar', yAxisID: 'y', order: 3
                        },
                        {
                            label: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰',
                            data: data.map(d => d['ç´¯ç©é”æˆç‡']),
                            borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)',
                            borderWidth: 3, pointRadius: 3, pointBackgroundColor: '#EF4444',
                            fill: false, tension: 0.4, type: 'line', yAxisID: 'y1', order: 1
                        },
                        {
                            label: 'ç›®æ¨™(' + weeklyTarget + 'ä»¶)',
                            data: Array(data.length).fill(weeklyTarget),
                            borderColor: '#10B981', borderDash: [5,5],
                            borderWidth: 2, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y', order: 4
                        },
                        {
                            label: 'ç´¯ç©100%',
                            data: Array(data.length).fill(100),
                            borderColor: '#EF4444', borderDash: [3,3],
                            borderWidth: 1.5, pointRadius: 0,
                            fill: false, type: 'line', yAxisID: 'y1', order: 5
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true, position: 'top',
                            labels: { font: { size: 11 }, usePointStyle: true, padding: 10, boxWidth: 15 }
                        },
                        tooltip: {
                            enabled: true, backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                afterBody: function(ctx) {
                                    const i = ctx[0].dataIndex;
                                    return [data[i]['é”æˆ'] ? 'âœ“ é€±æ¬¡é”æˆ' : 'âœ— æœªé”æˆ',
                                            'ç´¯ç©: ' + data[i]['ç´¯ç©é”æˆç‡'] + '%'];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 45, minRotation: 45 }, grid: { display: false } },
                        y: {
                            type: 'linear', display: true, position: 'left', beginAtZero: true,
                            title: { display: true, text: 'é€±æ¬¡ä»¶æ•°', font: { size: 12, weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y1: {
                            type: 'linear', display: true, position: 'right', beginAtZero: true, max: 120,
                            title: { display: true, text: 'ç´¯ç©é”æˆç‡ï¼ˆ%ï¼‰', font: { size: 12, weight: 'bold' } },
                            ticks: { callback: v => v + '%' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // â”€â”€ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–° â”€â”€
        function updateMetrics(mode) {
            const m = fragModeData[mode].metrics;
            if (!m || Object.keys(m).length === 0) return;
            const isRolling = (mode === 'rolling');
            const p1name   = isRolling ? 'å‰æœŸ365æ—¥' : 'æ˜¨å¹´åº¦';
            const fcstLbl  = isRolling ? '365æ—¥äºˆæ¸¬ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰' : 'å¹´åº¦äºˆæ¸¬å€¤ï¼ˆç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ï¼‰';
            const tgtPrd   = isRolling ? '365æ—¥ç´¯è¨ˆ' : 'å¹´åº¦æœ«';

            function el(id) { return document.getElementById(id); }

            if (el('val-avg-'  + safeName)) el('val-avg-'  + safeName).textContent = m.avg_weekly.toFixed(1) + ' ä»¶';
            if (el('val-ach-'  + safeName)) {
                el('val-ach-' + safeName).textContent = m.achieve_rate.toFixed(1) + '%';
                el('val-ach-' + safeName).className   = 'metric-value ' + (m.achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-ach-' + safeName)) {
                el('card-ach-' + safeName).className  = 'summary-card' + (m.achieve_rate < 100 ? ' alert' : '');
            }
            if (el('lbl-ly-'   + safeName)) el('lbl-ly-'  + safeName).textContent = p1name + 'å®Ÿç¸¾ï¼ˆé€±å¹³å‡ï¼‰';
            if (el('val-ly-'   + safeName)) el('val-ly-'  + safeName).textContent = (m.last_year_avg !== null && m.last_year_avg !== undefined) ? m.last_year_avg.toFixed(1) + ' ä»¶' : 'ï¼ ä»¶';
            if (el('lbl-fcst-' + safeName)) el('lbl-fcst-' + safeName).textContent = fcstLbl;
            if (el('val-fcst-' + safeName)) {
                el('val-fcst-' + safeName).innerHTML  = m.last8_avg.toFixed(1) + ' ä»¶/é€±<br><span style="font-size:0.75em">(' + m.last8_achieve_rate.toFixed(0) + '%)</span>';
                el('val-fcst-' + safeName).className  = 'metric-value ' + (m.last8_achieve_rate >= 100 ? 'success' : 'danger');
            }
            if (el('card-fcst-' + safeName)) {
                el('card-fcst-' + safeName).className = 'summary-card' + (m.last8_achieve_rate < 100 ? ' alert' : '');
            }
            const needEl = el('needed-' + safeName);
            if (needEl) {
                if (m.needed_per_week > 0) {
                    needEl.className   = 'needed-alert';
                    needEl.innerHTML   = '&#9888;&#65039; ' + tgtPrd + 'ç›®æ¨™é”æˆã«ã¯é€±ã‚ãŸã‚Š <strong>' + m.needed_per_week.toFixed(1) + ' ä»¶</strong> ã®è¿½åŠ ãŒå¿…è¦ã§ã™';
                } else {
                    needEl.className   = 'needed-ok';
                    needEl.textContent = 'âœ… ç›´è¿‘8é€±ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆä¸­';
                }
            }
        }

        // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰ â”€â”€
        window.switchFragMode = window.switchFragMode || function(id, mode) {
            const fragEl = document.getElementById(id);
            if (!fragEl) return;
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
            });
            // ã‚°ãƒ©ãƒ•å†æç”»
            if (chartInst) { chartInst.destroy(); chartInst = null; }
            chartInst = buildChart(fragModeData[mode].chart);
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics(mode);
            currentMode = mode;
        };
        // â€» switchFragMode ã¯è¤‡æ•°ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ãŒ1å›ã ã‘ã«ãªã‚‹ã‚ˆã†ä¸Šæ›¸ãã—ãªã„
        // å®Ÿéš›ã®åˆ‡æ›¿ã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã® closure ã‚’ä½¿ã‚ãšã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã§ id æŒ‡å®šã™ã‚‹æ–¹å¼
        // ãã®ãŸã‚å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® buildChart / updateMetrics ã¯ closure å†…ã«ä¿æŒ
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‹ã‚‰å„ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã† registry ã«ç™»éŒ²
        if (!window._fragRegistry) window._fragRegistry = {};
        window._fragRegistry[fragId] = {
            switchMode: function(mode) {
                const fragEl = document.getElementById(fragId);
                if (!fragEl) return;
                fragEl.querySelectorAll('.frag-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes("'" + mode + "'"));
                });
                if (chartInst) { chartInst.destroy(); chartInst = null; }
                chartInst = buildChart(fragModeData[mode].chart);
                updateMetrics(mode);
                currentMode = mode;
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ« switchFragMode ã‚’ registry çµŒç”±ã«çµ±ä¸€
        window.switchFragMode = function(id, mode) {
            if (window._fragRegistry && window._fragRegistry[id]) {
                window._fragRegistry[id].switchMode(mode);
            }
        };

        // â”€â”€ åˆæœŸæç”» â”€â”€
        chartInst = buildChart(fragModeData[currentMode].chart);
    })();
    </script>
    
</div>

            </div>
        </div>
        
        <script>
            // Chart.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded!');
            }
            
            function switchDepartment() {
                const selector = document.getElementById('dept-selector');
                const selectedValue = selector.value;
                const placeholder = document.getElementById('placeholder');
                const allFragments = document.querySelectorAll('.dept-fragment');
                
                // ã™ã¹ã¦éè¡¨ç¤º
                placeholder.style.display = 'none';
                allFragments.forEach(f => {
                    f.classList.remove('active');
                    f.style.display = 'none';
                });
                
                if (!selectedValue) {
                    placeholder.style.display = 'block';
                    return;
                }
                
                // é¸æŠã•ã‚ŒãŸè¨ºç™‚ç§‘ã‚’è¡¨ç¤º
                const targetFragment = document.getElementById('fragment-' + selectedValue);
                if (targetFragment) {
                    targetFragment.classList.add('active');
                    targetFragment.style.display = 'block';
                } else {
                    placeholder.style.display = 'block';
                }
            }

            // â”€â”€ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚°ãƒ©ãƒ•ç”¨ï¼‰ â”€â”€
            const INT_DUAL = true;
            const annPerfData = [{"dept": "çš®è†šç§‘", "avg": 1.6, "tgt": 1.2, "rate": 133.0, "pct_fill": 5.7, "tgt_pct": 4.3, "css": "achieved", "badge": "âœ…"}, {"dept": "æ­¯ç§‘å£è…”å¤–ç§‘", "avg": 3.7, "tgt": 3.2, "rate": 115.7, "pct_fill": 13.1, "tgt_pct": 11.3, "css": "achieved", "badge": "âœ…"}, {"dept": "æ³Œå°¿å™¨ç§‘", "avg": 10.81, "tgt": 10.2, "rate": 106.0, "pct_fill": 38.3, "tgt_pct": 36.2, "css": "achieved", "badge": "âœ…"}, {"dept": "æ•´å½¢å¤–ç§‘", "avg": 28.21, "tgt": 27.2, "rate": 103.7, "pct_fill": 100.0, "tgt_pct": 96.4, "css": "achieved", "badge": "âœ…"}, {"dept": "è€³é¼»å’½å–‰ç§‘", "avg": 7.57, "tgt": 8.1, "rate": 93.5, "pct_fill": 26.8, "tgt_pct": 28.7, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘", "avg": 12.72, "tgt": 14.1, "rate": 90.2, "pct_fill": 45.1, "tgt_pct": 50.0, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "è„³ç¥çµŒå¤–ç§‘", "avg": 2.68, "tgt": 3.0, "rate": 89.4, "pct_fill": 9.5, "tgt_pct": 10.6, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ç”£å©¦äººç§‘", "avg": 10.91, "tgt": 12.5, "rate": 87.3, "pct_fill": 38.7, "tgt_pct": 44.3, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ä¹³è…ºå¤–ç§‘", "avg": 6.49, "tgt": 8.1, "rate": 80.1, "pct_fill": 23.0, "tgt_pct": 28.7, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "å‘¼å¸å™¨å¤–ç§‘", "avg": 2.17, "tgt": 2.8, "rate": 77.5, "pct_fill": 7.7, "tgt_pct": 9.9, "css": "below", "badge": "ğŸ”´"}, {"dept": "å½¢æˆå¤–ç§‘", "avg": 2.3, "tgt": 3.0, "rate": 76.6, "pct_fill": 8.1, "tgt_pct": 10.6, "css": "below", "badge": "ğŸ”´"}, {"dept": "å¿ƒè‡“è¡€ç®¡å¤–ç§‘", "avg": 1.38, "tgt": 2.1, "rate": 65.9, "pct_fill": 4.9, "tgt_pct": 7.4, "css": "below", "badge": "ğŸ”´"}];
            const rolPerfData = [{"dept": "çš®è†šç§‘", "avg": 1.57, "tgt": 1.2, "rate": 131.1, "pct_fill": 5.6, "tgt_pct": 4.3, "css": "achieved", "badge": "âœ…"}, {"dept": "æ­¯ç§‘å£è…”å¤–ç§‘", "avg": 3.57, "tgt": 3.2, "rate": 111.5, "pct_fill": 12.6, "tgt_pct": 11.3, "css": "achieved", "badge": "âœ…"}, {"dept": "æ•´å½¢å¤–ç§‘", "avg": 28.21, "tgt": 27.2, "rate": 103.7, "pct_fill": 100.0, "tgt_pct": 96.4, "css": "achieved", "badge": "âœ…"}, {"dept": "æ³Œå°¿å™¨ç§‘", "avg": 10.45, "tgt": 10.2, "rate": 102.5, "pct_fill": 37.0, "tgt_pct": 36.2, "css": "achieved", "badge": "âœ…"}, {"dept": "è€³é¼»å’½å–‰ç§‘", "avg": 7.67, "tgt": 8.1, "rate": 94.7, "pct_fill": 27.2, "tgt_pct": 28.7, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ä¸€èˆ¬æ¶ˆåŒ–å™¨å¤–ç§‘", "avg": 12.72, "tgt": 14.1, "rate": 90.2, "pct_fill": 45.1, "tgt_pct": 50.0, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "è„³ç¥çµŒå¤–ç§‘", "avg": 2.67, "tgt": 3.0, "rate": 88.9, "pct_fill": 9.4, "tgt_pct": 10.6, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ç”£å©¦äººç§‘", "avg": 10.97, "tgt": 12.5, "rate": 87.8, "pct_fill": 38.9, "tgt_pct": 44.3, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "ä¹³è…ºå¤–ç§‘", "avg": 6.48, "tgt": 8.1, "rate": 80.0, "pct_fill": 23.0, "tgt_pct": 28.7, "css": "near", "badge": "ğŸŸ¡"}, {"dept": "å‘¼å¸å™¨å¤–ç§‘", "avg": 2.22, "tgt": 2.8, "rate": 79.5, "pct_fill": 7.9, "tgt_pct": 9.9, "css": "below", "badge": "ğŸ”´"}, {"dept": "å½¢æˆå¤–ç§‘", "avg": 2.26, "tgt": 3.0, "rate": 75.4, "pct_fill": 8.0, "tgt_pct": 10.6, "css": "below", "badge": "ğŸ”´"}, {"dept": "å¿ƒè‡“è¡€ç®¡å¤–ç§‘", "avg": 1.44, "tgt": 2.1, "rate": 68.5, "pct_fill": 5.1, "tgt_pct": 7.4, "css": "below", "badge": "ğŸ”´"}];
            let intCurrentMode = 'annual';

            function switchIntMode(mode) {
                if (!INT_DUAL) return;
                intCurrentMode = mode;
                const isRolling = (mode === 'rolling');
                document.getElementById('int-btn-annual') .classList.toggle('active', !isRolling);
                document.getElementById('int-btn-rolling').classList.toggle('active',  isRolling);
                const title = document.getElementById('perf-chart-title');
                if (title) title.textContent = 'è¨ºç™‚ç§‘åˆ¥ å…¨èº«éº»é…”ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆ' + (isRolling ? 'ç›´è¿‘365æ—¥' : 'ä»Šå¹´åº¦') + 'ï¼‰';
                renderPerfRows(isRolling ? rolPerfData : annPerfData);
            }

            function renderPerfRows(data) {
                if (!data || !data.length) return;
                const container = document.getElementById('perf-rows');
                if (!container) return;
                container.innerHTML = data.map(r => `
                    <div class="perf-row">
                        <div class="perf-dept ${r.css}" title="${r.dept}">${r.dept}</div>
                        <div class="perf-act-tgt"><strong>${r.avg.toFixed(1)}</strong>ä»¶/é€± ï¼ ç›®æ¨™${r.tgt}ä»¶</div>
                        <div class="perf-bar-wrap">
                            <div class="perf-bar-fill ${r.css}" style="width:${r.pct_fill}%"></div>
                            <div class="perf-target-line" style="left:${r.tgt_pct}%"></div>
                        </div>
                        <div class="perf-rate ${r.css}">${r.rate.toFixed(0)}%</div>
                        <div class="perf-badge ${r.css}"></div>
                    </div>
                `).join('');
            }

            // â”€â”€ åˆæœŸåŒ–ï¼šãƒãƒƒãƒ—ç”Ÿæˆ & åˆæœŸRowsãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’DOMContentLoadedå¾Œã«å®Ÿè¡Œ â”€â”€
            function initPage() {
                // ãƒãƒƒãƒ—ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å†…ã®è¨ºç™‚ç§‘ä¸€è¦§ï¼‰
                const chips = document.getElementById('ph-chips');
                if (chips) {
                    const opts = document.querySelectorAll('#dept-selector option');
                    chips.innerHTML = Array.from(opts).filter(o=>o.value)
                        .map(o=>`<span class="ph-chip">${o.textContent}</span>`).join('');
                }
                // åˆæœŸãƒ¢ãƒ¼ãƒ‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¡Œã‚’JSå´ã§ã‚‚ç¢ºå®Ÿã«æç”»
                const initData = (intCurrentMode === 'rolling') ? rolPerfData : annPerfData;
                if (initData && initData.length) renderPerfRows(initData);
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initPage);
            } else {
                initPage();
            }
        </script>
    </body>
    </html>
    